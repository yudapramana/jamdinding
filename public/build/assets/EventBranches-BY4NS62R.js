import{z as R,y as F,A as v,O as G,V as W,B as i,C as u,D as e,I as h,J as c,K as r,S as p,aB as T,as as w,U as M,ay as H,H as S,F as U,a as g,L as X,aC as Z}from"./AuthUserStore-B6VIMEgo.js";import{S as d}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const ee={class:"content-header"},ae={class:"container-fluid"},te={class:"d-flex justify-content-between align-items-center"},se={key:0,class:"mb-0 mt-1 text-sm text-muted"},ne={key:0},le={class:"d-flex flex-column flex-sm-row gap-2"},oe=["disabled"],re={key:0,class:"fas fa-spinner fa-spin mr-1"},ie={key:1,class:"fas fa-magic mr-1"},ue=["disabled"],de={key:0,class:"text-danger text-sm mt-2 mb-0"},me={class:"content"},ce={class:"container-fluid"},ve={class:"card"},be={class:"card-header"},pe={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},ge={class:"d-flex align-items-center"},fe={class:"card-body table-responsive p-0"},he={class:"table table-bordered table-hover text-sm mb-0"},_e={key:0},ke={key:1},ye={class:"text-center"},xe={class:"text-center"},Ce={class:"text-center"},we={class:"btn-group btn-group-sm"},Be=["onClick"],Ee=["onClick"],Ge=["onClick"],Te={class:"card-footer clearfix py-2"},Me={class:"d-flex justify-content-between align-items-center"},Se={class:"text-muted text-sm"},Ue={class:"pagination pagination-sm m-0"},Ne={class:"page-item disabled"},Ve={class:"page-link"},$e={class:"modal fade",id:"eventBranchModal",tabindex:"-1",role:"dialog","aria-labelledby":"eventBranchModalLabel"},De={class:"modal-dialog modal-lg",role:"document"},Le={class:"modal-content"},Pe={class:"modal-header py-2"},Ae={class:"modal-title",id:"eventBranchModalLabel"},Fe={class:"modal-body pt-2"},He={class:"row"},Ie={class:"col-md-6"},je={class:"form-group mb-2"},qe=["value"],Je={key:0},Ke={class:"form-group mb-2"},Ye={class:"col-md-6"},ze={class:"form-group mb-2"},Oe={class:"form-group mb-2"},Qe={class:"form-group mb-2"},Re={class:"text-right mt-3"},We=["disabled"],Xe={key:0,class:"fas fa-spinner fa-spin mr-1"},Ze={key:1,class:"fas fa-save mr-1"},sa={__name:"EventBranches",setup(ea){const N=R(),I=X(),j=t=>{I.push({name:"admin.event.groups",query:{branch_id:t.branch_id}})},f=F(()=>N.eventData||null),m=F(()=>{var t;return((t=f.value)==null?void 0:t.id)||null}),B=v([]),V=v([]),_=v(""),k=v(10),E=v(!1),y=v(!1),x=v(!1),C=v(!1),o=v({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),n=v({id:null,branch_id:"",branch_name:"",full_name:"",status:"active",order_number:null}),q=async()=>{try{const t=await g.get("/api/v1/branches",{params:{simple:1}});V.value=t.data.data||[]}catch(t){console.error("Gagal memuat branches:",t),d.fire("Gagal","Gagal memuat daftar cabang (branches).","error")}},b=async(t=1)=>{if(m.value){E.value=!0;try{const l=(await g.get("/api/v1/event-branches",{params:{event_id:m.value,page:t,per_page:k.value,search:_.value,from_crud:1}})).data.data;B.value=l.data||[],o.value={current_page:l.current_page,per_page:l.per_page,total:l.total,from:l.from,to:l.to,last_page:l.last_page}}catch(a){console.error("Gagal memuat event_branches:",a),a.response&&a.response.status===401?N.logout():d.fire("Gagal","Gagal memuat data event branches.","error")}finally{E.value=!1}}},D=t=>{t<1||t>o.value.last_page||b(t)},J=()=>{if(!m.value){d.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola cabang.","warning");return}y.value=!1,n.value={id:null,branch_id:"",branch_name:"",full_name:"",status:"active",order_number:(o.value.total||0)+1},$("#eventBranchModal").modal("show")},K=t=>{y.value=!0,n.value={id:t.id,branch_id:t.branch_id,branch_name:t.branch_name,full_name:t.full_name,status:t.status,order_number:t.order_number},$("#eventBranchModal").modal("show")},Y=async()=>{if(!m.value){d.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola cabang.","warning");return}x.value=!0;const t={event_id:m.value,branch_id:n.value.branch_id,branch_name:n.value.branch_name,full_name:n.value.full_name,status:n.value.status,order_number:n.value.order_number};try{y.value&&n.value.id?(await g.put(`/api/v1/event-branches/${n.value.id}`,t),d.fire("Berhasil","Cabang event berhasil diperbarui.","success")):(await g.post("/api/v1/event-branches",t),d.fire("Berhasil","Cabang event berhasil ditambahkan.","success")),$("#eventBranchModal").modal("hide"),b(o.value.current_page)}catch(a){console.error("Gagal menyimpan event_branch:",a);let l="Gagal menyimpan data cabang event.";a.response&&a.response.status===422&&a.response.data.message&&(l=a.response.data.message),d.fire("Gagal",l,"error")}finally{x.value=!1}},z=async t=>{if((await d.fire({title:"Hapus Cabang Event?",text:`Yakin ingin menghapus cabang "${t.branch_name}" dari event ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await g.delete(`/api/v1/event-branches/${t.id}`),d.fire("Terhapus","Cabang event berhasil dihapus.","success"),b(o.value.current_page)}catch(l){console.error("Gagal menghapus event_branch:",l),d.fire("Gagal","Gagal menghapus cabang event.","error")}},O=async()=>{if(!m.value){d.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum generate dari template.","warning");return}if((await d.fire({title:"Generate dari Template?",text:"Cabang event akan dibuat berdasarkan Master Branches. Cabang yang sudah ada tidak akan diduplikasi.",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Generate",cancelButtonText:"Batal",confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d"})).isConfirmed){C.value=!0;try{await g.post("/api/v1/event-branches/generate-from-template",{event_id:m.value}),d.fire("Berhasil","Cabang event berhasil digenerate dari template.","success"),b(1)}catch(a){console.error("Gagal generate dari template:",a);let l="Gagal generate cabang dari template.";a.response&&a.response.data&&a.response.data.message&&(l=a.response.data.message),d.fire("Gagal",l,"error")}finally{C.value=!1}}};return G(()=>_.value,Z(()=>b(1),400)),G(()=>k.value,()=>{b(1)}),G(()=>m.value,t=>{t&&b(1)}),W(()=>{q(),m.value?b():d.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(t,a)=>{var l,L,P;return u(),i(M,null,[e("section",ee,[e("div",ae,[e("div",te,[e("div",null,[a[11]||(a[11]=e("h1",{class:"mb-1"},"Cabang Lomba per Event (Event Branches)",-1)),a[12]||(a[12]=e("p",{class:"mb-0 text-muted text-sm"}," Mengatur cabang lomba yang diaktifkan pada event terpilih. Data ini dapat digenerate dari Master Branches lalu disesuaikan. ",-1)),m.value?(u(),i("p",se,[a[9]||(a[9]=c(" Event aktif: ")),e("strong",null,r((l=f.value)==null?void 0:l.event_name),1),(L=f.value)!=null&&L.event_year?(u(),i("span",ne," ("+r(f.value.event_year)+")",1)):h("",!0),a[10]||(a[10]=c(" • Lokasi: ")),e("strong",null,r(((P=f.value)==null?void 0:P.event_location)||"-"),1)])):h("",!0)]),e("div",le,[e("button",{class:"btn btn-outline-secondary btn-sm mr-sm-2 mb-2 mb-sm-0",onClick:O,disabled:C.value||!m.value},[C.value?(u(),i("i",re)):(u(),i("i",ie)),a[13]||(a[13]=c(" Generate dari Template "))],8,oe),e("button",{class:"btn btn-primary btn-sm",onClick:J,disabled:!m.value}," + Tambah Cabang ",8,ue)])]),m.value?h("",!0):(u(),i("p",de,a[14]||(a[14]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),c(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",me,[e("div",ce,[e("div",ve,[e("div",be,[e("div",pe,[e("div",ge,[a[16]||(a[16]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),p(e("select",{"onUpdate:modelValue":a[0]||(a[0]=s=>k.value=s),class:"form-control form-control-sm w-auto mr-2"},a[15]||(a[15]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[T,k.value,void 0,{number:!0}]]),a[17]||(a[17]=e("label",{class:"mb-0 text-sm text-muted"},"Entri",-1))]),p(e("input",{"onUpdate:modelValue":a[1]||(a[1]=s=>_.value=s),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari nama cabang..."},null,512),[[w,_.value]])])]),e("div",fe,[e("table",he,[a[23]||(a[23]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Nama Cabang"),e("th",null,"Nama Lengkap"),e("th",{style:{width:"90px"},class:"text-center"},"Status"),e("th",{style:{width:"90px"},class:"text-center"},"Urutan"),e("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[E.value?(u(),i("tr",_e,a[18]||(a[18]=[e("td",{colspan:"6",class:"text-center"},"Memuat data event branches...",-1)]))):B.value.length===0?(u(),i("tr",ke,a[19]||(a[19]=[e("td",{colspan:"6",class:"text-center"},[c(" Belum ada cabang terdaftar untuk event ini. "),e("br"),e("small",{class:"text-muted"},[c(" Klik "),e("strong",null,"Generate dari Template"),c(" atau "),e("strong",null,"Tambah Cabang Event"),c(". ")])],-1)]))):h("",!0),(u(!0),i(M,null,H(B.value,(s,Q)=>(u(),i("tr",{key:s.id},[e("td",null,r(Q+1+(o.value.current_page-1)*o.value.per_page),1),e("td",null,[e("strong",null,r(s.branch_name),1)]),e("td",null,r(s.full_name),1),e("td",ye,[e("span",{class:S(["badge",s.status==="active"?"badge-success":"badge-secondary"])},r(s.status==="active"?"Aktif":"Nonaktif"),3)]),e("td",xe,r(s.order_number??"-"),1),e("td",Ce,[e("div",we,[e("button",{class:"btn btn-info",title:"Kelola Golongan untuk Cabang ini",onClick:A=>j(s)},a[20]||(a[20]=[e("i",{class:"fas fa-users"},null,-1)]),8,Be),e("button",{class:"btn btn-warning",onClick:A=>K(s)},a[21]||(a[21]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Ee),e("button",{class:"btn btn-danger",onClick:A=>z(s)},a[22]||(a[22]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Ge)])])]))),128))])])]),e("div",Te,[e("div",Me,[e("div",Se," Menampilkan "+r(o.value.from||0)+" - "+r(o.value.to||0)+" dari "+r(o.value.total||0)+" cabang event ",1),e("ul",Ue,[e("li",{class:S(["page-item",{disabled:o.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:a[2]||(a[2]=U(s=>D(o.value.current_page-1),["prevent"]))}," « ")],2),e("li",Ne,[e("span",Ve," Halaman "+r(o.value.current_page)+" / "+r(o.value.last_page||1),1)]),e("li",{class:S(["page-item",{disabled:o.value.current_page===o.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:a[3]||(a[3]=U(s=>D(o.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",$e,[e("div",De,[e("div",Le,[e("div",Pe,[e("h5",Ae,[a[24]||(a[24]=e("i",{class:"fas fa-code-branch mr-1"},null,-1)),c(" "+r(y.value?"Edit Cabang Event":"Tambah Cabang Event"),1)]),a[25]||(a[25]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Fe,[e("form",{onSubmit:U(Y,["prevent"])},[e("div",He,[e("div",Ie,[e("div",je,[a[27]||(a[27]=e("label",{class:"mb-1"},"Cabang Lomba",-1)),p(e("select",{"onUpdate:modelValue":a[4]||(a[4]=s=>n.value.branch_id=s),class:"form-control form-control-sm",required:""},[a[26]||(a[26]=e("option",{value:"",disabled:""},"-- pilih cabang --",-1)),(u(!0),i(M,null,H(V.value,s=>(u(),i("option",{key:s.id,value:s.id},[c(r(s.name)+" ",1),s.code?(u(),i("span",Je," ("+r(s.code)+")",1)):h("",!0)],8,qe))),128))],512),[[T,n.value.branch_id]]),a[28]||(a[28]=e("small",{class:"text-muted"},[c(" Data diambil dari master "),e("strong",null,"Branches"),c(". ")],-1))]),e("div",Ke,[a[29]||(a[29]=e("label",{class:"mb-1"},"Nama Cabang (Denormalisasi)",-1)),p(e("input",{"onUpdate:modelValue":a[5]||(a[5]=s=>n.value.branch_name=s),type:"text",class:"form-control form-control-sm",placeholder:"Jika kosong, akan diisi otomatis dari master branch"},null,512),[[w,n.value.branch_name]])])]),e("div",Ye,[e("div",ze,[a[30]||(a[30]=e("label",{class:"mb-1"},"Nama Lengkap (Full Name)",-1)),p(e("input",{"onUpdate:modelValue":a[6]||(a[6]=s=>n.value.full_name=s),type:"text",class:"form-control form-control-sm",placeholder:"Contoh: Cabang Tilawah Al Qur'an Dewasa"},null,512),[[w,n.value.full_name]]),a[31]||(a[31]=e("small",{class:"text-muted"}," Jika dikosongkan, dapat disamakan dengan Nama Cabang. ",-1))]),e("div",Oe,[a[33]||(a[33]=e("label",{class:"mb-1"},"Status",-1)),p(e("select",{"onUpdate:modelValue":a[7]||(a[7]=s=>n.value.status=s),class:"form-control form-control-sm"},a[32]||(a[32]=[e("option",{value:"active"},"Aktif",-1),e("option",{value:"inactive"},"Nonaktif",-1)]),512),[[T,n.value.status]])]),e("div",Qe,[a[34]||(a[34]=e("label",{class:"mb-1"},"Urutan Tampil",-1)),p(e("input",{"onUpdate:modelValue":a[8]||(a[8]=s=>n.value.order_number=s),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[w,n.value.order_number,void 0,{number:!0}]])])])]),e("div",Re,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:x.value||!m.value},[x.value?(u(),i("i",Xe)):(u(),i("i",Ze)),a[35]||(a[35]=c(" Simpan "))],8,We)])],32)])])])])])],64)}}};export{sa as default};
