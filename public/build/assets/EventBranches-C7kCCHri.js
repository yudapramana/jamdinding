import{z,y as D,A as m,O as w,V as O,B as i,C as u,D as e,I as B,K as c,S as b,aB as E,as as y,U as G,ay as L,J as d,H as T,F as M,a as p,L as Q,aC as R}from"./AuthUserStore-67h2FHdL.js";import{S as o}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const W={class:"content-header"},X={class:"container-fluid"},Z={class:"d-flex justify-content-between align-items-center"},ee={class:"d-flex flex-column flex-sm-row gap-2"},ae=["disabled"],te={key:0,class:"fas fa-spinner fa-spin mr-1"},se={key:1,class:"fas fa-magic mr-1"},ne=["disabled"],le={key:0,class:"text-danger text-sm mt-2 mb-0"},oe={class:"content"},re={class:"container-fluid"},ie={class:"card"},ue={class:"card-header"},de={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},ce={class:"d-flex align-items-center"},me={class:"card-body table-responsive p-0"},ve={class:"table table-bordered table-hover text-sm mb-0"},be={key:0},pe={key:1},ge={class:"text-center"},fe={class:"text-center"},he={class:"text-center"},_e={class:"btn-group btn-group-sm"},ke=["onClick"],ye=["onClick"],xe=["onClick"],Ce={class:"card-footer clearfix py-2"},we={class:"d-flex justify-content-between align-items-center"},Be={class:"text-muted text-sm"},Ee={class:"pagination pagination-sm m-0"},Ge={class:"page-item disabled"},Te={class:"page-link"},Me={class:"modal fade",id:"eventBranchModal",tabindex:"-1",role:"dialog","aria-labelledby":"eventBranchModalLabel"},Se={class:"modal-dialog modal-lg",role:"document"},Ue={class:"modal-content"},Ne={class:"modal-header py-2"},Ve={class:"modal-title",id:"eventBranchModalLabel"},$e={class:"modal-body pt-2"},De={class:"row"},Le={class:"col-md-6"},Pe={class:"form-group mb-2"},Ae=["value"],Fe={key:0},He={class:"form-group mb-2"},Ie={class:"col-md-6"},je={class:"form-group mb-2"},qe={class:"form-group mb-2"},Je={class:"form-group mb-2"},Ke={class:"text-right mt-3"},Ye=["disabled"],ze={key:0,class:"fas fa-spinner fa-spin mr-1"},Oe={key:1,class:"fas fa-save mr-1"},Xe={__name:"EventBranches",setup(Qe){const S=z(),P=Q(),A=s=>{P.push({name:"admin.event.groups",query:{branch_id:s.branch_id}})},F=D(()=>S.eventData||null),r=D(()=>{var s;return((s=F.value)==null?void 0:s.id)||null}),x=m([]),U=m([]),g=m(""),f=m(10),C=m(!1),h=m(!1),_=m(!1),k=m(!1),l=m({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),n=m({id:null,branch_id:"",branch_name:"",full_name:"",status:"active",order_number:null}),H=async()=>{try{const s=await p.get("/api/v1/branches",{params:{simple:1}});U.value=s.data.data||[]}catch(s){console.error("Gagal memuat branches:",s),o.fire("Gagal","Gagal memuat daftar cabang (branches).","error")}},v=async(s=1)=>{if(r.value){C.value=!0;try{const t=(await p.get("/api/v1/event-branches",{params:{event_id:r.value,page:s,per_page:f.value,search:g.value,from_crud:1}})).data.data;x.value=t.data||[],l.value={current_page:t.current_page,per_page:t.per_page,total:t.total,from:t.from,to:t.to,last_page:t.last_page}}catch(a){console.error("Gagal memuat event_branches:",a),a.response&&a.response.status===401?S.logout():o.fire("Gagal","Gagal memuat data event branches.","error")}finally{C.value=!1}}},N=s=>{s<1||s>l.value.last_page||v(s)},I=()=>{if(!r.value){o.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola cabang.","warning");return}h.value=!1,n.value={id:null,branch_id:"",branch_name:"",full_name:"",status:"active",order_number:(l.value.total||0)+1},$("#eventBranchModal").modal("show")},j=s=>{h.value=!0,n.value={id:s.id,branch_id:s.branch_id,branch_name:s.branch_name,full_name:s.full_name,status:s.status,order_number:s.order_number},$("#eventBranchModal").modal("show")},q=async()=>{if(!r.value){o.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola cabang.","warning");return}_.value=!0;const s={event_id:r.value,branch_id:n.value.branch_id,branch_name:n.value.branch_name,full_name:n.value.full_name,status:n.value.status,order_number:n.value.order_number};try{h.value&&n.value.id?(await p.put(`/api/v1/event-branches/${n.value.id}`,s),o.fire("Berhasil","Cabang event berhasil diperbarui.","success")):(await p.post("/api/v1/event-branches",s),o.fire("Berhasil","Cabang event berhasil ditambahkan.","success")),$("#eventBranchModal").modal("hide"),v(l.value.current_page)}catch(a){console.error("Gagal menyimpan event_branch:",a);let t="Gagal menyimpan data cabang event.";a.response&&a.response.status===422&&a.response.data.message&&(t=a.response.data.message),o.fire("Gagal",t,"error")}finally{_.value=!1}},J=async s=>{if((await o.fire({title:"Hapus Cabang Event?",text:`Yakin ingin menghapus cabang "${s.branch_name}" dari event ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await p.delete(`/api/v1/event-branches/${s.id}`),o.fire("Terhapus","Cabang event berhasil dihapus.","success"),v(l.value.current_page)}catch(t){console.error("Gagal menghapus event_branch:",t),o.fire("Gagal","Gagal menghapus cabang event.","error")}},K=async()=>{if(!r.value){o.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum generate dari template.","warning");return}if((await o.fire({title:"Generate dari Template?",text:"Cabang event akan dibuat berdasarkan Master Branches. Cabang yang sudah ada tidak akan diduplikasi.",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Generate",cancelButtonText:"Batal",confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d"})).isConfirmed){k.value=!0;try{await p.post("/api/v1/event-branches/generate-from-template",{event_id:r.value}),o.fire("Berhasil","Cabang event berhasil digenerate dari template.","success"),v(1)}catch(a){console.error("Gagal generate dari template:",a);let t="Gagal generate cabang dari template.";a.response&&a.response.data&&a.response.data.message&&(t=a.response.data.message),o.fire("Gagal",t,"error")}finally{k.value=!1}}};return w(()=>g.value,R(()=>v(1),400)),w(()=>f.value,()=>{v(1)}),w(()=>r.value,s=>{s&&v(1)}),O(()=>{H(),r.value?v():o.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(s,a)=>(u(),i(G,null,[e("section",W,[e("div",X,[e("div",Z,[a[10]||(a[10]=e("div",null,[e("h1",{class:"mb-1"},"Cabang Lomba per Event (Event Branches)"),e("p",{class:"mb-0 text-muted text-sm"}," Mengatur cabang lomba yang diaktifkan pada event terpilih. Data ini dapat digenerate dari Master Branches lalu disesuaikan. ")],-1)),e("div",ee,[e("button",{class:"btn btn-outline-secondary btn-sm mr-sm-2 mb-2 mb-sm-0",onClick:K,disabled:k.value||!r.value},[k.value?(u(),i("i",te)):(u(),i("i",se)),a[9]||(a[9]=c(" Generate dari Template "))],8,ae),e("button",{class:"btn btn-primary btn-sm",onClick:I,disabled:!r.value}," + Tambah Cabang ",8,ne)])]),r.value?B("",!0):(u(),i("p",le,a[11]||(a[11]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),c(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",oe,[e("div",re,[e("div",ie,[e("div",ue,[e("div",de,[e("div",ce,[a[13]||(a[13]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),b(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>f.value=t),class:"form-control form-control-sm w-auto mr-2"},a[12]||(a[12]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[E,f.value,void 0,{number:!0}]]),a[14]||(a[14]=e("label",{class:"mb-0 text-sm text-muted"},"Entri",-1))]),b(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>g.value=t),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari nama cabang..."},null,512),[[y,g.value]])])]),e("div",me,[e("table",ve,[a[20]||(a[20]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Nama Cabang"),e("th",null,"Nama Lengkap"),e("th",{style:{width:"90px"},class:"text-center"},"Status"),e("th",{style:{width:"90px"},class:"text-center"},"Urutan"),e("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[C.value?(u(),i("tr",be,a[15]||(a[15]=[e("td",{colspan:"6",class:"text-center"},"Memuat data event branches...",-1)]))):x.value.length===0?(u(),i("tr",pe,a[16]||(a[16]=[e("td",{colspan:"6",class:"text-center"},[c(" Belum ada cabang terdaftar untuk event ini. "),e("br"),e("small",{class:"text-muted"},[c(" Klik "),e("strong",null,"Generate dari Template"),c(" atau "),e("strong",null,"Tambah Cabang Event"),c(". ")])],-1)]))):B("",!0),(u(!0),i(G,null,L(x.value,(t,Y)=>(u(),i("tr",{key:t.id},[e("td",null,d(Y+1+(l.value.current_page-1)*l.value.per_page),1),e("td",null,[e("strong",null,d(t.branch_name),1)]),e("td",null,d(t.full_name),1),e("td",ge,[e("span",{class:T(["badge",t.status==="active"?"badge-success":"badge-secondary"])},d(t.status==="active"?"Aktif":"Nonaktif"),3)]),e("td",fe,d(t.order_number??"-"),1),e("td",he,[e("div",_e,[e("button",{class:"btn btn-info",title:"Kelola Golongan untuk Cabang ini",onClick:V=>A(t)},a[17]||(a[17]=[e("i",{class:"fas fa-users"},null,-1)]),8,ke),e("button",{class:"btn btn-warning",onClick:V=>j(t)},a[18]||(a[18]=[e("i",{class:"fas fa-edit"},null,-1)]),8,ye),e("button",{class:"btn btn-danger",onClick:V=>J(t)},a[19]||(a[19]=[e("i",{class:"fas fa-trash"},null,-1)]),8,xe)])])]))),128))])])]),e("div",Ce,[e("div",we,[e("div",Be," Menampilkan "+d(l.value.from||0)+" - "+d(l.value.to||0)+" dari "+d(l.value.total||0)+" cabang event ",1),e("ul",Ee,[e("li",{class:T(["page-item",{disabled:l.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:a[2]||(a[2]=M(t=>N(l.value.current_page-1),["prevent"]))}," « ")],2),e("li",Ge,[e("span",Te," Halaman "+d(l.value.current_page)+" / "+d(l.value.last_page||1),1)]),e("li",{class:T(["page-item",{disabled:l.value.current_page===l.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:a[3]||(a[3]=M(t=>N(l.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",Me,[e("div",Se,[e("div",Ue,[e("div",Ne,[e("h5",Ve,[a[21]||(a[21]=e("i",{class:"fas fa-code-branch mr-1"},null,-1)),c(" "+d(h.value?"Edit Cabang Event":"Tambah Cabang Event"),1)]),a[22]||(a[22]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",$e,[e("form",{onSubmit:M(q,["prevent"])},[e("div",De,[e("div",Le,[e("div",Pe,[a[24]||(a[24]=e("label",{class:"mb-1"},"Cabang Lomba",-1)),b(e("select",{"onUpdate:modelValue":a[4]||(a[4]=t=>n.value.branch_id=t),class:"form-control form-control-sm",required:""},[a[23]||(a[23]=e("option",{value:"",disabled:""},"-- pilih cabang --",-1)),(u(!0),i(G,null,L(U.value,t=>(u(),i("option",{key:t.id,value:t.id},[c(d(t.name)+" ",1),t.code?(u(),i("span",Fe," ("+d(t.code)+")",1)):B("",!0)],8,Ae))),128))],512),[[E,n.value.branch_id]]),a[25]||(a[25]=e("small",{class:"text-muted"},[c(" Data diambil dari master "),e("strong",null,"Branches"),c(". ")],-1))]),e("div",He,[a[26]||(a[26]=e("label",{class:"mb-1"},"Nama Cabang (Denormalisasi)",-1)),b(e("input",{"onUpdate:modelValue":a[5]||(a[5]=t=>n.value.branch_name=t),type:"text",class:"form-control form-control-sm",placeholder:"Jika kosong, akan diisi otomatis dari master branch"},null,512),[[y,n.value.branch_name]])])]),e("div",Ie,[e("div",je,[a[27]||(a[27]=e("label",{class:"mb-1"},"Nama Lengkap (Full Name)",-1)),b(e("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>n.value.full_name=t),type:"text",class:"form-control form-control-sm",placeholder:"Contoh: Cabang Tilawah Al Qur'an Dewasa"},null,512),[[y,n.value.full_name]]),a[28]||(a[28]=e("small",{class:"text-muted"}," Jika dikosongkan, dapat disamakan dengan Nama Cabang. ",-1))]),e("div",qe,[a[30]||(a[30]=e("label",{class:"mb-1"},"Status",-1)),b(e("select",{"onUpdate:modelValue":a[7]||(a[7]=t=>n.value.status=t),class:"form-control form-control-sm"},a[29]||(a[29]=[e("option",{value:"active"},"Aktif",-1),e("option",{value:"inactive"},"Nonaktif",-1)]),512),[[E,n.value.status]])]),e("div",Je,[a[31]||(a[31]=e("label",{class:"mb-1"},"Urutan Tampil",-1)),b(e("input",{"onUpdate:modelValue":a[8]||(a[8]=t=>n.value.order_number=t),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[y,n.value.order_number,void 0,{number:!0}]])])])]),e("div",Ke,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:_.value||!r.value},[_.value?(u(),i("i",ze)):(u(),i("i",Oe)),a[32]||(a[32]=c(" Simpan "))],8,Ye)])],32)])])])])])],64))}};export{Xe as default};
