import{z as te,y as M,M as ae,A as g,O as V,V as se,B as l,C as n,D as e,I as c,J as i,K as o,S as b,aB as h,as as P,U as x,ay as K,H as N,F as I,a as f,aC as le}from"./AuthUserStore-B6VIMEgo.js";import{S as m}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const ne={class:"content-header"},oe={class:"container-fluid"},re={class:"d-flex justify-content-between align-items-center"},ie={key:0,class:"mb-0 mt-1 text-sm text-muted"},ue={key:0},de={key:1},me={key:1,class:"mb-0 mt-1 text-sm text-muted"},ve={key:0},ge={class:"d-flex flex-column flex-sm-row gap-2"},ce=["disabled"],pe={key:0,class:"fas fa-spinner fa-spin mr-1"},be={key:1,class:"fas fa-magic mr-1"},fe=["disabled"],_e={key:0,class:"text-danger text-sm mt-2 mb-0"},ye={class:"content"},ke={class:"container-fluid"},he={class:"card"},xe={class:"card-header"},Ce={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},we={class:"d-flex align-items-center"},Ge={class:"card-body table-responsive p-0"},Be={class:"table table-bordered table-hover text-sm mb-0"},Ee={key:0},Me={key:1},Ke={class:"text-center"},Se={class:"text-center"},Te={class:"text-center"},Ue={class:"btn-group btn-group-sm"},De=["onClick"],Ve=["onClick"],Pe={class:"card-footer clearfix py-2"},Ne={class:"d-flex justify-content-between align-items-center"},$e={class:"text-muted text-sm"},Ie={class:"pagination pagination-sm m-0"},Le={class:"page-item disabled"},Fe={class:"page-link"},qe={class:"modal fade",id:"eventCategoryModal",tabindex:"-1",role:"dialog","aria-labelledby":"eventCategoryModalLabel"},Ae={class:"modal-dialog modal-lg",role:"document"},He={class:"modal-content"},je={class:"modal-header py-2"},ze={class:"modal-title",id:"eventCategoryModalLabel"},Je={class:"modal-body pt-2"},Ye={class:"row"},Oe={class:"col-md-6"},Re={class:"form-group mb-2"},Qe=["value"],We={key:0},Xe={class:"form-group mb-2"},Ze=["value"],et={key:0},tt={class:"form-group mb-2"},at=["value"],st={key:0},lt={class:"col-md-6"},nt={class:"form-group mb-2"},ot={class:"form-group mb-2"},rt={class:"form-group mb-2"},it={class:"text-right mt-3"},ut=["disabled"],dt={key:0,class:"fas fa-spinner fa-spin mr-1"},mt={key:1,class:"fas fa-save mr-1"},pt={__name:"EventCategories",setup(vt){const L=te(),F=ae(),k=M(()=>L.eventData||null),v=M(()=>{var s;return((s=k.value)==null?void 0:s.id)||null}),_=M(()=>{const s=F.query.branch_id;return s?Number(s):null}),y=M(()=>{const s=F.query.group_id;return s?Number(s):null}),S=g([]),T=g([]),U=g([]),q=g([]),C=g(""),w=g(10),D=g(!1),G=g(!1),B=g(!1),E=g(!1),d=g({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),r=g({id:null,branch_id:"",group_id:"",category_id:"",full_name:"",status:"active",order_number:null}),Y=async()=>{try{const[s,t,u]=await Promise.all([f.get("/api/v1/branches",{params:{simple:1}}),f.get("/api/v1/groups",{params:{simple:1}}),f.get("/api/v1/categories",{params:{simple:1}})]);T.value=s.data.data||[],U.value=t.data.data||[],q.value=u.data.data||[]}catch(s){console.error("Gagal memuat branches / groups / categories:",s),m.fire("Gagal","Gagal memuat daftar cabang, golongan, dan kategori.","error")}},p=async(s=1)=>{if(v.value){D.value=!0;try{const u=(await f.get("/api/v1/event-categories",{params:{event_id:v.value,branch_id:_.value||void 0,group_id:y.value||void 0,page:s,per_page:w.value,search:C.value,from_crud:1}})).data.data;S.value=u.data||[],d.value={current_page:u.current_page,per_page:u.per_page,total:u.total,from:u.from,to:u.to,last_page:u.last_page}}catch(t){console.error("Gagal memuat event_categories:",t),t.response&&t.response.status===401?L.logout():m.fire("Gagal","Gagal memuat data event categories.","error")}finally{D.value=!1}}},A=s=>{s<1||s>d.value.last_page||p(s)},O=()=>{if(!v.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola kategori.","warning");return}G.value=!1,r.value={id:null,branch_id:_.value||"",group_id:y.value||"",category_id:"",full_name:"",status:"active",order_number:(d.value.total||0)+1},$("#eventCategoryModal").modal("show")},R=s=>{G.value=!0,r.value={id:s.id,branch_id:s.branch_id,group_id:s.group_id,category_id:s.category_id,full_name:s.full_name,status:s.status,order_number:s.order_number},$("#eventCategoryModal").modal("show")},Q=async()=>{if(!v.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola kategori.","warning");return}B.value=!0;const s={event_id:v.value,branch_id:r.value.branch_id,group_id:r.value.group_id,category_id:r.value.category_id,full_name:r.value.full_name,status:r.value.status,order_number:r.value.order_number};try{G.value&&r.value.id?(await f.put(`/api/v1/event-categories/${r.value.id}`,s),m.fire("Berhasil","Kategori event berhasil diperbarui.","success")):(await f.post("/api/v1/event-categories",s),m.fire("Berhasil","Kategori event berhasil ditambahkan.","success")),$("#eventCategoryModal").modal("hide"),p(d.value.current_page)}catch(t){console.error("Gagal menyimpan event_category:",t);let u="Gagal menyimpan data kategori event.";t.response&&t.response.status===422&&t.response.data.message&&(u=t.response.data.message),m.fire("Gagal",u,"error")}finally{B.value=!1}},W=async s=>{if((await m.fire({title:"Hapus Kategori Event?",text:`Yakin ingin menghapus kategori "${s.full_name}" dari event ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await f.delete(`/api/v1/event-categories/${s.id}`),m.fire("Terhapus","Kategori event berhasil dihapus.","success"),p(d.value.current_page)}catch(u){console.error("Gagal menghapus event_category:",u),m.fire("Gagal","Gagal menghapus kategori event.","error")}},X=async()=>{if(!v.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum generate dari template.","warning");return}if((await m.fire({title:"Generate dari Template?",text:"Kategori event akan dibuat berdasarkan Master Categories. Kombinasi yang sudah ada tidak akan diduplikasi.",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Generate",cancelButtonText:"Batal",confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d"})).isConfirmed){E.value=!0;try{await f.post("/api/v1/event-categories/generate-from-template",{event_id:v.value}),m.fire("Berhasil","Kategori event berhasil digenerate dari template.","success"),p(1)}catch(t){console.error("Gagal generate dari template (event_categories):",t);let u="Gagal generate kategori dari template.";t.response&&t.response.data&&t.response.data.message&&(u=t.response.data.message),m.fire("Gagal",u,"error")}finally{E.value=!1}}};return V(()=>C.value,le(()=>p(1),400)),V(()=>w.value,()=>{p(1)}),V(()=>v.value,s=>{s&&p(1)}),se(()=>{Y(),v.value?p():m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(s,t)=>{var u,H,j,z,J;return n(),l(x,null,[e("section",ne,[e("div",oe,[e("div",re,[e("div",null,[t[15]||(t[15]=e("h1",{class:"mb-1"},"Kategori per Event (Event Categories)",-1)),t[16]||(t[16]=e("p",{class:"mb-0 text-muted text-sm"}," Mengatur kategori (Putra/Putri, dsb) yang diaktifkan pada event terpilih untuk setiap kombinasi Cabang + Golongan. Data ini dapat digenerate dari Master Categories lalu disesuaikan. ",-1)),_.value||y.value?(n(),l("p",ie,[t[12]||(t[12]=i(" Filter: ")),_.value?(n(),l("span",ue,[t[10]||(t[10]=i(" Cabang ")),e("strong",null,o(((u=T.value.find(a=>a.id===_.value))==null?void 0:u.name)||"ID: "+_.value),1)])):c("",!0),y.value?(n(),l("span",de,[t[11]||(t[11]=i(" • Golongan ")),e("strong",null,o(((H=U.value.find(a=>a.id===y.value))==null?void 0:H.name)||"ID: "+y.value),1)])):c("",!0)])):c("",!0),v.value?(n(),l("p",me,[t[13]||(t[13]=i(" Event aktif: ")),e("strong",null,o((j=k.value)==null?void 0:j.event_name),1),(z=k.value)!=null&&z.event_year?(n(),l("span",ve," ("+o(k.value.event_year)+")",1)):c("",!0),t[14]||(t[14]=i(" • Lokasi: ")),e("strong",null,o(((J=k.value)==null?void 0:J.event_location)||"-"),1)])):c("",!0)]),e("div",ge,[e("button",{class:"btn btn-outline-secondary btn-sm mr-sm-2 mb-2 mb-sm-0",onClick:X,disabled:E.value||!v.value},[E.value?(n(),l("i",pe)):(n(),l("i",be)),t[17]||(t[17]=i(" Generate dari Template "))],8,ce),e("button",{class:"btn btn-primary btn-sm",onClick:O,disabled:!v.value}," + Tambah Kategori ",8,fe)])]),v.value?c("",!0):(n(),l("p",_e,t[18]||(t[18]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),i(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",ye,[e("div",ke,[e("div",he,[e("div",xe,[e("div",Ce,[e("div",we,[t[20]||(t[20]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),b(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>w.value=a),class:"form-control form-control-sm w-auto mr-2"},t[19]||(t[19]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[h,w.value,void 0,{number:!0}]]),t[21]||(t[21]=e("label",{class:"mb-0 text-sm text-muted"},"Entri",-1))]),b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>C.value=a),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari cabang / golongan / kategori..."},null,512),[[P,C.value]])])]),e("div",Ge,[e("table",Be,[t[26]||(t[26]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Cabang"),e("th",null,"Golongan"),e("th",null,"Kategori"),e("th",null,"Nama Lengkap"),e("th",{style:{width:"90px"},class:"text-center"},"Status"),e("th",{style:{width:"80px"},class:"text-center"},"Urutan"),e("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[D.value?(n(),l("tr",Ee,t[22]||(t[22]=[e("td",{colspan:"8",class:"text-center"},"Memuat data event categories...",-1)]))):S.value.length===0?(n(),l("tr",Me,t[23]||(t[23]=[e("td",{colspan:"8",class:"text-center"},[i(" Belum ada kategori terdaftar untuk event ini. "),e("br"),e("small",{class:"text-muted"},[i(" Klik "),e("strong",null,"Generate dari Template"),i(" atau "),e("strong",null,"Tambah Kategori Event"),i(". ")])],-1)]))):c("",!0),(n(!0),l(x,null,K(S.value,(a,Z)=>(n(),l("tr",{key:a.id},[e("td",null,o(Z+1+(d.value.current_page-1)*d.value.per_page),1),e("td",null,[e("strong",null,o(a.branch_name),1)]),e("td",null,[e("strong",null,o(a.group_name),1)]),e("td",null,[e("strong",null,o(a.category_name),1)]),e("td",null,o(a.full_name),1),e("td",Ke,[e("span",{class:N(["badge",a.status==="active"?"badge-success":"badge-secondary"])},o(a.status==="active"?"Aktif":"Nonaktif"),3)]),e("td",Se,o(a.order_number??"-"),1),e("td",Te,[e("div",Ue,[e("button",{class:"btn btn-warning",onClick:ee=>R(a)},t[24]||(t[24]=[e("i",{class:"fas fa-edit"},null,-1)]),8,De),e("button",{class:"btn btn-danger",onClick:ee=>W(a)},t[25]||(t[25]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Ve)])])]))),128))])])]),e("div",Pe,[e("div",Ne,[e("div",$e," Menampilkan "+o(d.value.from||0)+" - "+o(d.value.to||0)+" dari "+o(d.value.total||0)+" kategori event ",1),e("ul",Ie,[e("li",{class:N(["page-item",{disabled:d.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:t[2]||(t[2]=I(a=>A(d.value.current_page-1),["prevent"]))}," « ")],2),e("li",Le,[e("span",Fe," Halaman "+o(d.value.current_page)+" / "+o(d.value.last_page||1),1)]),e("li",{class:N(["page-item",{disabled:d.value.current_page===d.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:t[3]||(t[3]=I(a=>A(d.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",qe,[e("div",Ae,[e("div",He,[e("div",je,[e("h5",ze,[t[27]||(t[27]=e("i",{class:"fas fa-venus-mars mr-1"},null,-1)),i(" "+o(G.value?"Edit Kategori Event":"Tambah Kategori Event"),1)]),t[28]||(t[28]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Je,[e("form",{onSubmit:I(Q,["prevent"])},[e("div",Ye,[e("div",Oe,[e("div",Re,[t[30]||(t[30]=e("label",{class:"mb-1"},"Cabang Lomba",-1)),b(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>r.value.branch_id=a),class:"form-control form-control-sm",required:""},[t[29]||(t[29]=e("option",{value:"",disabled:""},"-- pilih cabang --",-1)),(n(!0),l(x,null,K(T.value,a=>(n(),l("option",{key:a.id,value:a.id},[i(o(a.name)+" ",1),a.code?(n(),l("span",We," ("+o(a.code)+")",1)):c("",!0)],8,Qe))),128))],512),[[h,r.value.branch_id]]),t[31]||(t[31]=e("small",{class:"text-muted"},[i(" Data diambil dari master "),e("strong",null,"Branches"),i(". ")],-1))]),e("div",Xe,[t[33]||(t[33]=e("label",{class:"mb-1"},"Golongan",-1)),b(e("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>r.value.group_id=a),class:"form-control form-control-sm",required:""},[t[32]||(t[32]=e("option",{value:"",disabled:""},"-- pilih golongan --",-1)),(n(!0),l(x,null,K(U.value,a=>(n(),l("option",{key:a.id,value:a.id},[i(o(a.name)+" ",1),a.code?(n(),l("span",et," ("+o(a.code)+")",1)):c("",!0)],8,Ze))),128))],512),[[h,r.value.group_id]]),t[34]||(t[34]=e("small",{class:"text-muted"},[i(" Data diambil dari master "),e("strong",null,"Groups"),i(". ")],-1))]),e("div",tt,[t[36]||(t[36]=e("label",{class:"mb-1"},"Kategori",-1)),b(e("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>r.value.category_id=a),class:"form-control form-control-sm",required:""},[t[35]||(t[35]=e("option",{value:"",disabled:""},"-- pilih kategori --",-1)),(n(!0),l(x,null,K(q.value,a=>(n(),l("option",{key:a.id,value:a.id},[i(o(a.name)+" ",1),a.code?(n(),l("span",st," ("+o(a.code)+")",1)):c("",!0)],8,at))),128))],512),[[h,r.value.category_id]]),t[37]||(t[37]=e("small",{class:"text-muted"},[i(" Data diambil dari master "),e("strong",null,"Categories"),i(". ")],-1))])]),e("div",lt,[e("div",nt,[t[38]||(t[38]=e("label",{class:"mb-1"},"Nama Lengkap (Full Name)",-1)),b(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>r.value.full_name=a),type:"text",class:"form-control form-control-sm",placeholder:"Contoh: Hafalan 10 Juz - Remaja - Putra"},null,512),[[P,r.value.full_name]]),t[39]||(t[39]=e("small",{class:"text-muted"}," Jika dikosongkan, akan digenerate dari Cabang + Golongan + Kategori. ",-1))]),e("div",ot,[t[41]||(t[41]=e("label",{class:"mb-1"},"Status",-1)),b(e("select",{"onUpdate:modelValue":t[8]||(t[8]=a=>r.value.status=a),class:"form-control form-control-sm"},t[40]||(t[40]=[e("option",{value:"active"},"Aktif",-1),e("option",{value:"inactive"},"Nonaktif",-1)]),512),[[h,r.value.status]])]),e("div",rt,[t[42]||(t[42]=e("label",{class:"mb-1"},"Urutan Tampil",-1)),b(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>r.value.order_number=a),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[P,r.value.order_number,void 0,{number:!0}]])])])]),e("div",it,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:B.value||!v.value},[B.value?(n(),l("i",dt)):(n(),l("i",mt)),t[43]||(t[43]=i(" Simpan "))],8,ut)])],32)])])])])])],64)}}};export{pt as default};
