import{z as X,y as E,M as Z,A as c,O as V,V as ee,B as n,C as o,D as e,I as p,K as u,J as r,S as b,aB as h,as as D,U as k,ay as K,H as P,F as N,a as f,aC as te}from"./AuthUserStore-D7C5-kPo.js";import{S as m}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const ae={class:"content-header"},se={class:"container-fluid"},le={class:"d-flex justify-content-between align-items-center"},ne={key:0,class:"mb-0 mt-1 text-sm text-muted"},oe={key:0},re={key:1},ie={class:"d-flex flex-column flex-sm-row gap-2"},ue=["disabled"],de={key:0,class:"fas fa-spinner fa-spin mr-1"},me={key:1,class:"fas fa-magic mr-1"},ve=["disabled"],ce={key:0,class:"text-danger text-sm mt-2 mb-0"},ge={class:"content"},pe={class:"container-fluid"},be={class:"card"},fe={class:"card-header"},_e={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},ye={class:"d-flex align-items-center"},he={class:"card-body table-responsive p-0"},ke={class:"table table-bordered table-hover text-sm mb-0"},xe={key:0},Ce={key:1},we={class:"text-center"},Ge={class:"text-center"},Be={class:"text-center"},Ee={class:"btn-group btn-group-sm"},Ke=["onClick"],Me=["onClick"],Se={class:"card-footer clearfix py-2"},Te={class:"d-flex justify-content-between align-items-center"},Ue={class:"text-muted text-sm"},Ve={class:"pagination pagination-sm m-0"},De={class:"page-item disabled"},Pe={class:"page-link"},Ne={class:"modal fade",id:"eventCategoryModal",tabindex:"-1",role:"dialog","aria-labelledby":"eventCategoryModalLabel"},$e={class:"modal-dialog modal-lg",role:"document"},Ie={class:"modal-content"},Fe={class:"modal-header py-2"},Le={class:"modal-title",id:"eventCategoryModalLabel"},qe={class:"modal-body pt-2"},Ae={class:"row"},He={class:"col-md-6"},je={class:"form-group mb-2"},ze=["value"],Je={key:0},Ye={class:"form-group mb-2"},Oe=["value"],Re={key:0},Qe={class:"form-group mb-2"},We=["value"],Xe={key:0},Ze={class:"col-md-6"},et={class:"form-group mb-2"},tt={class:"form-group mb-2"},at={class:"form-group mb-2"},st={class:"text-right mt-3"},lt=["disabled"],nt={key:0,class:"fas fa-spinner fa-spin mr-1"},ot={key:1,class:"fas fa-save mr-1"},dt={__name:"EventCategories",setup(rt){const I=X(),F=Z(),H=E(()=>I.eventData||null),v=E(()=>{var s;return((s=H.value)==null?void 0:s.id)||null}),_=E(()=>{const s=F.query.branch_id;return s?Number(s):null}),y=E(()=>{const s=F.query.group_id;return s?Number(s):null}),M=c([]),S=c([]),T=c([]),L=c([]),x=c(""),C=c(10),U=c(!1),w=c(!1),G=c(!1),B=c(!1),d=c({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),l=c({id:null,branch_id:"",group_id:"",category_id:"",full_name:"",status:"active",order_number:null}),j=async()=>{try{const[s,t,i]=await Promise.all([f.get("/api/v1/branches",{params:{simple:1}}),f.get("/api/v1/groups",{params:{simple:1}}),f.get("/api/v1/categories",{params:{simple:1}})]);S.value=s.data.data||[],T.value=t.data.data||[],L.value=i.data.data||[]}catch(s){console.error("Gagal memuat branches / groups / categories:",s),m.fire("Gagal","Gagal memuat daftar cabang, golongan, dan kategori.","error")}},g=async(s=1)=>{if(v.value){U.value=!0;try{const i=(await f.get("/api/v1/event-categories",{params:{event_id:v.value,branch_id:_.value||void 0,group_id:y.value||void 0,page:s,per_page:C.value,search:x.value,from_crud:1}})).data.data;M.value=i.data||[],d.value={current_page:i.current_page,per_page:i.per_page,total:i.total,from:i.from,to:i.to,last_page:i.last_page}}catch(t){console.error("Gagal memuat event_categories:",t),t.response&&t.response.status===401?I.logout():m.fire("Gagal","Gagal memuat data event categories.","error")}finally{U.value=!1}}},q=s=>{s<1||s>d.value.last_page||g(s)},z=()=>{if(!v.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola kategori.","warning");return}w.value=!1,l.value={id:null,branch_id:_.value||"",group_id:y.value||"",category_id:"",full_name:"",status:"active",order_number:(d.value.total||0)+1},$("#eventCategoryModal").modal("show")},J=s=>{w.value=!0,l.value={id:s.id,branch_id:s.branch_id,group_id:s.group_id,category_id:s.category_id,full_name:s.full_name,status:s.status,order_number:s.order_number},$("#eventCategoryModal").modal("show")},Y=async()=>{if(!v.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola kategori.","warning");return}G.value=!0;const s={event_id:v.value,branch_id:l.value.branch_id,group_id:l.value.group_id,category_id:l.value.category_id,full_name:l.value.full_name,status:l.value.status,order_number:l.value.order_number};try{w.value&&l.value.id?(await f.put(`/api/v1/event-categories/${l.value.id}`,s),m.fire("Berhasil","Kategori event berhasil diperbarui.","success")):(await f.post("/api/v1/event-categories",s),m.fire("Berhasil","Kategori event berhasil ditambahkan.","success")),$("#eventCategoryModal").modal("hide"),g(d.value.current_page)}catch(t){console.error("Gagal menyimpan event_category:",t);let i="Gagal menyimpan data kategori event.";t.response&&t.response.status===422&&t.response.data.message&&(i=t.response.data.message),m.fire("Gagal",i,"error")}finally{G.value=!1}},O=async s=>{if((await m.fire({title:"Hapus Kategori Event?",text:`Yakin ingin menghapus kategori "${s.full_name}" dari event ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await f.delete(`/api/v1/event-categories/${s.id}`),m.fire("Terhapus","Kategori event berhasil dihapus.","success"),g(d.value.current_page)}catch(i){console.error("Gagal menghapus event_category:",i),m.fire("Gagal","Gagal menghapus kategori event.","error")}},R=async()=>{if(!v.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum generate dari template.","warning");return}if((await m.fire({title:"Generate dari Template?",text:"Kategori event akan dibuat berdasarkan Master Categories. Kombinasi yang sudah ada tidak akan diduplikasi.",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Generate",cancelButtonText:"Batal",confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d"})).isConfirmed){B.value=!0;try{await f.post("/api/v1/event-categories/generate-from-template",{event_id:v.value}),m.fire("Berhasil","Kategori event berhasil digenerate dari template.","success"),g(1)}catch(t){console.error("Gagal generate dari template (event_categories):",t);let i="Gagal generate kategori dari template.";t.response&&t.response.data&&t.response.data.message&&(i=t.response.data.message),m.fire("Gagal",i,"error")}finally{B.value=!1}}};return V(()=>x.value,te(()=>g(1),400)),V(()=>C.value,()=>{g(1)}),V(()=>v.value,s=>{s&&g(1)}),ee(()=>{j(),v.value?g():m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(s,t)=>{var i,A;return o(),n(k,null,[e("section",ae,[e("div",se,[e("div",le,[e("div",null,[t[13]||(t[13]=e("h1",{class:"mb-1"},"Kategori per Event (Event Categories)",-1)),t[14]||(t[14]=e("p",{class:"mb-0 text-muted text-sm"}," Mengatur kategori (Putra/Putri, dsb) yang diaktifkan pada event terpilih untuk setiap kombinasi Cabang + Golongan. ",-1)),_.value||y.value?(o(),n("p",ne,[t[12]||(t[12]=u(" Filter: ")),_.value?(o(),n("span",oe,[t[10]||(t[10]=u(" Cabang ")),e("strong",null,r(((i=S.value.find(a=>a.id===_.value))==null?void 0:i.name)||"ID: "+_.value),1)])):p("",!0),y.value?(o(),n("span",re,[t[11]||(t[11]=u(" • Golongan ")),e("strong",null,r(((A=T.value.find(a=>a.id===y.value))==null?void 0:A.name)||"ID: "+y.value),1)])):p("",!0)])):p("",!0)]),e("div",ie,[e("button",{class:"btn btn-outline-secondary btn-sm mr-sm-2 mb-2 mb-sm-0",onClick:R,disabled:B.value||!v.value},[B.value?(o(),n("i",de)):(o(),n("i",me)),t[15]||(t[15]=u(" Generate dari Template "))],8,ue),e("button",{class:"btn btn-primary btn-sm",onClick:z,disabled:!v.value}," + Tambah Kategori ",8,ve)])]),v.value?p("",!0):(o(),n("p",ce,t[16]||(t[16]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),u(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",ge,[e("div",pe,[e("div",be,[e("div",fe,[e("div",_e,[e("div",ye,[t[18]||(t[18]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),b(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>C.value=a),class:"form-control form-control-sm w-auto mr-2"},t[17]||(t[17]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[h,C.value,void 0,{number:!0}]]),t[19]||(t[19]=e("label",{class:"mb-0 text-sm text-muted"},"Entri",-1))]),b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>x.value=a),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari cabang / golongan / kategori..."},null,512),[[D,x.value]])])]),e("div",he,[e("table",ke,[t[24]||(t[24]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Cabang"),e("th",null,"Golongan"),e("th",null,"Kategori"),e("th",null,"Nama Lengkap"),e("th",{style:{width:"90px"},class:"text-center"},"Status"),e("th",{style:{width:"80px"},class:"text-center"},"Urutan"),e("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[U.value?(o(),n("tr",xe,t[20]||(t[20]=[e("td",{colspan:"8",class:"text-center"},"Memuat data event categories...",-1)]))):M.value.length===0?(o(),n("tr",Ce,t[21]||(t[21]=[e("td",{colspan:"8",class:"text-center"},[u(" Belum ada kategori terdaftar untuk event ini. "),e("br"),e("small",{class:"text-muted"},[u(" Klik "),e("strong",null,"Generate dari Template"),u(" atau "),e("strong",null,"Tambah Kategori Event"),u(". ")])],-1)]))):p("",!0),(o(!0),n(k,null,K(M.value,(a,Q)=>(o(),n("tr",{key:a.id},[e("td",null,r(Q+1+(d.value.current_page-1)*d.value.per_page),1),e("td",null,[e("strong",null,r(a.branch_name),1)]),e("td",null,[e("strong",null,r(a.group_name),1)]),e("td",null,[e("strong",null,r(a.category_name),1)]),e("td",null,r(a.full_name),1),e("td",we,[e("span",{class:P(["badge",a.status==="active"?"badge-success":"badge-secondary"])},r(a.status==="active"?"Aktif":"Nonaktif"),3)]),e("td",Ge,r(a.order_number??"-"),1),e("td",Be,[e("div",Ee,[e("button",{class:"btn btn-warning",onClick:W=>J(a)},t[22]||(t[22]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Ke),e("button",{class:"btn btn-danger",onClick:W=>O(a)},t[23]||(t[23]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Me)])])]))),128))])])]),e("div",Se,[e("div",Te,[e("div",Ue," Menampilkan "+r(d.value.from||0)+" - "+r(d.value.to||0)+" dari "+r(d.value.total||0)+" kategori event ",1),e("ul",Ve,[e("li",{class:P(["page-item",{disabled:d.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:t[2]||(t[2]=N(a=>q(d.value.current_page-1),["prevent"]))}," « ")],2),e("li",De,[e("span",Pe," Halaman "+r(d.value.current_page)+" / "+r(d.value.last_page||1),1)]),e("li",{class:P(["page-item",{disabled:d.value.current_page===d.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:t[3]||(t[3]=N(a=>q(d.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",Ne,[e("div",$e,[e("div",Ie,[e("div",Fe,[e("h5",Le,[t[25]||(t[25]=e("i",{class:"fas fa-venus-mars mr-1"},null,-1)),u(" "+r(w.value?"Edit Kategori Event":"Tambah Kategori Event"),1)]),t[26]||(t[26]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",qe,[e("form",{onSubmit:N(Y,["prevent"])},[e("div",Ae,[e("div",He,[e("div",je,[t[28]||(t[28]=e("label",{class:"mb-1"},"Cabang Lomba",-1)),b(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>l.value.branch_id=a),class:"form-control form-control-sm",required:""},[t[27]||(t[27]=e("option",{value:"",disabled:""},"-- pilih cabang --",-1)),(o(!0),n(k,null,K(S.value,a=>(o(),n("option",{key:a.id,value:a.id},[u(r(a.name)+" ",1),a.code?(o(),n("span",Je," ("+r(a.code)+")",1)):p("",!0)],8,ze))),128))],512),[[h,l.value.branch_id]]),t[29]||(t[29]=e("small",{class:"text-muted"},[u(" Data diambil dari master "),e("strong",null,"Branches"),u(". ")],-1))]),e("div",Ye,[t[31]||(t[31]=e("label",{class:"mb-1"},"Golongan",-1)),b(e("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>l.value.group_id=a),class:"form-control form-control-sm",required:""},[t[30]||(t[30]=e("option",{value:"",disabled:""},"-- pilih golongan --",-1)),(o(!0),n(k,null,K(T.value,a=>(o(),n("option",{key:a.id,value:a.id},[u(r(a.name)+" ",1),a.code?(o(),n("span",Re," ("+r(a.code)+")",1)):p("",!0)],8,Oe))),128))],512),[[h,l.value.group_id]]),t[32]||(t[32]=e("small",{class:"text-muted"},[u(" Data diambil dari master "),e("strong",null,"Groups"),u(". ")],-1))]),e("div",Qe,[t[34]||(t[34]=e("label",{class:"mb-1"},"Kategori",-1)),b(e("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>l.value.category_id=a),class:"form-control form-control-sm",required:""},[t[33]||(t[33]=e("option",{value:"",disabled:""},"-- pilih kategori --",-1)),(o(!0),n(k,null,K(L.value,a=>(o(),n("option",{key:a.id,value:a.id},[u(r(a.name)+" ",1),a.code?(o(),n("span",Xe," ("+r(a.code)+")",1)):p("",!0)],8,We))),128))],512),[[h,l.value.category_id]]),t[35]||(t[35]=e("small",{class:"text-muted"},[u(" Data diambil dari master "),e("strong",null,"Categories"),u(". ")],-1))])]),e("div",Ze,[e("div",et,[t[36]||(t[36]=e("label",{class:"mb-1"},"Nama Lengkap (Full Name)",-1)),b(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>l.value.full_name=a),type:"text",class:"form-control form-control-sm",placeholder:"Contoh: Hafalan 10 Juz - Remaja - Putra"},null,512),[[D,l.value.full_name]]),t[37]||(t[37]=e("small",{class:"text-muted"}," Jika dikosongkan, akan digenerate dari Cabang + Golongan + Kategori. ",-1))]),e("div",tt,[t[39]||(t[39]=e("label",{class:"mb-1"},"Status",-1)),b(e("select",{"onUpdate:modelValue":t[8]||(t[8]=a=>l.value.status=a),class:"form-control form-control-sm"},t[38]||(t[38]=[e("option",{value:"active"},"Aktif",-1),e("option",{value:"inactive"},"Nonaktif",-1)]),512),[[h,l.value.status]])]),e("div",at,[t[40]||(t[40]=e("label",{class:"mb-1"},"Urutan Tampil",-1)),b(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>l.value.order_number=a),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[D,l.value.order_number,void 0,{number:!0}]])])])]),e("div",st,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:G.value||!v.value},[G.value?(o(),n("i",nt)):(o(),n("i",ot)),t[41]||(t[41]=u(" Simpan "))],8,lt)])],32)])])])])])],64)}}};export{dt as default};
