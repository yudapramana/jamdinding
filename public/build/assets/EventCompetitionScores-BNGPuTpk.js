import{z as at,y as C,I as lt,J as p,K as R,V as it,A as a,B as l,C as t,O as D,S as f,M as i,G as Q,R as O,aB as W,U as g,ay as h,as as rt,aF as ut,a as q,H as dt,D as ct}from"./AuthUserStore-Du_wEH36.js";import{S as X}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{_ as mt}from"./app-D2SkCNoG.js";const vt={class:"content-header"},_t={class:"container-fluid"},pt={class:"d-flex justify-content-between align-items-center"},gt={class:"mb-0 text-muted text-sm"},ft={key:0,class:"ml-2"},ht={key:0,class:"mb-0 mt-1 text-sm text-muted"},bt={key:0},yt=["disabled"],kt={class:"row mt-3"},xt={class:"col-md-12 mb-2"},St=["disabled"],wt=["label"],Ct=["value"],At={key:0,class:"text-muted"},Mt={class:"row"},Ut={class:"col-md-6 mb-2"},Et=["placeholder","disabled"],Nt={class:"col-md-3 mb-2"},Tt=["disabled"],jt={class:"col-md-3 mb-2"},Bt=["disabled"],Kt={key:0,class:"mb-2"},Vt={class:"nav nav-pills"},Dt=["onClick"],It={class:"badge badge-light border ml-2"},Pt={class:"content"},Rt={class:"container-fluid"},$t={class:"card"},Lt={class:"card-body table-responsive p-0"},Ft={key:0,class:"table table-bordered table-hover text-sm mb-0"},Gt={class:"thead-light"},Ot={key:0},qt=["colspan"],zt={key:1},Ht=["colspan"],Jt={key:2},Qt=["colspan"],Wt={class:"text-center"},Xt={class:"font-weight-bold"},Yt={class:"text-muted"},Zt={class:"text-sm"},te={class:"text-center font-weight-bold"},ee={class:"text-center"},se={key:1,class:"table table-bordered table-hover text-sm mb-0"},ne={class:"thead-light"},oe={key:0},ae=["colspan"],le={key:1},ie=["colspan"],re={key:2},ue=["colspan"],de={class:"font-weight-bold"},ce={class:"text-muted"},me={class:"d-flex flex-column align-items-center"},ve={class:"btn-group btn-group-sm mt-1"},_e=["disabled","onClick"],pe=["disabled","onClick"],ge={class:"text-muted mt-1"},fe={class:"text-center font-weight-bold"},he={class:"text-center"},be={class:"card-footer text-muted text-sm"},ye={__name:"EventCompetitionScores",setup(ke){const A=lt(),Y=dt(),Z=at(),j=C(()=>Z.eventData||null),B=C(()=>{var n;return((n=j.value)==null?void 0:n.id)||null}),z=C(()=>String(A.params.id||"")),I=p(!1),H=p([]),m=p(String(A.params.id||"")),M=p(!1),$=p(""),L=p(""),U=p(null),v=p([]),b=p([]),E=n=>Number(n||0).toFixed(2),_=C(()=>{var e;const n=U.value||{};return typeof n.is_team<"u"?!!n.is_team:!!((e=n==null?void 0:n.event_group)!=null&&e.is_team)}),tt=async()=>{if(B.value){I.value=!0;try{const{data:n}=await q.get(`/api/v1/events/${B.value}/competitions/tree`,{params:{search:""}});H.value=n.rounds||[]}catch(n){console.error(n),X.fire("Gagal","Gagal memuat daftar kompetisi.","error")}finally{I.value=!1}}},y=async()=>{const n=m.value||z.value;if(!n){U.value=null,v.value=[],b.value=[];return}M.value=!0;try{const{data:e}=await q.get(`/api/v1/event-competitions/${n}/scores`,{params:{search:$.value||void 0,status:L.value||void 0}});U.value=e.competition,v.value=e.judges||[],b.value=e.participants||[]}finally{M.value=!1}},J=async(n,e)=>{const d=m.value||z.value;!d||!n||(await q.patch(`/api/v1/event-competitions/${d}/scoresheets/${n}`,e),await y())},et=async n=>{n&&(A.name!=="admin.event.scores.index"||String(A.params.id)!==String(n))&&await Y.replace({name:"admin.event.scores.index",params:{id:String(n)},query:{...A.query}})},k=p("all"),F=C(()=>{var S,x,c;if(_.value)return[{id:"all",name:"SEMUA KONTINGEN",count:(b.value||[]).length}];const n=new Map;for(const s of b.value||[]){const o=s.event_category_id??((S=s.event_category)==null?void 0:S.id)??null,r=s.category_name??((x=s.event_category)==null?void 0:x.category_name)??((c=s.event_category)==null?void 0:c.full_name)??s.category??null;o&&(n.has(String(o))||n.set(String(o),{id:String(o),name:String(r||"Kategori"),count:0}),n.get(String(o)).count++)}const e=Array.from(n.values()),d=s=>{const o=(s||"").toLowerCase();return o.includes("putera")||o.includes("putra")?1:o.includes("puteri")||o.includes("putri")?2:99};return e.sort((s,o)=>{const r=d(s.name),u=d(o.name);return r!==u?r-u:s.name.localeCompare(o.name)}),[{id:"all",name:"SEMUA PESERTA",count:(b.value||[]).length},...e.map(s=>({id:s.id,name:`PESERTA ${s.name.toUpperCase()}`,count:s.count}))]}),P=C(()=>{const n=b.value||[];return k.value==="all"||_.value?n:n.filter(e=>String(e.event_category_id||"")===String(k.value))});R(()=>b.value,()=>{if(k.value==="all")return;(F.value||[]).some(e=>e.id===k.value)||(k.value="all")}),R(()=>_.value,()=>{k.value="all"});const G=C(()=>{var x;if(!_.value)return[];const n=P.value||[],e=new Map;for(const c of n){const s=String(c.contingent||"-");e.has(s)||e.set(s,{contingent:s,members:[],judgeScores:{}});const o=e.get(s);o.members.push(c.full_name||"-");for(const r of v.value||[]){const u=r.id,N=Number(((x=c.scores)==null?void 0:x[u])??0);o.judgeScores[u]||(o.judgeScores[u]=[]),c.scores&&typeof c.scores[u]<"u"&&o.judgeScores[u].push(N)}}const d=[],S=Array.from(e.keys()).sort((c,s)=>c==="-"?1:s==="-"?-1:c.localeCompare(s));for(const c of S){const s=e.get(c),o={};let r=0,u=0;for(const K of v.value||[]){const T=K.id,V=s.judgeScores[T]||[],w=V.length?V.reduce((nt,ot)=>nt+ot,0)/V.length:0;o[T]=Number(w.toFixed(2)),r+=o[T],u++}const N=u?r/u:0;d.push({contingent:s.contingent,members:s.members,member_count:s.members.length,scores:o,sum_score:Number(r.toFixed(2)),avg_score:Number(N.toFixed(2))})}return d}),st=(n=[],e=6)=>{const d=Array.isArray(n)?n.filter(Boolean):[];return d.length?d.length<=e?d.join(", "):`${d.slice(0,e).join(", ")}, ...`:"-"};return it(async()=>{if(!B.value){X.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info");return}await tt(),m.value&&await y()}),R(()=>A.params.id,async n=>{const e=String(n||"");m.value=e,await y()}),R(()=>m.value,async n=>{if(!n){U.value=null,v.value=[],b.value=[];return}await et(n),await y()}),(n,e)=>{var d,S,x,c;return l(),a(g,null,[t("section",vt,[t("div",_t,[t("div",pt,[t("div",null,[e[5]||(e[5]=t("h1",{class:"mb-1"},"Rekap Nilai Kompetisi",-1)),t("p",gt,[f(i(((d=U.value)==null?void 0:d.full_name)||"Pilih kompetisi terlebih dahulu.")+" ",1),m.value&&U.value?(l(),a("span",ft,[t("span",{class:Q(["badge",_.value?"badge-info":"badge-secondary"])},i(_.value?"TEAM / GROUP (By Kontingen)":"INDIVIDU"),3)])):D("",!0)]),B.value?(l(),a("p",ht,[e[3]||(e[3]=f(" Event aktif: ")),t("strong",null,i((S=j.value)==null?void 0:S.event_name),1),(x=j.value)!=null&&x.event_year?(l(),a("span",bt," ("+i(j.value.event_year)+")",1)):D("",!0),e[4]||(e[4]=f(" â€¢ Lokasi: ")),t("strong",null,i(((c=j.value)==null?void 0:c.event_location)||"-"),1)])):D("",!0)]),t("button",{class:"btn btn-sm btn-outline-secondary",onClick:y,disabled:M.value||!m.value},e[6]||(e[6]=[t("i",{class:"fas fa-sync"},null,-1),f(" Refresh ")]),8,yt)]),t("div",kt,[t("div",xt,[e[9]||(e[9]=t("label",{class:"mb-1 text-sm"},[f("Kompetisi "),t("span",{class:"text-danger"},"*")],-1)),O(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),class:"form-control form-control-sm",disabled:!B.value||I.value},[e[7]||(e[7]=t("option",{value:"",disabled:""},"-- Pilih Kompetisi --",-1)),(l(!0),a(g,null,h(H.value,s=>(l(),a("optgroup",{key:"round-"+s.id,label:s.name},[(l(!0),a(g,null,h(s.competitions,o=>(l(),a("option",{key:o.id,value:String(o.id)},i(o.full_name),9,Ct))),128))],8,wt))),128))],8,St),[[W,m.value]]),I.value?(l(),a("small",At,e[8]||(e[8]=[t("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),f(" Memuat daftar kompetisi... ")]))):D("",!0)])]),t("div",Mt,[t("div",Ut,[O(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>$.value=s),class:"form-control form-control-sm",placeholder:_.value?"Cari nama kontingen/anggota...":"Cari nama peserta...",disabled:!m.value,onKeyup:ut(y,["enter"])},null,40,Et),[[rt,$.value]])]),t("div",Nt,[O(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>L.value=s),class:"form-control form-control-sm",disabled:!m.value,onChange:y},e[10]||(e[10]=[t("option",{value:""},"Semua Status",-1),t("option",{value:"draft"},"Draft",-1),t("option",{value:"submitted"},"Submitted",-1),t("option",{value:"locked"},"Locked",-1)]),40,Tt),[[W,L.value]])]),t("div",jt,[t("button",{class:"btn btn-sm btn-primary w-100",onClick:y,disabled:M.value||!m.value},e[11]||(e[11]=[t("i",{class:"fas fa-search"},null,-1),f(" Filter ")]),8,Bt)])]),m.value&&!_.value&&F.value.length?(l(),a("div",Kt,[t("ul",Vt,[(l(!0),a(g,null,h(F.value,s=>(l(),a("li",{class:"nav-item",key:"tab-"+s.id},[t("a",{href:"#",class:Q(["nav-link",{active:k.value===s.id}]),onClick:ct(o=>k.value=s.id,["prevent"]),style:{"font-weight":"600"}},[f(i(s.name)+" ",1),t("span",It,i(s.count),1)],10,Dt)]))),128))])])):D("",!0)])]),t("section",Pt,[t("div",Rt,[t("div",$t,[t("div",Lt,[_.value?(l(),a("table",Ft,[t("thead",Gt,[t("tr",null,[e[12]||(e[12]=t("th",{style:{width:"50px"}},"#",-1)),e[13]||(e[13]=t("th",{style:{"min-width":"220px"}},"Kontingen",-1)),e[14]||(e[14]=t("th",{style:{"min-width":"420px"}},"Anggota",-1)),(l(!0),a(g,null,h(v.value,s=>(l(),a("th",{key:s.id,class:"text-center"},i(s.name),1))),128)),e[15]||(e[15]=t("th",{class:"text-center"},"AVG",-1)),e[16]||(e[16]=t("th",{class:"text-center"},"SUM",-1))])]),t("tbody",null,[m.value?M.value?(l(),a("tr",zt,[t("td",{colspan:5+v.value.length,class:"text-center p-3 text-muted"},"Loading...",8,Ht)])):G.value.length===0?(l(),a("tr",Jt,[t("td",{colspan:5+v.value.length,class:"text-center p-3 text-muted"},"Tidak ada data.",8,Qt)])):(l(!0),a(g,{key:3},h(G.value,(s,o)=>(l(),a("tr",{key:"cont-"+s.contingent},[t("td",Wt,i(o+1),1),t("td",null,[t("div",Xt,i(s.contingent),1),t("small",Yt,i(s.member_count)+" anggota",1)]),t("td",null,[t("div",Zt,i(st(s.members,10)),1)]),(l(!0),a(g,null,h(v.value,r=>{var u;return l(),a("td",{key:r.id,class:"text-center font-weight-bold"},i(E((u=s.scores)==null?void 0:u[r.id])),1)}),128)),t("td",te,i(E(s.avg_score)),1),t("td",ee,i(E(s.sum_score)),1)]))),128)):(l(),a("tr",Ot,[t("td",{colspan:5+v.value.length,class:"text-center p-3 text-muted"}," Silakan pilih kompetisi terlebih dahulu. ",8,qt)]))])])):(l(),a("table",se,[t("thead",ne,[t("tr",null,[e[17]||(e[17]=t("th",{style:{width:"50px"}},"#",-1)),e[18]||(e[18]=t("th",null,"Peserta",-1)),e[19]||(e[19]=t("th",null,"Kontingen",-1)),(l(!0),a(g,null,h(v.value,s=>(l(),a("th",{key:s.id,class:"text-center"},i(s.name),1))),128)),e[20]||(e[20]=t("th",{class:"text-center"},"AVG",-1)),e[21]||(e[21]=t("th",{class:"text-center"},"SUM",-1))])]),t("tbody",null,[m.value?M.value?(l(),a("tr",le,[t("td",{colspan:6+v.value.length,class:"text-center p-3 text-muted"},"Loading...",8,ie)])):P.value.length===0?(l(),a("tr",re,[t("td",{colspan:6+v.value.length,class:"text-center p-3 text-muted"},"Tidak ada data.",8,ue)])):(l(!0),a(g,{key:3},h(P.value,(s,o)=>(l(),a("tr",{key:s.event_participant_id||o},[t("td",null,i(o+1),1),t("td",null,[t("div",de,i(s.full_name),1),t("small",ce,i(s.category_name||"-"),1)]),t("td",null,i(s.contingent||"-"),1),(l(!0),a(g,null,h(v.value,r=>{var u,N,K,T;return l(),a("td",{key:r.id,class:"text-center"},[t("div",me,[t("span",null,i(E((u=s.scores)==null?void 0:u[r.id])),1),t("div",ve,[t("button",{class:"btn btn-outline-secondary",disabled:!((N=s.scoresheet_id_by_judge)!=null&&N[r.id]),onClick:V=>{var w;return J((w=s.scoresheet_id_by_judge)==null?void 0:w[r.id],{status:"locked"})},title:"Lock"},e[22]||(e[22]=[t("i",{class:"fas fa-lock"},null,-1)]),8,_e),t("button",{class:"btn btn-outline-secondary",disabled:!((K=s.scoresheet_id_by_judge)!=null&&K[r.id]),onClick:V=>{var w;return J((w=s.scoresheet_id_by_judge)==null?void 0:w[r.id],{status:"submitted"})},title:"Unlock (Submitted)"},e[23]||(e[23]=[t("i",{class:"fas fa-unlock"},null,-1)]),8,pe)]),t("small",ge,i(((T=s.status_by_judge)==null?void 0:T[r.id])||"-"),1)])])}),128)),t("td",fe,i(E(s.avg_score)),1),t("td",he,i(E(s.sum_score)),1)]))),128)):(l(),a("tr",oe,[t("td",{colspan:6+v.value.length,class:"text-center p-3 text-muted"}," Silakan pilih kompetisi terlebih dahulu. ",8,ae)]))])]))]),t("div",be,[e[24]||(e[24]=f(" Total: ")),t("strong",null,i(_.value?G.value.length+" kontingen":P.value.length+" peserta"),1)])])])])],64)}}},Ce=mt(ye,[["__scopeId","data-v-c518e4bd"]]);export{Ce as default};
