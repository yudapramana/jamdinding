import{z as pe,y as S,A as w,M as ge,O as W,V as he,B as l,C as o,D as e,I as R,J as M,K as r,H as ne,S as X,aB as se,U as m,ay as x,as as be,aF as ye,a as le,L as xe,F as ke}from"./AuthUserStore-B6VIMEgo.js";import{S as oe}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{_ as we}from"./app-DdJgNepn.js";const Ce={class:"content-header"},Se={class:"container-fluid"},Me={class:"d-flex justify-content-between align-items-center"},Ne={class:"mb-0 text-muted text-sm"},$e={key:0,class:"ml-2"},je={key:0,class:"mb-0 mt-1 text-sm text-muted"},Ie={key:0},Ae=["disabled"],De={class:"row mt-3"},Fe={class:"col-md-12 mb-2"},Be=["disabled"],Ke=["label"],Te=["value"],Ue={key:0,class:"text-muted"},Ve={class:"row"},Le={class:"col-md-6 mb-2"},Pe=["placeholder","disabled"],Re={class:"col-md-3 mb-2"},Ee=["disabled"],Ge={class:"col-md-3 mb-2"},qe=["disabled"],ze={key:0,class:"mb-2"},He={class:"nav nav-pills"},Je=["onClick"],Oe={class:"badge badge-light border ml-2"},Qe={class:"content"},We={class:"container-fluid"},Xe={class:"card"},Ye={class:"card-body table-responsive p-0"},Ze={class:"table table-bordered table-hover text-sm mb-0"},et={class:"thead-light"},tt=["colspan"],nt={key:0},st=["colspan"],lt={key:1},ot=["colspan"],at={key:2},it=["colspan"],rt={key:3},dt=["colspan"],ut={class:"text-center"},ct={class:"font-weight-bold"},vt={class:"text-center font-weight-bold"},mt={class:"text-center font-weight-bold"},_t={class:"text-center font-weight-bold"},ft={class:"text-center"},pt={class:"text-center"},gt={class:"font-weight-bold"},ht={class:"text-center font-weight-bold"},bt={class:"text-center font-weight-bold"},yt={class:"text-center"},xt={class:"card-footer text-muted text-sm"},kt={__name:"EventCompetitionScoresDetail",setup(wt){const E=ge(),ae=xe(),ie=pe(),B=S(()=>ie.eventData||null),K=S(()=>{var s;return((s=B.value)==null?void 0:s.id)||null}),T=w("all"),_=w(String(E.params.id||"")),Y=S(()=>_.value||null),G=w(!1),Z=w([]),U=w(!1),J=w(""),O=w(""),V=w(null),b=w([]),A=w([]),C=w([]),y=S(()=>{var n;const s=V.value||{};return typeof s.is_team<"u"?!!s.is_team:!!((n=s==null?void 0:s.event_group)!=null&&n.is_team)}),ee=S(()=>{const s=A.value||[];if(y.value)return[{id:"all",name:"Semua Kontingen",count:s.length}];const n=new Map;for(const d of s){const c=String((d==null?void 0:d.event_category_id)||"");if(!c)continue;const v=(d==null?void 0:d.category_name)||(d==null?void 0:d.category)||"-";n.has(c)||n.set(c,{id:c,name:v,count:0}),n.get(c).count++}return[{id:"all",name:"Semua Peserta",count:s.length},...Array.from(n.values())]}),q=S(()=>y.value?A.value||[]:T.value==="all"?A.value||[]:(A.value||[]).filter(s=>String((s==null?void 0:s.event_category_id)||"")===String(T.value)));W(()=>_.value,()=>{T.value="all"});const re=async()=>{if(K.value){G.value=!0;try{const{data:s}=await le.get(`/api/v1/events/${K.value}/competitions/tree`);Z.value=s.rounds||[]}catch(s){console.error(s),oe.fire("Gagal","Gagal memuat daftar kompetisi.","error")}finally{G.value=!1}}},j=async()=>{if(!Y.value){V.value=null,b.value=[],A.value=[],C.value=[];return}U.value=!0;try{const{data:s}=await le.get(`/api/v1/event-competitions/${Y.value}/scores-detail`,{params:{search:J.value||void 0,status:O.value||void 0}});V.value=s.competition,b.value=s.judges||[],A.value=s.participants||[],C.value=s.fields||[]}finally{U.value=!1}},de=async s=>{s&&String(E.params.id)!==String(s)&&await ae.replace({name:"admin.event.scores.detail.index",params:{id:String(s)},query:{...E.query}})},N=s=>Number(s??0).toFixed(2),ue=s=>`H${s+1}`,te=(s,n)=>{const d=(b.value||[]).map(v=>{var p,t,i;return(i=(t=(p=s==null?void 0:s.field_scores)==null?void 0:p[v.id])==null?void 0:t[n])==null?void 0:i.score}).filter(v=>v!=null&&v!=="");if(!d.length)return null;const c=d.reduce((v,p)=>v+Number(p),0);return Math.round(c/d.length*100)/100},ce=(s=[],n=14)=>{const d=Array.isArray(s)?s.filter(Boolean):[];return d.length?d.length<=n?d.join(", "):`${d.slice(0,n).join(", ")}, ...`:"-"},ve=(s,n,d)=>{var v,p,t;const c=(t=(p=(v=s==null?void 0:s.field_scores)==null?void 0:v[n])==null?void 0:p[d])==null?void 0:t.score;return c==null||c===""?null:Number(c)},Q=S(()=>{var v,p;if(!y.value)return[];const s=q.value||[],n=new Map;for(const t of s){const i=String((t==null?void 0:t.contingent)||"-");n.has(i)||n.set(i,{contingent:i,members:[],fieldCollector:{},totalCollector:{}});const a=n.get(i);a.members.push((t==null?void 0:t.full_name)||"-");for(const g of b.value||[]){const u=g.id;if(!((t==null?void 0:t.scores)&&typeof t.scores[u]<"u"))continue;const h=Number(t.scores[u]??0);a.totalCollector[u]||(a.totalCollector[u]=[]),a.totalCollector[u].push(h)}for(const g of C.value||[]){const u=g.event_field_component_id;a.fieldCollector[u]||(a.fieldCollector[u]={});for(const f of b.value||[]){const h=f.id,I=ve(t,h,u);I!==null&&(a.fieldCollector[u][h]||(a.fieldCollector[u][h]=[]),a.fieldCollector[u][h].push(I))}}}const d=Array.from(n.keys()).sort((t,i)=>t==="-"?1:i==="-"?-1:t.localeCompare(i)),c=[];for(const t of d){const i=n.get(t),a={},g={};for(const D of C.value||[]){const k=D.event_field_component_id;a[k]={};const $=[];for(const L of b.value||[]){const F=L.id,P=((p=(v=i.fieldCollector)==null?void 0:v[k])==null?void 0:p[F])||[],H=P.length?P.reduce((_e,fe)=>_e+fe,0)/P.length:null;a[k][F]=H!==null?Number(H.toFixed(2)):null,H!==null&&$.push(H)}g[k]=$.length?Number(($.reduce((L,F)=>L+F,0)/$.length).toFixed(2)):null}const u={};let f=0,h=0;for(const D of b.value||[]){const k=D.id,$=i.totalCollector[k]||[],L=$.length?$.reduce((F,P)=>F+P,0)/$.length:0;u[k]=Number(L.toFixed(2)),f+=u[k],h++}const I=h?f/h:0;c.push({contingent:i.contingent,members:i.members,member_count:i.members.length,field_scores:a,field_avg:g,total_by_judge:u,sum_score:Number(f.toFixed(2)),avg_score:Number(I.toFixed(2))})}return c}),me=S(()=>y.value?4:3),z=S(()=>me.value+C.value.length*((b.value.length||0)+1)+2);return he(async()=>{if(!K.value){oe.fire("Event belum dipilih","Silakan pilih event terlebih dahulu.","info");return}await re(),_.value&&await j()}),W(()=>E.params.id,async s=>{_.value=String(s||""),await j()}),W(()=>_.value,async s=>{s&&(await de(s),await j())}),(s,n)=>{var d,c,v,p;return o(),l(m,null,[e("section",Ce,[e("div",Se,[e("div",Me,[e("div",null,[n[5]||(n[5]=e("h1",{class:"mb-1"},"Rekap Nilai Kompetisi",-1)),e("p",Ne,[M(r(((d=V.value)==null?void 0:d.full_name)||"Pilih kompetisi terlebih dahulu.")+" ",1),_.value&&V.value?(o(),l("span",$e,[e("span",{class:ne(["badge",y.value?"badge-info":"badge-secondary"])},r(y.value?"TEAM / GROUP (By Kontingen)":"INDIVIDU"),3)])):R("",!0)]),K.value?(o(),l("p",je,[n[3]||(n[3]=M(" Event aktif: ")),e("strong",null,r((c=B.value)==null?void 0:c.event_name),1),(v=B.value)!=null&&v.event_year?(o(),l("span",Ie," ("+r(B.value.event_year)+")",1)):R("",!0),n[4]||(n[4]=M(" â€¢ Lokasi: ")),e("strong",null,r(((p=B.value)==null?void 0:p.event_location)||"-"),1)])):R("",!0)]),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:j,disabled:U.value||!_.value},n[6]||(n[6]=[e("i",{class:"fas fa-sync"},null,-1),M(" Refresh ")]),8,Ae)]),e("div",De,[e("div",Fe,[n[9]||(n[9]=e("label",{class:"mb-1 text-sm"},[M("Kompetisi "),e("span",{class:"text-danger"},"*")],-1)),X(e("select",{"onUpdate:modelValue":n[0]||(n[0]=t=>_.value=t),class:"form-control form-control-sm",disabled:!K.value||G.value},[n[7]||(n[7]=e("option",{value:"",disabled:""},"-- Pilih Kompetisi --",-1)),(o(!0),l(m,null,x(Z.value,t=>(o(),l("optgroup",{key:"round-"+t.id,label:t.name},[(o(!0),l(m,null,x(t.competitions,i=>(o(),l("option",{key:i.id,value:String(i.id)},r(i.full_name),9,Te))),128))],8,Ke))),128))],8,Be),[[se,_.value]]),G.value?(o(),l("small",Ue,n[8]||(n[8]=[e("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),M(" Memuat daftar kompetisi... ")]))):R("",!0)])]),e("div",Ve,[e("div",Le,[X(e("input",{"onUpdate:modelValue":n[1]||(n[1]=t=>J.value=t),class:"form-control form-control-sm",placeholder:y.value?"Cari kontingen/anggota...":"Cari nama peserta...",disabled:!_.value,onKeyup:ye(j,["enter"])},null,40,Pe),[[be,J.value]])]),e("div",Re,[X(e("select",{"onUpdate:modelValue":n[2]||(n[2]=t=>O.value=t),class:"form-control form-control-sm",disabled:!_.value,onChange:j},n[10]||(n[10]=[e("option",{value:""},"Semua Status",-1),e("option",{value:"draft"},"Draft",-1),e("option",{value:"submitted"},"Submitted",-1),e("option",{value:"locked"},"Locked",-1)]),40,Ee),[[se,O.value]])]),e("div",Ge,[e("button",{class:"btn btn-sm btn-primary w-100",onClick:j,disabled:U.value||!_.value},n[11]||(n[11]=[e("i",{class:"fas fa-search"},null,-1),M(" Filter ")]),8,qe)])]),_.value&&ee.value.length?(o(),l("div",ze,[e("ul",He,[(o(!0),l(m,null,x(ee.value,t=>(o(),l("li",{class:"nav-item",key:"tab-"+t.id},[e("a",{href:"#",class:ne(["nav-link",{active:T.value===t.id}]),onClick:ke(i=>T.value=t.id,["prevent"]),style:{"font-weight":"600"}},[M(r(t.name)+" ",1),e("span",Oe,r(t.count),1)],10,Je)]))),128))])])):R("",!0)])]),e("section",Qe,[e("div",We,[e("div",Xe,[e("div",Ye,[e("table",Ze,[e("thead",et,[e("tr",null,[n[17]||(n[17]=e("th",{rowspan:"2",style:{width:"50px"},class:"align-middle text-center"},"#",-1)),y.value?(o(),l(m,{key:1},[n[14]||(n[14]=e("th",{rowspan:"2",class:"align-middle"},"Kontingen",-1)),n[15]||(n[15]=e("th",{rowspan:"2",class:"align-middle text-center",style:{width:"110px"}},"Jml Anggota",-1)),n[16]||(n[16]=e("th",{rowspan:"2",class:"align-middle"},"Anggota",-1))],64)):(o(),l(m,{key:0},[n[12]||(n[12]=e("th",{rowspan:"2",class:"align-middle"},"Peserta",-1)),n[13]||(n[13]=e("th",{rowspan:"2",class:"align-middle"},"Kontingen",-1))],64)),(o(!0),l(m,null,x(C.value,t=>{var i;return o(),l("th",{key:"g-"+t.event_field_component_id,class:"text-center align-middle",colspan:(((i=b.value)==null?void 0:i.length)||0)+1,style:{"white-space":"nowrap"}},r(t.name),9,tt)}),128)),n[18]||(n[18]=e("th",{rowspan:"2",class:"text-center align-middle"},"AVG Total",-1)),n[19]||(n[19]=e("th",{rowspan:"2",class:"text-center align-middle"},"SUM Total",-1))]),e("tr",null,[(o(!0),l(m,null,x(C.value,t=>(o(),l(m,{key:"h-"+t.event_field_component_id},[(o(!0),l(m,null,x(b.value,(i,a)=>(o(),l("th",{key:`h-${t.event_field_component_id}-${i.id}`,class:"text-center",style:{"white-space":"nowrap"}},r(ue(a)),1))),128)),n[20]||(n[20]=e("th",{class:"text-center",style:{"white-space":"nowrap"}},"Rerata",-1))],64))),128))])]),e("tbody",null,[_.value?U.value?(o(),l("tr",lt,[e("td",{colspan:z.value,class:"text-center p-3 text-muted"}," Loading... ",8,ot)])):y.value&&Q.value.length===0?(o(),l("tr",at,[e("td",{colspan:z.value,class:"text-center p-3 text-muted"}," Tidak ada data. ",8,it)])):!y.value&&q.value.length===0?(o(),l("tr",rt,[e("td",{colspan:z.value,class:"text-center p-3 text-muted"}," Tidak ada data. ",8,dt)])):y.value?(o(!0),l(m,{key:4},x(Q.value,(t,i)=>(o(),l("tr",{key:"cont-"+t.contingent},[e("td",ut,r(i+1),1),e("td",null,[e("div",ct,r(t.contingent),1)]),e("td",vt,r(t.member_count),1),e("td",null,[e("div",null,r(ce(t.members,16)),1)]),(o(!0),l(m,null,x(C.value,a=>{var g,u;return o(),l(m,{key:"gb-"+a.event_field_component_id},[(o(!0),l(m,null,x(b.value,f=>{var h,I,D,k;return o(),l("td",{key:`gb-${t.contingent}-${a.event_field_component_id}-${f.id}`,class:"text-center"},r(((I=(h=t.field_scores)==null?void 0:h[a.event_field_component_id])==null?void 0:I[f.id])!==null&&((k=(D=t.field_scores)==null?void 0:D[a.event_field_component_id])==null?void 0:k[f.id])!==void 0?N(t.field_scores[a.event_field_component_id][f.id]):"-"),1)}),128)),e("td",mt,r(((g=t.field_avg)==null?void 0:g[a.event_field_component_id])!==null&&((u=t.field_avg)==null?void 0:u[a.event_field_component_id])!==void 0?N(t.field_avg[a.event_field_component_id]):"-"),1)],64)}),128)),e("td",_t,r(N(t.avg_score)),1),e("td",ft,r(N(t.sum_score)),1)]))),128)):(o(!0),l(m,{key:5},x(q.value,(t,i)=>(o(),l("tr",{key:t.event_participant_id},[e("td",pt,r(i+1),1),e("td",null,[e("div",gt,r(t.full_name),1)]),e("td",null,r(t.contingent||"-"),1),(o(!0),l(m,null,x(C.value,a=>(o(),l(m,{key:"b-"+a.event_field_component_id},[(o(!0),l(m,null,x(b.value,g=>{var u,f;return o(),l("td",{key:`b-${t.event_participant_id}-${a.event_field_component_id}-${g.id}`,class:"text-center"},r((f=(u=t.field_scores)==null?void 0:u[g.id])!=null&&f[a.event_field_component_id]?N(t.field_scores[g.id][a.event_field_component_id].score):"-"),1)}),128)),e("td",ht,r(te(t,a.event_field_component_id)!==null?N(te(t,a.event_field_component_id)):"-"),1)],64))),128)),e("td",bt,r(N(t.avg_score)),1),e("td",yt,r(N(t.sum_score)),1)]))),128)):(o(),l("tr",nt,[e("td",{colspan:z.value,class:"text-center p-3 text-muted"}," Silakan pilih kompetisi terlebih dahulu. ",8,st)]))])])]),e("div",xt,[n[21]||(n[21]=M(" Total: ")),e("strong",null,r(y.value?Q.value.length+" kontingen":q.value.length+" peserta"),1)])])])])],64)}}},Nt=we(kt,[["__scopeId","data-v-f30a83ca"]]);export{Nt as default};
