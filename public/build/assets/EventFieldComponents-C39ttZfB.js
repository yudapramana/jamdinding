import{z as se,y as S,A as v,O as D,V as oe,B as s,C as o,D as e,I as x,J as p,K as l,S as C,aB as O,as as U,U as y,ay as G,H as I,F as N,a as B,aC as ie}from"./AuthUserStore-B6VIMEgo.js";import{S as u}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{_ as de}from"./app-DdJgNepn.js";const re={class:"content-header"},me={class:"container-fluid"},ue={class:"d-flex justify-content-between align-items-center"},ce={key:0,class:"mb-0 mt-1 text-sm text-muted"},pe={key:0},ve={class:"d-flex flex-column flex-sm-row gap-2"},_e=["disabled"],ge={key:0,class:"fas fa-spinner fa-spin mr-1"},be={key:1,class:"fas fa-magic mr-1"},fe=["disabled"],he={key:0,class:"text-danger text-sm mt-2 mb-0"},xe={class:"content"},ye={class:"container-fluid"},ke={class:"card"},we={class:"card-header"},Ce={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},Ge={class:"d-flex align-items-center"},Be={class:"card-body table-responsive p-0"},Fe={class:"table table-bordered table-hover table-striped text-sm mb-0"},Ee={key:0},Me={key:1},Te={class:"text-center align-middle"},Ke={class:"align-middle"},Pe={class:"text-center align-middle"},Se={class:"text-center align-middle"},Ue=["onClick"],Le={class:"text-center align-middle"},$e={class:"text-center align-middle"},Ve={class:"align-middle"},De={class:"d-flex flex-wrap"},Ie={key:0,class:"text-muted text-xs"},Ne={class:"card-footer clearfix py-2"},je={class:"d-flex justify-content-between align-items-center"},Ae={class:"text-muted text-sm"},He={class:"pagination pagination-sm m-0"},ze={class:"page-item disabled"},Ye={class:"page-link"},qe={id:"print-area",class:"d-none"},Je={class:"text-center text-sm mb-3"},Oe={class:"mb-1"},We={class:"text-muted"},Qe={class:"table table-bordered table-sm text-sm mb-0"},Re={key:0},Xe={class:"text-center"},Ze={class:"text-center"},et={class:"text-center"},tt={class:"text-center"},nt={class:"modal fade",id:"eventFieldComponentModal",tabindex:"-1",role:"dialog","aria-labelledby":"eventFieldComponentModalLabel"},at={class:"modal-dialog modal-lg",role:"document"},lt={class:"modal-content"},st={class:"modal-header py-2"},ot={key:0,class:"text-muted"},it={class:"modal-body pt-2"},dt={key:0,class:"text-center text-muted"},rt={key:1},mt={class:"d-flex justify-content-between align-items-center mb-2"},ut={class:"text-sm"},ct={class:"text-muted"},pt={class:"table-responsive mb-0"},vt={class:"table table-sm table-bordered mb-0"},_t={key:0},gt={class:"text-center align-middle"},bt={class:"align-middle"},ft={class:"text-center align-middle"},ht={class:"text-center align-middle"},xt={class:"text-center align-middle"},yt={class:"text-center align-middle"},kt={class:"btn-group btn-group-sm"},wt=["onClick"],Ct=["onClick"],Gt={class:"modal fade",id:"eventFieldComponentFormModal",tabindex:"-1",role:"dialog","aria-labelledby":"eventFieldComponentFormModalLabel"},Bt={class:"modal-dialog modal-lg",role:"document"},Ft={class:"modal-content"},Et={class:"modal-header py-2"},Mt={class:"modal-title mb-0",id:"eventFieldComponentFormModalLabel"},Tt={class:"modal-body pt-2"},Kt={key:0,class:"text-center text-muted"},Pt={key:1},St={class:"row"},Ut={class:"col-md-6"},Lt={class:"form-group mb-2"},$t=["value"],Vt={class:"form-group mb-2"},Dt=["value"],It={class:"form-group mb-2"},Nt={class:"col-md-6"},jt={class:"form-group mb-2"},At={class:"form-group mb-2"},Ht={class:"text-right mt-3"},zt=["disabled"],Yt={key:0,class:"fas fa-spinner fa-spin mr-1"},qt={key:1,class:"fas fa-save mr-1"},Jt={__name:"EventFieldComponents",setup(Ot){const j=se(),_=S(()=>j.eventData||null),c=S(()=>{var n;return((n=_.value)==null?void 0:n.id)||null}),k=v([]),A=v([]),M=v(""),T=v(10),L=v(!1),F=v(!1),K=v(!1),P=v(!1),m=v({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),d=v(null),r=v({id:null,event_group_id:"",field_id:"",weight:null,max_score:null,order_number:null}),E=n=>n.field_components||n.fieldComponents||[],W=n=>E(n).length,V=S(()=>d.value?d.value.field_components||d.value.fieldComponents||[]:[]),H=async()=>{if(c.value)try{const n=await B.get("/api/v1/list-fields",{params:{simple:1}});A.value=n.data.data||[]}catch(n){console.error("Gagal memuat List Fields:",n),u.fire("Gagal","Gagal memuat List Fields.","error")}},f=async(n=1)=>{if(c.value){L.value=!0;try{const i=(await B.get("/api/v1/event-groups",{params:{event_id:c.value,page:n,per_page:T.value,search:M.value,with_fields:1}})).data.data;if(k.value=i.data||[],m.value={current_page:i.current_page,per_page:i.per_page,total:i.total,from:i.from,to:i.to,last_page:i.last_page},d.value){const g=k.value.find(w=>w.id===d.value.id);g&&(d.value=g)}}catch(t){console.error("Gagal memuat event groups:",t),t.response&&t.response.status===401?j.logout():u.fire("Gagal","Gagal memuat data Golongan Event.","error")}finally{L.value=!1}}},z=n=>{n<1||n>m.value.last_page||f(n)},Q=n=>{if(!c.value){u.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola komponen penilaian.","warning");return}d.value=n,$("#eventFieldComponentModal").modal("show")},R=()=>{if(!d.value)return;F.value=!1;const n=d.value.field_components||d.value.fieldComponents||[];r.value={id:null,event_group_id:d.value.id,field_id:"",weight:null,max_score:null,order_number:(n.length||0)+1},$("#eventFieldComponentFormModal").modal("show")},X=n=>{d.value&&(F.value=!0,r.value={id:n.id,event_group_id:d.value.id,field_id:n.field_id,weight:n.weight,max_score:n.max_score,order_number:n.order_number},$("#eventFieldComponentFormModal").modal("show"))},Z=async()=>{if(!c.value||!d.value){u.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola komponen penilaian.","warning");return}K.value=!0;const n={event_group_id:r.value.event_group_id,field_id:r.value.field_id,weight:r.value.weight,max_score:r.value.max_score,order_number:r.value.order_number};try{F.value&&r.value.id?(await B.put(`/api/v1/event-field-components/${r.value.id}`,n),u.fire("Berhasil","Komponen penilaian event berhasil diperbarui.","success")):(await B.post("/api/v1/event-field-components",n),u.fire("Berhasil","Komponen penilaian event berhasil ditambahkan.","success")),$("#eventFieldComponentFormModal").modal("hide"),await f(m.value.current_page)}catch(t){console.error("Gagal menyimpan event_field_component:",t);let i="Gagal menyimpan data komponen penilaian event.";t.response&&t.response.status===422&&t.response.data.message&&(i=t.response.data.message),u.fire("Gagal",i,"error")}finally{K.value=!1}},ee=async n=>{if((await u.fire({title:"Hapus Komponen?",text:`Yakin ingin menghapus komponen "${n.field_name}" dari golongan event ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await B.delete(`/api/v1/event-field-components/${n.id}`),u.fire("Terhapus","Komponen penilaian event berhasil dihapus.","success"),await f(m.value.current_page)}catch(i){console.error("Gagal menghapus event_field_component:",i),u.fire("Gagal","Gagal menghapus komponen penilaian event.","error")}},te=async()=>{if(!c.value){u.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum generate dari template.","warning");return}if((await u.fire({title:"Generate dari Template Master?",text:"Komponen penilaian event akan dibuat berdasarkan Master Field Components. Data yang sudah ada tidak akan diduplikasi.",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Generate",cancelButtonText:"Batal",confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d"})).isConfirmed){P.value=!0;try{const i=(await B.post("/api/v1/event-field-components/generate-from-template",{event_id:c.value})).data.message||"Komponen penilaian event berhasil digenerate dari template.";u.fire("Berhasil",i,"success"),d.value=null,await f(1)}catch(t){console.error("Gagal generate dari template:",t);let i="Gagal generate komponen dari template.";t.response&&t.response.data&&t.response.data.message&&(i=t.response.data.message),u.fire("Gagal",i,"error")}finally{P.value=!1}}},ne=S(()=>[...k.value].sort((n,t)=>{const i=n.order_number??9999,g=t.order_number??9999;return i-g})),ae=n=>[...E(n)].sort((t,i)=>{const g=t.order_number??9999,w=i.order_number??9999;return g-w}),le=()=>{var i;const n=(i=document.getElementById("print-area"))==null?void 0:i.innerHTML;if(!n)return;const t=window.open("","","height=800,width=1000");t.document.write(`
    <html>
      <head>
        <title>Print Komponen Penilaian</title>
        <style>
          body {
            font-family: Arial, sans-serif;
            padding: 20px;
          }
          h3, h5 {
            margin-bottom: 6px;
          }
          table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 12px;
          }
          th, td {
            border: 1px solid #000;
            padding: 4px 6px;
          }
          th {
            background: #f0f0f0;
          }
          .text-center {
            text-align: center;
          }
          .text-sm {
            font-size: 12px;
          }
          .text-muted {
            color: #666;
          }
          @page {
            size: A4;
            margin: 15mm;
          }
        </style>
      </head>
      <body>
        ${n}
      </body>
    </html>
  `),t.document.close(),t.focus(),t.print(),t.close()};return D(()=>M.value,ie(()=>{f(1)},400)),D(()=>T.value,()=>{f(1)}),D(()=>c.value,n=>{n&&(H(),f(1))}),oe(()=>{c.value?(H(),f()):u.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(n,t)=>{var i,g,w,Y,q,J;return o(),s(y,null,[e("section",re,[e("div",me,[e("div",ue,[e("div",null,[t[10]||(t[10]=e("h1",{class:"mb-1"},"Komponen Penilaian per Golongan Event",-1)),t[11]||(t[11]=e("p",{class:"mb-0 text-muted text-sm"}," Mengatur komponen penilaian (Lagu, Suara, Tajwid, dll.) beserta bobot & nilai maksimum untuk setiap Golongan Event (Cabang + Golongan yang sudah diaktifkan di event). ",-1)),c.value?(o(),s("p",ce,[t[8]||(t[8]=p(" Event aktif: ")),e("strong",null,l((i=_.value)==null?void 0:i.event_name),1),(g=_.value)!=null&&g.event_year?(o(),s("span",pe," ("+l(_.value.event_year)+")",1)):x("",!0),t[9]||(t[9]=p(" • Lokasi: ")),e("strong",null,l(((w=_.value)==null?void 0:w.event_location)||"-"),1)])):x("",!0)]),e("div",ve,[e("button",{class:"btn btn-outline-secondary btn-sm mr-sm-2 mb-2 mb-sm-0",onClick:te,disabled:P.value||!c.value},[P.value?(o(),s("i",ge)):(o(),s("i",be)),t[12]||(t[12]=p(" Generate dari Template "))],8,_e),e("button",{class:"btn btn-outline-primary btn-sm",onClick:le,disabled:!k.value.length},t[13]||(t[13]=[e("i",{class:"fas fa-print mr-1"},null,-1),p(" Print ")]),8,fe)])]),c.value?x("",!0):(o(),s("p",he,t[14]||(t[14]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),p(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",xe,[e("div",ye,[e("div",ke,[e("div",we,[e("div",Ce,[e("div",Ge,[t[16]||(t[16]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),C(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>T.value=a),class:"form-control form-control-sm w-auto mr-2"},t[15]||(t[15]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[O,T.value,void 0,{number:!0}]]),t[17]||(t[17]=e("label",{class:"mb-0 text-sm text-muted"},"Golongan / halaman",-1))]),C(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>M.value=a),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari nama golongan / cabang..."},null,512),[[U,M.value]])])]),e("div",Be,[e("table",Fe,[t[20]||(t[20]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{class:"text-center align-middle",style:{width:"50px"}},"#"),e("th",{class:"align-middle"},"Golongan Event"),e("th",{class:"text-center align-middle",style:{width:"120px"}},"Maks Usia"),e("th",{class:"align-middle"},"Jumlah Bidang"),e("th",{class:"text-center align-middle",style:{width:"80px"}},"Tipe"),e("th",{class:"text-center align-middle",style:{width:"80px"}},"Urutan"),e("th",{class:"align-middle",style:{width:"320px"}},"Komponen")])],-1)),e("tbody",null,[L.value?(o(),s("tr",Ee,t[18]||(t[18]=[e("td",{colspan:"6",class:"text-center"},"Memuat data golongan event...",-1)]))):k.value.length===0?(o(),s("tr",Me,t[19]||(t[19]=[e("td",{colspan:"6",class:"text-center"},[p(" Belum ada Event Group untuk event ini. "),e("br"),e("small",{class:"text-muted"}," Silakan generate Event Groups terlebih dahulu. ")],-1)]))):(o(!0),s(y,{key:2},G(k.value,(a,b)=>(o(),s("tr",{key:a.id},[e("td",Te,l(b+1+(m.value.current_page-1)*m.value.per_page),1),e("td",Ke,[e("strong",null,l(a.full_name),1)]),e("td",Pe,l(a.max_age??"-"),1),e("td",Se,[e("button",{class:"btn btn-xs btn-outline-primary",onClick:h=>Q(a)},l(W(a))+" Bidang ",9,Ue)]),e("td",Le,[e("span",{class:I(["badge",a.is_team?"badge-success":"badge-secondary"])},l(a.is_team?"Tim":"Individu"),3)]),e("td",$e,l(a.order_number??"-"),1),e("td",Ve,[e("div",De,[(o(!0),s(y,null,G(E(a),h=>(o(),s("span",{key:h.id,class:"badge badge-info mr-1 mb-1"},l(h.field_name),1))),128)),E(a).length===0?(o(),s("span",Ie," Belum ada komponen ")):x("",!0)])])]))),128))])])]),e("div",Ne,[e("div",je,[e("div",Ae," Menampilkan "+l(m.value.from||0)+" - "+l(m.value.to||0)+" dari "+l(m.value.total||0)+" golongan event ",1),e("ul",He,[e("li",{class:I(["page-item",{disabled:m.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:t[2]||(t[2]=N(a=>z(m.value.current_page-1),["prevent"]))}," « ")],2),e("li",ze,[e("span",Ye," Halaman "+l(m.value.current_page)+" / "+l(m.value.last_page||1),1)]),e("li",{class:I(["page-item",{disabled:m.value.current_page===m.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:t[3]||(t[3]=N(a=>z(m.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",qe,[t[24]||(t[24]=e("h3",{class:"text-center mb-1"}," Komponen Penilaian Golongan Event ",-1)),e("p",Je,[p(l((Y=_.value)==null?void 0:Y.event_name)+" "+l((q=_.value)!=null&&q.event_year?"("+_.value.event_year+")":"")+" ",1),t[21]||(t[21]=e("br",null,null,-1)),p(" "+l(((J=_.value)==null?void 0:J.event_location)||""),1)]),(o(!0),s(y,null,G(ne.value,a=>(o(),s("div",{key:"print-"+a.id,class:"mb-4"},[e("h5",Oe,[p(l(a.full_name)+" ",1),e("small",We," • "+l(a.is_team?"Tim":"Individu"),1)]),e("table",Qe,[t[23]||(t[23]=e("thead",null,[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Komponen"),e("th",{style:{width:"90px"},class:"text-center"},"Bobot (%)"),e("th",{style:{width:"100px"},class:"text-center"},"Max Nilai"),e("th",{style:{width:"80px"},class:"text-center"},"Urutan")])],-1)),e("tbody",null,[E(a).length===0?(o(),s("tr",Re,t[22]||(t[22]=[e("td",{colspan:"5",class:"text-center text-muted"}," Tidak ada komponen ",-1)]))):x("",!0),(o(!0),s(y,null,G(ae(a),(b,h)=>(o(),s("tr",{key:"pfc-"+b.id},[e("td",Xe,l(h+1),1),e("td",null,l(b.field_name),1),e("td",Ze,l(b.weight??"-"),1),e("td",et,l(b.max_score??"-"),1),e("td",tt,l(b.order_number??"-"),1)]))),128))])])]))),128))]),e("div",nt,[e("div",at,[e("div",lt,[e("div",st,[e("div",null,[t[26]||(t[26]=e("h5",{class:"modal-title mb-0",id:"eventFieldComponentModalLabel"},[e("i",{class:"fas fa-sliders-h mr-1"}),p(" Kelola Komponen Penilaian ")],-1)),d.value?(o(),s("small",ot,[t[25]||(t[25]=p(" Golongan Event: ")),e("strong",null,l(d.value.full_name),1)])):x("",!0)]),t[27]||(t[27]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",it,[d.value?(o(),s("div",rt,[e("div",mt,[e("div",ut,[t[28]||(t[28]=e("strong",null,"Daftar Komponen:",-1)),e("span",ct,l(V.value.length)+" komponen ",1)]),e("button",{class:"btn btn-xs btn-primary",onClick:R}," + Tambah Komponen ")]),e("div",pt,[e("table",vt,[t[32]||(t[32]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"},class:"text-center align-middle"},"#"),e("th",{class:"align-middle"},"Komponen"),e("th",{style:{width:"80px"},class:"text-center align-middle"},"Bobot %"),e("th",{style:{width:"110px"},class:"text-center align-middle"},"Max Nilai"),e("th",{style:{width:"80px"},class:"text-center align-middle"},"Urutan"),e("th",{style:{width:"110px"},class:"text-center align-middle"},"Aksi")])],-1)),e("tbody",null,[V.value.length===0?(o(),s("tr",_t,t[29]||(t[29]=[e("td",{colspan:"6",class:"text-center text-muted"}," Belum ada komponen penilaian untuk golongan event ini. ",-1)]))):x("",!0),(o(!0),s(y,null,G(V.value,(a,b)=>(o(),s("tr",{key:a.id},[e("td",gt,l(b+1),1),e("td",bt,l(a.field_name),1),e("td",ft,l(a.weight??"-"),1),e("td",ht,l(a.max_score??"-"),1),e("td",xt,l(a.order_number??"-"),1),e("td",yt,[e("div",kt,[e("button",{class:"btn btn-warning",onClick:h=>X(a)},t[30]||(t[30]=[e("i",{class:"fas fa-edit"},null,-1)]),8,wt),e("button",{class:"btn btn-danger",onClick:h=>ee(a)},t[31]||(t[31]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Ct)])])]))),128))])])])])):(o(),s("div",dt," Tidak ada golongan event yang dipilih. "))])])])]),e("div",Gt,[e("div",Bt,[e("div",Ft,[e("div",Et,[e("h5",Mt,[t[33]||(t[33]=e("i",{class:"fas fa-sliders-h mr-1"},null,-1)),p(" "+l(F.value?"Edit Komponen Penilaian":"Tambah Komponen Penilaian"),1)]),t[34]||(t[34]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Tt,[d.value?(o(),s("div",Pt,[e("form",{onSubmit:N(Z,["prevent"])},[e("div",St,[e("div",Ut,[e("div",Lt,[t[35]||(t[35]=e("label",{class:"mb-1"},"Golongan Event",-1)),e("input",{type:"text",class:"form-control form-control-sm",value:d.value.full_name,disabled:""},null,8,$t)]),e("div",Vt,[t[37]||(t[37]=e("label",{class:"mb-1"},"Komponen Penilaian",-1)),C(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>r.value.field_id=a),class:"form-control form-control-sm",required:""},[t[36]||(t[36]=e("option",{value:"",disabled:""},"-- pilih komponen --",-1)),(o(!0),s(y,null,G(A.value,a=>(o(),s("option",{key:a.id,value:a.id},l(a.name),9,Dt))),128))],512),[[O,r.value.field_id]]),t[38]||(t[38]=e("small",{class:"text-muted"}," Data diambil dari master List Fields. ",-1))]),e("div",It,[t[39]||(t[39]=e("label",{class:"mb-1"},"Urutan Tampil",-1)),C(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>r.value.order_number=a),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[U,r.value.order_number,void 0,{number:!0}]])])]),e("div",Nt,[e("div",jt,[t[40]||(t[40]=e("label",{class:"mb-1"},"Bobot (%)",-1)),C(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>r.value.weight=a),type:"number",min:"0",max:"100",class:"form-control form-control-sm"},null,512),[[U,r.value.weight,void 0,{number:!0}]])]),e("div",At,[t[41]||(t[41]=e("label",{class:"mb-1"},"Max Nilai",-1)),C(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>r.value.max_score=a),type:"number",min:"0",class:"form-control form-control-sm"},null,512),[[U,r.value.max_score,void 0,{number:!0}]])])])]),e("div",Ht,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:K.value||!c.value},[K.value?(o(),s("i",Yt)):(o(),s("i",qt)),p(" "+l(F.value?"Update Komponen":"Simpan Komponen"),1)],8,zt)])],32)])):(o(),s("div",Kt," Tidak ada golongan event yang dipilih. "))])])])])])],64)}}},Xt=de(Jt,[["__scopeId","data-v-0f171cf3"]]);export{Xt as default};
