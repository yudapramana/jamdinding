import{z as ae,y as D,M as te,A as v,O as L,V as se,B as r,C as i,D as e,I as _,K as m,J as l,S as g,aB as h,as as E,U as x,ay as M,H as T,F as N,a as b,L as ne,aC as le}from"./AuthUserStore-D7C5-kPo.js";import{S as d}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const oe={class:"content-header"},re={class:"container-fluid"},ie={class:"d-flex justify-content-between align-items-center"},ue={key:0,class:"mb-0 mt-1 text-sm text-muted"},de={class:"d-flex flex-column flex-sm-row gap-2"},me=["disabled"],pe={key:0,class:"fas fa-spinner fa-spin mr-1"},ve={key:1,class:"fas fa-magic mr-1"},ce=["disabled"],ge={key:0,class:"text-danger text-sm mt-2 mb-0"},be={class:"content"},fe={class:"container-fluid"},_e={class:"card"},he={class:"card-header"},xe={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},ye={class:"d-flex align-items-center"},ke={class:"card-body table-responsive p-0"},Ge={class:"table table-bordered table-hover text-sm mb-0"},we={key:0},Ce={key:1},Be=["value","onChange"],Ee=["value"],Me={class:"text-center"},Te={class:"text-center"},Se={class:"text-center"},Ue={class:"text-center"},Ve={class:"text-center"},$e={class:"btn-group btn-group-sm"},De=["onClick"],Le=["onClick"],Ne=["onClick"],Pe={class:"card-footer clearfix py-2"},Ie={class:"d-flex justify-content-between align-items-center"},Fe={class:"text-muted text-sm"},je={class:"pagination pagination-sm m-0"},Ae={class:"page-item disabled"},qe={class:"page-link"},He={class:"modal fade",id:"eventGroupModal",tabindex:"-1",role:"dialog","aria-labelledby":"eventGroupModalLabel"},Ke={class:"modal-dialog modal-lg",role:"document"},Je={class:"modal-content"},ze={class:"modal-header py-2"},Re={class:"modal-title",id:"eventGroupModalLabel"},Ye={class:"modal-body pt-2"},Oe={class:"row"},Qe={class:"col-md-6"},We={class:"form-group mb-2"},Xe=["value"],Ze={key:0},ea={class:"form-group mb-2"},aa=["value"],ta={key:0},sa={class:"form-group mb-2"},na={class:"col-md-6"},la={class:"form-group mb-2"},oa={class:"form-group mb-2"},ra={class:"form-group mb-2"},ia={class:"form-group mb-2"},ua={class:"text-right mt-3"},da=["disabled"],ma={key:0,class:"fas fa-spinner fa-spin mr-1"},pa={key:1,class:"fas fa-save mr-1"},ba={__name:"EventGroups",setup(va){const P=ae(),q=te(),H=ne(),y=D(()=>{const s=q.query.branch_id;return s?Number(s):null}),I=v([]),K=async()=>{const s=await b.get(`/api/v1/events/${p.value}/locations`,{params:{per_page:100}});I.value=s.data.data.data},F=d.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0}),J=async(s,a)=>{try{await b.put(`/api/v1/event-groups/${s}/assign-location`,{event_location_id:a||null}),F.fire({icon:"success",title:"Majelis tersimpan"})}catch{F.fire({icon:"error",title:"Gagal menyimpan"})}},z=D(()=>P.eventData||null),p=D(()=>{var s;return((s=z.value)==null?void 0:s.id)||null}),S=v([]),U=v([]),j=v([]),k=v(""),G=v(10),V=v(!1),w=v(!1),C=v(!1),B=v(!1),u=v({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),n=v({id:null,branch_id:"",group_id:"",full_name:"",max_age:0,status:"active",is_team:!1,order_number:null}),R=async()=>{try{const[s,a]=await Promise.all([b.get("/api/v1/branches",{params:{simple:1}}),b.get("/api/v1/groups",{params:{simple:1}})]);U.value=s.data.data||[],j.value=a.data.data||[]}catch(s){console.error("Gagal memuat branches / groups:",s),d.fire("Gagal","Gagal memuat daftar cabang dan golongan.","error")}},Y=s=>{H.push({name:"admin.event.categories",query:{branch_id:s.branch_id,group_id:s.group_id}})},f=async(s=1)=>{if(p.value){V.value=!0;try{const o=(await b.get("/api/v1/event-groups",{params:{event_id:p.value,branch_id:y.value||void 0,page:s,per_page:G.value,search:k.value,from_crud:1}})).data.data;S.value=o.data||[],u.value={current_page:o.current_page,per_page:o.per_page,total:o.total,from:o.from,to:o.to,last_page:o.last_page}}catch(a){console.error("Gagal memuat event_groups:",a),a.response&&a.response.status===401?P.logout():d.fire("Gagal","Gagal memuat data event groups.","error")}finally{V.value=!1}}},A=s=>{s<1||s>u.value.last_page||f(s)},O=()=>{if(!p.value){d.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola golongan.","warning");return}w.value=!1,n.value={id:null,branch_id:"",group_id:"",full_name:"",max_age:0,status:"active",is_team:!1,order_number:(u.value.total||0)+1},$("#eventGroupModal").modal("show")},Q=s=>{w.value=!0,n.value={id:s.id,branch_id:s.branch_id,group_id:s.group_id,full_name:s.full_name,max_age:s.max_age,status:s.status,is_team:!!s.is_team,order_number:s.order_number},$("#eventGroupModal").modal("show")},W=async()=>{if(!p.value){d.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola golongan.","warning");return}C.value=!0;const s={event_id:p.value,branch_id:n.value.branch_id,group_id:n.value.group_id,full_name:n.value.full_name,max_age:n.value.max_age,status:n.value.status,is_team:n.value.is_team,order_number:n.value.order_number};try{w.value&&n.value.id?(await b.put(`/api/v1/event-groups/${n.value.id}`,s),d.fire("Berhasil","Golongan event berhasil diperbarui.","success")):(await b.post("/api/v1/event-groups",s),d.fire("Berhasil","Golongan event berhasil ditambahkan.","success")),$("#eventGroupModal").modal("hide"),f(u.value.current_page)}catch(a){console.error("Gagal menyimpan event_group:",a);let o="Gagal menyimpan data golongan event.";a.response&&a.response.status===422&&a.response.data.message&&(o=a.response.data.message),d.fire("Gagal",o,"error")}finally{C.value=!1}},X=async s=>{if((await d.fire({title:"Hapus Golongan Event?",text:`Yakin ingin menghapus golongan "${s.full_name}" dari event ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await b.delete(`/api/v1/event-groups/${s.id}`),d.fire("Terhapus","Golongan event berhasil dihapus.","success"),f(u.value.current_page)}catch(o){console.error("Gagal menghapus event_group:",o),d.fire("Gagal","Gagal menghapus golongan event.","error")}},Z=async()=>{if(!p.value){d.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum generate dari template.","warning");return}if((await d.fire({title:"Generate dari Template?",text:"Golongan event akan dibuat berdasarkan Master Groups. Kombinasi yang sudah ada tidak akan diduplikasi.",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Generate",cancelButtonText:"Batal",confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d"})).isConfirmed){B.value=!0;try{await b.post("/api/v1/event-groups/generate-from-template",{event_id:p.value}),d.fire("Berhasil","Golongan event berhasil digenerate dari template.","success"),f(1)}catch(a){console.error("Gagal generate dari template (event_groups):",a);let o="Gagal generate golongan dari template.";a.response&&a.response.data&&a.response.data.message&&(o=a.response.data.message),d.fire("Gagal",o,"error")}finally{B.value=!1}}};return L(()=>k.value,le(()=>f(1),400)),L(()=>G.value,()=>{f(1)}),L(()=>p.value,s=>{s&&f(1)}),se(()=>{R(),p.value?(f(),K()):d.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(s,a)=>{var o;return i(),r(x,null,[e("section",oe,[e("div",re,[e("div",ie,[e("div",null,[a[12]||(a[12]=e("h1",{class:"mb-1"},"Golongan per Event (Event Groups)",-1)),a[13]||(a[13]=e("p",{class:"mb-0 text-muted text-sm"}," Mengatur golongan (group) yang diaktifkan pada event terpilih. Data ini dapat digenerate dari Master Groups lalu disesuaikan. ",-1)),y.value?(i(),r("p",ue,[a[11]||(a[11]=m(" Filter: hanya menampilkan golongan untuk cabang ")),e("strong",null,l(((o=U.value.find(t=>t.id===y.value))==null?void 0:o.name)||"ID: "+y.value),1)])):_("",!0)]),e("div",de,[e("button",{class:"btn btn-outline-secondary btn-sm mr-sm-2 mb-2 mb-sm-0",onClick:Z,disabled:B.value||!p.value},[B.value?(i(),r("i",pe)):(i(),r("i",ve)),a[14]||(a[14]=m(" Generate dari Template "))],8,me),e("button",{class:"btn btn-primary btn-sm",onClick:O,disabled:!p.value}," + Tambah Golongan ",8,ce)])]),p.value?_("",!0):(i(),r("p",ge,a[15]||(a[15]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),m(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",be,[e("div",fe,[e("div",_e,[e("div",he,[e("div",xe,[e("div",ye,[a[17]||(a[17]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),g(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>G.value=t),class:"form-control form-control-sm w-auto mr-2"},a[16]||(a[16]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[h,G.value,void 0,{number:!0}]]),a[18]||(a[18]=e("label",{class:"mb-0 text-sm text-muted"},"Entri",-1))]),g(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>k.value=t),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari cabang / golongan..."},null,512),[[E,k.value]])])]),e("div",ke,[e("table",Ge,[a[25]||(a[25]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Cabang"),e("th",null,"Golongan"),e("th",null,"Nama Lengkap"),e("th",null,"Majelis"),e("th",{style:{width:"80px"},class:"text-center"},"Maks. Umur"),e("th",{style:{width:"90px"},class:"text-center"},"Status"),e("th",{style:{width:"80px"},class:"text-center"},"Tim?"),e("th",{style:{width:"80px"},class:"text-center"},"Urutan"),e("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[V.value?(i(),r("tr",we,a[19]||(a[19]=[e("td",{colspan:"9",class:"text-center"},"Memuat data event groups...",-1)]))):S.value.length===0?(i(),r("tr",Ce,a[20]||(a[20]=[e("td",{colspan:"9",class:"text-center"},[m(" Belum ada golongan terdaftar untuk event ini. "),e("br"),e("small",{class:"text-muted"},[m(" Klik "),e("strong",null,"Generate dari Template"),m(" atau "),e("strong",null,"Tambah Golongan Event"),m(". ")])],-1)]))):_("",!0),(i(!0),r(x,null,M(S.value,(t,ee)=>(i(),r("tr",{key:t.id},[e("td",null,l(ee+1+(u.value.current_page-1)*u.value.per_page),1),e("td",null,[e("strong",null,l(t.branch_name),1)]),e("td",null,[e("strong",null,l(t.group_name),1)]),e("td",null,l(t.full_name),1),e("td",null,[e("select",{class:"form-control form-control-sm",value:t.event_location_id,onChange:c=>J(t.id,c.target.value)},[a[21]||(a[21]=e("option",{value:""},"— Belum Ditentukan —",-1)),(i(!0),r(x,null,M(I.value,c=>(i(),r("option",{key:c.id,value:c.id},l(c.code?c.code+" - ":"")+l(c.name),9,Ee))),128))],40,Be)]),e("td",Me,l(t.max_age??"-"),1),e("td",Te,[e("span",{class:T(["badge",t.status==="active"?"badge-success":"badge-secondary"])},l(t.status==="active"?"Aktif":"Nonaktif"),3)]),e("td",Se,[e("span",{class:T(["badge",t.is_team?"badge-info":"badge-secondary"])},l(t.is_team?"Tim":"Individu"),3)]),e("td",Ue,l(t.order_number??"-"),1),e("td",Ve,[e("div",$e,[e("button",{class:"btn btn-info",title:"Kelola Kategori untuk Golongan ini",onClick:c=>Y(t)},a[22]||(a[22]=[e("i",{class:"fas fa-venus-mars"},null,-1)]),8,De),e("button",{class:"btn btn-warning",onClick:c=>Q(t)},a[23]||(a[23]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Le),e("button",{class:"btn btn-danger",onClick:c=>X(t)},a[24]||(a[24]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Ne)])])]))),128))])])]),e("div",Pe,[e("div",Ie,[e("div",Fe," Menampilkan "+l(u.value.from||0)+" - "+l(u.value.to||0)+" dari "+l(u.value.total||0)+" golongan event ",1),e("ul",je,[e("li",{class:T(["page-item",{disabled:u.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:a[2]||(a[2]=N(t=>A(u.value.current_page-1),["prevent"]))}," « ")],2),e("li",Ae,[e("span",qe," Halaman "+l(u.value.current_page)+" / "+l(u.value.last_page||1),1)]),e("li",{class:T(["page-item",{disabled:u.value.current_page===u.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:a[3]||(a[3]=N(t=>A(u.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",He,[e("div",Ke,[e("div",Je,[e("div",ze,[e("h5",Re,[a[26]||(a[26]=e("i",{class:"fas fa-users mr-1"},null,-1)),m(" "+l(w.value?"Edit Golongan Event":"Tambah Golongan Event"),1)]),a[27]||(a[27]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Ye,[e("form",{onSubmit:N(W,["prevent"])},[e("div",Oe,[e("div",Qe,[e("div",We,[a[29]||(a[29]=e("label",{class:"mb-1"},"Cabang Lomba",-1)),g(e("select",{"onUpdate:modelValue":a[4]||(a[4]=t=>n.value.branch_id=t),class:"form-control form-control-sm",required:""},[a[28]||(a[28]=e("option",{value:"",disabled:""},"-- pilih cabang --",-1)),(i(!0),r(x,null,M(U.value,t=>(i(),r("option",{key:t.id,value:t.id},[m(l(t.name)+" ",1),t.code?(i(),r("span",Ze," ("+l(t.code)+")",1)):_("",!0)],8,Xe))),128))],512),[[h,n.value.branch_id]]),a[30]||(a[30]=e("small",{class:"text-muted"},[m(" Data diambil dari master "),e("strong",null,"Branches"),m(". ")],-1))]),e("div",ea,[a[32]||(a[32]=e("label",{class:"mb-1"},"Golongan",-1)),g(e("select",{"onUpdate:modelValue":a[5]||(a[5]=t=>n.value.group_id=t),class:"form-control form-control-sm",required:""},[a[31]||(a[31]=e("option",{value:"",disabled:""},"-- pilih golongan --",-1)),(i(!0),r(x,null,M(j.value,t=>(i(),r("option",{key:t.id,value:t.id},[m(l(t.name)+" ",1),t.code?(i(),r("span",ta," ("+l(t.code)+")",1)):_("",!0)],8,aa))),128))],512),[[h,n.value.group_id]]),a[33]||(a[33]=e("small",{class:"text-muted"},[m(" Data diambil dari master "),e("strong",null,"Groups"),m(". ")],-1))]),e("div",sa,[a[34]||(a[34]=e("label",{class:"mb-1"},"Nama Lengkap (Full Name)",-1)),g(e("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>n.value.full_name=t),type:"text",class:"form-control form-control-sm",placeholder:"Contoh: Hafalan 10 Juz - Remaja"},null,512),[[E,n.value.full_name]]),a[35]||(a[35]=e("small",{class:"text-muted"}," Jika dikosongkan, akan digenerate dari nama cabang + golongan. ",-1))])]),e("div",na,[e("div",la,[a[36]||(a[36]=e("label",{class:"mb-1"},"Maksimal Umur",-1)),g(e("input",{"onUpdate:modelValue":a[7]||(a[7]=t=>n.value.max_age=t),type:"number",min:"0",class:"form-control form-control-sm"},null,512),[[E,n.value.max_age,void 0,{number:!0}]]),a[37]||(a[37]=e("small",{class:"text-muted"}," 0 berarti tidak dibatasi umur. ",-1))]),e("div",oa,[a[39]||(a[39]=e("label",{class:"mb-1"},"Status",-1)),g(e("select",{"onUpdate:modelValue":a[8]||(a[8]=t=>n.value.status=t),class:"form-control form-control-sm"},a[38]||(a[38]=[e("option",{value:"active"},"Aktif",-1),e("option",{value:"inactive"},"Nonaktif",-1)]),512),[[h,n.value.status]])]),e("div",ra,[a[41]||(a[41]=e("label",{class:"mb-1"},"Jenis",-1)),g(e("select",{"onUpdate:modelValue":a[9]||(a[9]=t=>n.value.is_team=t),class:"form-control form-control-sm"},a[40]||(a[40]=[e("option",{value:!1},"Individu",-1),e("option",{value:!0},"Tim",-1)]),512),[[h,n.value.is_team]])]),e("div",ia,[a[42]||(a[42]=e("label",{class:"mb-1"},"Urutan Tampil",-1)),g(e("input",{"onUpdate:modelValue":a[10]||(a[10]=t=>n.value.order_number=t),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[E,n.value.order_number,void 0,{number:!0}]])])])]),e("div",ua,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:C.value||!p.value},[C.value?(i(),r("i",ma)):(i(),r("i",pa)),a[43]||(a[43]=m(" Simpan "))],8,da)])],32)])])])])])],64)}}};export{ba as default};
