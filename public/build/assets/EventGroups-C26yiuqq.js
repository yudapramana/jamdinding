import{z as ee,y as V,M as ae,A as p,O as D,V as te,B as o,C as r,D as e,I as b,J as d,K as n,S as g,aB as h,as as B,U as E,ay as L,H as M,F as N,a as f,L as se,aC as le}from"./AuthUserStore-B6VIMEgo.js";import{S as m}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const ne={class:"content-header"},oe={class:"container-fluid"},re={class:"d-flex justify-content-between align-items-center"},ie={key:0,class:"mb-0 mt-1 text-sm text-muted"},ue={key:1,class:"mb-0 mt-1 text-sm text-muted"},de={key:0},me={class:"d-flex flex-column flex-sm-row gap-2"},ve=["disabled"],pe={key:0,class:"fas fa-spinner fa-spin mr-1"},ge={key:1,class:"fas fa-magic mr-1"},ce=["disabled"],be={key:0,class:"text-danger text-sm mt-2 mb-0"},fe={class:"content"},_e={class:"container-fluid"},he={class:"card"},xe={class:"card-header"},ke={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},ye={class:"d-flex align-items-center"},Ge={class:"card-body table-responsive p-0"},we={class:"table table-bordered table-hover text-sm mb-0"},Ce={key:0},Be={key:1},Ee={class:"text-center"},Me={class:"text-center"},Te={class:"text-center"},Se={class:"text-center"},Ue={class:"text-center"},Ve={class:"btn-group btn-group-sm"},$e=["onClick"],De=["onClick"],Le=["onClick"],Ne={class:"card-footer clearfix py-2"},Ie={class:"d-flex justify-content-between align-items-center"},Pe={class:"text-muted text-sm"},Fe={class:"pagination pagination-sm m-0"},Ae={class:"page-item disabled"},qe={class:"page-link"},He={class:"modal fade",id:"eventGroupModal",tabindex:"-1",role:"dialog","aria-labelledby":"eventGroupModalLabel"},Ke={class:"modal-dialog modal-lg",role:"document"},je={class:"modal-content"},Je={class:"modal-header py-2"},ze={class:"modal-title",id:"eventGroupModalLabel"},Re={class:"modal-body pt-2"},Ye={class:"row"},Oe={class:"col-md-6"},Qe={class:"form-group mb-2"},We=["value"],Xe={key:0},Ze={class:"form-group mb-2"},ea=["value"],aa={key:0},ta={class:"form-group mb-2"},sa={class:"col-md-6"},la={class:"form-group mb-2"},na={class:"form-group mb-2"},oa={class:"form-group mb-2"},ra={class:"form-group mb-2"},ia={class:"text-right mt-3"},ua=["disabled"],da={key:0,class:"fas fa-spinner fa-spin mr-1"},ma={key:1,class:"fas fa-save mr-1"},ca={__name:"EventGroups",setup(va){const I=ee(),j=ae(),J=se(),x=V(()=>{const s=j.query.branch_id;return s?Number(s):null}),_=V(()=>I.eventData||null),v=V(()=>{var s;return((s=_.value)==null?void 0:s.id)||null}),T=p([]),S=p([]),P=p([]),k=p(""),y=p(10),U=p(!1),G=p(!1),w=p(!1),C=p(!1),u=p({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),l=p({id:null,branch_id:"",group_id:"",full_name:"",max_age:0,status:"active",is_team:!1,order_number:null}),z=async()=>{try{const[s,a]=await Promise.all([f.get("/api/v1/branches",{params:{simple:1}}),f.get("/api/v1/groups",{params:{simple:1}})]);S.value=s.data.data||[],P.value=a.data.data||[]}catch(s){console.error("Gagal memuat branches / groups:",s),m.fire("Gagal","Gagal memuat daftar cabang dan golongan.","error")}},R=s=>{J.push({name:"admin.event.categories",query:{branch_id:s.branch_id,group_id:s.group_id}})},c=async(s=1)=>{if(v.value){U.value=!0;try{const i=(await f.get("/api/v1/event-groups",{params:{event_id:v.value,branch_id:x.value||void 0,page:s,per_page:y.value,search:k.value,from_crud:1}})).data.data;T.value=i.data||[],u.value={current_page:i.current_page,per_page:i.per_page,total:i.total,from:i.from,to:i.to,last_page:i.last_page}}catch(a){console.error("Gagal memuat event_groups:",a),a.response&&a.response.status===401?I.logout():m.fire("Gagal","Gagal memuat data event groups.","error")}finally{U.value=!1}}},F=s=>{s<1||s>u.value.last_page||c(s)},Y=()=>{if(!v.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola golongan.","warning");return}G.value=!1,l.value={id:null,branch_id:"",group_id:"",full_name:"",max_age:0,status:"active",is_team:!1,order_number:(u.value.total||0)+1},$("#eventGroupModal").modal("show")},O=s=>{G.value=!0,l.value={id:s.id,branch_id:s.branch_id,group_id:s.group_id,full_name:s.full_name,max_age:s.max_age,status:s.status,is_team:!!s.is_team,order_number:s.order_number},$("#eventGroupModal").modal("show")},Q=async()=>{if(!v.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola golongan.","warning");return}w.value=!0;const s={event_id:v.value,branch_id:l.value.branch_id,group_id:l.value.group_id,full_name:l.value.full_name,max_age:l.value.max_age,status:l.value.status,is_team:l.value.is_team,order_number:l.value.order_number};try{G.value&&l.value.id?(await f.put(`/api/v1/event-groups/${l.value.id}`,s),m.fire("Berhasil","Golongan event berhasil diperbarui.","success")):(await f.post("/api/v1/event-groups",s),m.fire("Berhasil","Golongan event berhasil ditambahkan.","success")),$("#eventGroupModal").modal("hide"),c(u.value.current_page)}catch(a){console.error("Gagal menyimpan event_group:",a);let i="Gagal menyimpan data golongan event.";a.response&&a.response.status===422&&a.response.data.message&&(i=a.response.data.message),m.fire("Gagal",i,"error")}finally{w.value=!1}},W=async s=>{if((await m.fire({title:"Hapus Golongan Event?",text:`Yakin ingin menghapus golongan "${s.full_name}" dari event ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await f.delete(`/api/v1/event-groups/${s.id}`),m.fire("Terhapus","Golongan event berhasil dihapus.","success"),c(u.value.current_page)}catch(i){console.error("Gagal menghapus event_group:",i),m.fire("Gagal","Gagal menghapus golongan event.","error")}},X=async()=>{if(!v.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum generate dari template.","warning");return}if((await m.fire({title:"Generate dari Template?",text:"Golongan event akan dibuat berdasarkan Master Groups. Kombinasi yang sudah ada tidak akan diduplikasi.",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Generate",cancelButtonText:"Batal",confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d"})).isConfirmed){C.value=!0;try{await f.post("/api/v1/event-groups/generate-from-template",{event_id:v.value}),m.fire("Berhasil","Golongan event berhasil digenerate dari template.","success"),c(1)}catch(a){console.error("Gagal generate dari template (event_groups):",a);let i="Gagal generate golongan dari template.";a.response&&a.response.data&&a.response.data.message&&(i=a.response.data.message),m.fire("Gagal",i,"error")}finally{C.value=!1}}};return D(()=>k.value,le(()=>c(1),400)),D(()=>y.value,()=>{c(1)}),D(()=>v.value,s=>{s&&c(1)}),te(()=>{z(),v.value?c():m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(s,a)=>{var i,A,q,H;return r(),o(E,null,[e("section",ne,[e("div",oe,[e("div",re,[e("div",null,[a[14]||(a[14]=e("h1",{class:"mb-1"},"Golongan per Event (Event Groups)",-1)),a[15]||(a[15]=e("p",{class:"mb-0 text-muted text-sm"}," Mengatur golongan (group) yang diaktifkan pada event terpilih. Data ini dapat digenerate dari Master Groups lalu disesuaikan. ",-1)),x.value?(r(),o("p",ie,[a[11]||(a[11]=d(" Filter: hanya menampilkan golongan untuk cabang ")),e("strong",null,n(((i=S.value.find(t=>t.id===x.value))==null?void 0:i.name)||"ID: "+x.value),1)])):b("",!0),v.value?(r(),o("p",ue,[a[12]||(a[12]=d(" Event aktif: ")),e("strong",null,n((A=_.value)==null?void 0:A.event_name),1),(q=_.value)!=null&&q.event_year?(r(),o("span",de," ("+n(_.value.event_year)+")",1)):b("",!0),a[13]||(a[13]=d(" • Lokasi: ")),e("strong",null,n(((H=_.value)==null?void 0:H.event_location)||"-"),1)])):b("",!0)]),e("div",me,[e("button",{class:"btn btn-outline-secondary btn-sm mr-sm-2 mb-2 mb-sm-0",onClick:X,disabled:C.value||!v.value},[C.value?(r(),o("i",pe)):(r(),o("i",ge)),a[16]||(a[16]=d(" Generate dari Template "))],8,ve),e("button",{class:"btn btn-primary btn-sm",onClick:Y,disabled:!v.value}," + Tambah Golongan ",8,ce)])]),v.value?b("",!0):(r(),o("p",be,a[17]||(a[17]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),d(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",fe,[e("div",_e,[e("div",he,[e("div",xe,[e("div",ke,[e("div",ye,[a[19]||(a[19]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),g(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>y.value=t),class:"form-control form-control-sm w-auto mr-2"},a[18]||(a[18]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[h,y.value,void 0,{number:!0}]]),a[20]||(a[20]=e("label",{class:"mb-0 text-sm text-muted"},"Entri",-1))]),g(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>k.value=t),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari cabang / golongan..."},null,512),[[B,k.value]])])]),e("div",Ge,[e("table",we,[a[26]||(a[26]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Cabang"),e("th",null,"Golongan"),e("th",null,"Nama Lengkap"),e("th",{style:{width:"80px"},class:"text-center"},"Maks. Umur"),e("th",{style:{width:"90px"},class:"text-center"},"Status"),e("th",{style:{width:"80px"},class:"text-center"},"Tim?"),e("th",{style:{width:"80px"},class:"text-center"},"Urutan"),e("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[U.value?(r(),o("tr",Ce,a[21]||(a[21]=[e("td",{colspan:"9",class:"text-center"},"Memuat data event groups...",-1)]))):T.value.length===0?(r(),o("tr",Be,a[22]||(a[22]=[e("td",{colspan:"9",class:"text-center"},[d(" Belum ada golongan terdaftar untuk event ini. "),e("br"),e("small",{class:"text-muted"},[d(" Klik "),e("strong",null,"Generate dari Template"),d(" atau "),e("strong",null,"Tambah Golongan Event"),d(". ")])],-1)]))):b("",!0),(r(!0),o(E,null,L(T.value,(t,Z)=>(r(),o("tr",{key:t.id},[e("td",null,n(Z+1+(u.value.current_page-1)*u.value.per_page),1),e("td",null,[e("strong",null,n(t.branch_name),1)]),e("td",null,[e("strong",null,n(t.group_name),1)]),e("td",null,n(t.full_name),1),e("td",Ee,n(t.max_age??"-"),1),e("td",Me,[e("span",{class:M(["badge",t.status==="active"?"badge-success":"badge-secondary"])},n(t.status==="active"?"Aktif":"Nonaktif"),3)]),e("td",Te,[e("span",{class:M(["badge",t.is_team?"badge-info":"badge-secondary"])},n(t.is_team?"Tim":"Individu"),3)]),e("td",Se,n(t.order_number??"-"),1),e("td",Ue,[e("div",Ve,[e("button",{class:"btn btn-info",title:"Kelola Kategori untuk Golongan ini",onClick:K=>R(t)},a[23]||(a[23]=[e("i",{class:"fas fa-venus-mars"},null,-1)]),8,$e),e("button",{class:"btn btn-warning",onClick:K=>O(t)},a[24]||(a[24]=[e("i",{class:"fas fa-edit"},null,-1)]),8,De),e("button",{class:"btn btn-danger",onClick:K=>W(t)},a[25]||(a[25]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Le)])])]))),128))])])]),e("div",Ne,[e("div",Ie,[e("div",Pe," Menampilkan "+n(u.value.from||0)+" - "+n(u.value.to||0)+" dari "+n(u.value.total||0)+" golongan event ",1),e("ul",Fe,[e("li",{class:M(["page-item",{disabled:u.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:a[2]||(a[2]=N(t=>F(u.value.current_page-1),["prevent"]))}," « ")],2),e("li",Ae,[e("span",qe," Halaman "+n(u.value.current_page)+" / "+n(u.value.last_page||1),1)]),e("li",{class:M(["page-item",{disabled:u.value.current_page===u.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:a[3]||(a[3]=N(t=>F(u.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",He,[e("div",Ke,[e("div",je,[e("div",Je,[e("h5",ze,[a[27]||(a[27]=e("i",{class:"fas fa-users mr-1"},null,-1)),d(" "+n(G.value?"Edit Golongan Event":"Tambah Golongan Event"),1)]),a[28]||(a[28]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Re,[e("form",{onSubmit:N(Q,["prevent"])},[e("div",Ye,[e("div",Oe,[e("div",Qe,[a[30]||(a[30]=e("label",{class:"mb-1"},"Cabang Lomba",-1)),g(e("select",{"onUpdate:modelValue":a[4]||(a[4]=t=>l.value.branch_id=t),class:"form-control form-control-sm",required:""},[a[29]||(a[29]=e("option",{value:"",disabled:""},"-- pilih cabang --",-1)),(r(!0),o(E,null,L(S.value,t=>(r(),o("option",{key:t.id,value:t.id},[d(n(t.name)+" ",1),t.code?(r(),o("span",Xe," ("+n(t.code)+")",1)):b("",!0)],8,We))),128))],512),[[h,l.value.branch_id]]),a[31]||(a[31]=e("small",{class:"text-muted"},[d(" Data diambil dari master "),e("strong",null,"Branches"),d(". ")],-1))]),e("div",Ze,[a[33]||(a[33]=e("label",{class:"mb-1"},"Golongan",-1)),g(e("select",{"onUpdate:modelValue":a[5]||(a[5]=t=>l.value.group_id=t),class:"form-control form-control-sm",required:""},[a[32]||(a[32]=e("option",{value:"",disabled:""},"-- pilih golongan --",-1)),(r(!0),o(E,null,L(P.value,t=>(r(),o("option",{key:t.id,value:t.id},[d(n(t.name)+" ",1),t.code?(r(),o("span",aa," ("+n(t.code)+")",1)):b("",!0)],8,ea))),128))],512),[[h,l.value.group_id]]),a[34]||(a[34]=e("small",{class:"text-muted"},[d(" Data diambil dari master "),e("strong",null,"Groups"),d(". ")],-1))]),e("div",ta,[a[35]||(a[35]=e("label",{class:"mb-1"},"Nama Lengkap (Full Name)",-1)),g(e("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>l.value.full_name=t),type:"text",class:"form-control form-control-sm",placeholder:"Contoh: Hafalan 10 Juz - Remaja"},null,512),[[B,l.value.full_name]]),a[36]||(a[36]=e("small",{class:"text-muted"}," Jika dikosongkan, akan digenerate dari nama cabang + golongan. ",-1))])]),e("div",sa,[e("div",la,[a[37]||(a[37]=e("label",{class:"mb-1"},"Maksimal Umur",-1)),g(e("input",{"onUpdate:modelValue":a[7]||(a[7]=t=>l.value.max_age=t),type:"number",min:"0",class:"form-control form-control-sm"},null,512),[[B,l.value.max_age,void 0,{number:!0}]]),a[38]||(a[38]=e("small",{class:"text-muted"}," 0 berarti tidak dibatasi umur. ",-1))]),e("div",na,[a[40]||(a[40]=e("label",{class:"mb-1"},"Status",-1)),g(e("select",{"onUpdate:modelValue":a[8]||(a[8]=t=>l.value.status=t),class:"form-control form-control-sm"},a[39]||(a[39]=[e("option",{value:"active"},"Aktif",-1),e("option",{value:"inactive"},"Nonaktif",-1)]),512),[[h,l.value.status]])]),e("div",oa,[a[42]||(a[42]=e("label",{class:"mb-1"},"Jenis",-1)),g(e("select",{"onUpdate:modelValue":a[9]||(a[9]=t=>l.value.is_team=t),class:"form-control form-control-sm"},a[41]||(a[41]=[e("option",{value:!1},"Individu",-1),e("option",{value:!0},"Tim",-1)]),512),[[h,l.value.is_team]])]),e("div",ra,[a[43]||(a[43]=e("label",{class:"mb-1"},"Urutan Tampil",-1)),g(e("input",{"onUpdate:modelValue":a[10]||(a[10]=t=>l.value.order_number=t),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[B,l.value.order_number,void 0,{number:!0}]])])])]),e("div",ia,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:w.value||!v.value},[w.value?(r(),o("i",da)):(r(),o("i",ma)),a[44]||(a[44]=d(" Simpan "))],8,ua)])],32)])])])])])],64)}}};export{ca as default};
