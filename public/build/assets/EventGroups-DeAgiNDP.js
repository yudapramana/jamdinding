import{z as W,y as U,M as X,A as v,O as V,V as Z,B as i,C as u,D as e,I as f,K as d,J as n,S as c,aB as _,as as C,U as B,ay as D,H as E,F as N,a as b,L as ee,aC as ae}from"./AuthUserStore-NBT_5Ejm.js";import{S as m}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const te={class:"content-header"},se={class:"container-fluid"},le={class:"d-flex justify-content-between align-items-center"},ne={key:0,class:"mb-0 mt-1 text-sm text-muted"},oe={class:"d-flex flex-column flex-sm-row gap-2"},re=["disabled"],ie={key:0,class:"fas fa-spinner fa-spin mr-1"},ue={key:1,class:"fas fa-magic mr-1"},de=["disabled"],me={key:0,class:"text-danger text-sm mt-2 mb-0"},pe={class:"content"},ve={class:"container-fluid"},ce={class:"card"},ge={class:"card-header"},be={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},fe={class:"d-flex align-items-center"},_e={class:"card-body table-responsive p-0"},he={class:"table table-bordered table-hover text-sm mb-0"},xe={key:0},ke={key:1},ye={class:"text-center"},Ge={class:"text-center"},we={class:"text-center"},Ce={class:"text-center"},Be={class:"text-center"},Ee={class:"btn-group btn-group-sm"},Me=["onClick"],Te=["onClick"],Se=["onClick"],Ue={class:"card-footer clearfix py-2"},Ve={class:"d-flex justify-content-between align-items-center"},$e={class:"text-muted text-sm"},De={class:"pagination pagination-sm m-0"},Ne={class:"page-item disabled"},Ie={class:"page-link"},Le={class:"modal fade",id:"eventGroupModal",tabindex:"-1",role:"dialog","aria-labelledby":"eventGroupModalLabel"},Pe={class:"modal-dialog modal-lg",role:"document"},Fe={class:"modal-content"},Ae={class:"modal-header py-2"},qe={class:"modal-title",id:"eventGroupModalLabel"},He={class:"modal-body pt-2"},Ke={class:"row"},je={class:"col-md-6"},Je={class:"form-group mb-2"},ze=["value"],Re={key:0},Ye={class:"form-group mb-2"},Oe=["value"],Qe={key:0},We={class:"form-group mb-2"},Xe={class:"col-md-6"},Ze={class:"form-group mb-2"},ea={class:"form-group mb-2"},aa={class:"form-group mb-2"},ta={class:"form-group mb-2"},sa={class:"text-right mt-3"},la=["disabled"],na={key:0,class:"fas fa-spinner fa-spin mr-1"},oa={key:1,class:"fas fa-save mr-1"},da={__name:"EventGroups",setup(ra){const I=W(),A=X(),q=ee(),h=U(()=>{const s=A.query.branch_id;return s?Number(s):null}),H=U(()=>I.eventData||null),p=U(()=>{var s;return((s=H.value)==null?void 0:s.id)||null}),M=v([]),T=v([]),L=v([]),x=v(""),k=v(10),S=v(!1),y=v(!1),G=v(!1),w=v(!1),r=v({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),l=v({id:null,branch_id:"",group_id:"",full_name:"",max_age:0,status:"active",is_team:!1,order_number:null}),K=async()=>{try{const[s,a]=await Promise.all([b.get("/api/v1/branches",{params:{simple:1}}),b.get("/api/v1/groups",{params:{simple:1}})]);T.value=s.data.data||[],L.value=a.data.data||[]}catch(s){console.error("Gagal memuat branches / groups:",s),m.fire("Gagal","Gagal memuat daftar cabang dan golongan.","error")}},j=s=>{q.push({name:"admin.event.categories",query:{branch_id:s.branch_id,group_id:s.group_id}})},g=async(s=1)=>{if(p.value){S.value=!0;try{const o=(await b.get("/api/v1/event-groups",{params:{event_id:p.value,branch_id:h.value||void 0,page:s,per_page:k.value,search:x.value,from_crud:1}})).data.data;M.value=o.data||[],r.value={current_page:o.current_page,per_page:o.per_page,total:o.total,from:o.from,to:o.to,last_page:o.last_page}}catch(a){console.error("Gagal memuat event_groups:",a),a.response&&a.response.status===401?I.logout():m.fire("Gagal","Gagal memuat data event groups.","error")}finally{S.value=!1}}},P=s=>{s<1||s>r.value.last_page||g(s)},J=()=>{if(!p.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola golongan.","warning");return}y.value=!1,l.value={id:null,branch_id:"",group_id:"",full_name:"",max_age:0,status:"active",is_team:!1,order_number:(r.value.total||0)+1},$("#eventGroupModal").modal("show")},z=s=>{y.value=!0,l.value={id:s.id,branch_id:s.branch_id,group_id:s.group_id,full_name:s.full_name,max_age:s.max_age,status:s.status,is_team:!!s.is_team,order_number:s.order_number},$("#eventGroupModal").modal("show")},R=async()=>{if(!p.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola golongan.","warning");return}G.value=!0;const s={event_id:p.value,branch_id:l.value.branch_id,group_id:l.value.group_id,full_name:l.value.full_name,max_age:l.value.max_age,status:l.value.status,is_team:l.value.is_team,order_number:l.value.order_number};try{y.value&&l.value.id?(await b.put(`/api/v1/event-groups/${l.value.id}`,s),m.fire("Berhasil","Golongan event berhasil diperbarui.","success")):(await b.post("/api/v1/event-groups",s),m.fire("Berhasil","Golongan event berhasil ditambahkan.","success")),$("#eventGroupModal").modal("hide"),g(r.value.current_page)}catch(a){console.error("Gagal menyimpan event_group:",a);let o="Gagal menyimpan data golongan event.";a.response&&a.response.status===422&&a.response.data.message&&(o=a.response.data.message),m.fire("Gagal",o,"error")}finally{G.value=!1}},Y=async s=>{if((await m.fire({title:"Hapus Golongan Event?",text:`Yakin ingin menghapus golongan "${s.full_name}" dari event ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await b.delete(`/api/v1/event-groups/${s.id}`),m.fire("Terhapus","Golongan event berhasil dihapus.","success"),g(r.value.current_page)}catch(o){console.error("Gagal menghapus event_group:",o),m.fire("Gagal","Gagal menghapus golongan event.","error")}},O=async()=>{if(!p.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum generate dari template.","warning");return}if((await m.fire({title:"Generate dari Template?",text:"Golongan event akan dibuat berdasarkan Master Groups. Kombinasi yang sudah ada tidak akan diduplikasi.",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Generate",cancelButtonText:"Batal",confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d"})).isConfirmed){w.value=!0;try{await b.post("/api/v1/event-groups/generate-from-template",{event_id:p.value}),m.fire("Berhasil","Golongan event berhasil digenerate dari template.","success"),g(1)}catch(a){console.error("Gagal generate dari template (event_groups):",a);let o="Gagal generate golongan dari template.";a.response&&a.response.data&&a.response.data.message&&(o=a.response.data.message),m.fire("Gagal",o,"error")}finally{w.value=!1}}};return V(()=>x.value,ae(()=>g(1),400)),V(()=>k.value,()=>{g(1)}),V(()=>p.value,s=>{s&&g(1)}),Z(()=>{K(),p.value?g():m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(s,a)=>{var o;return u(),i(B,null,[e("section",te,[e("div",se,[e("div",le,[e("div",null,[a[12]||(a[12]=e("h1",{class:"mb-1"},"Golongan per Event (Event Groups)",-1)),a[13]||(a[13]=e("p",{class:"mb-0 text-muted text-sm"}," Mengatur golongan (group) yang diaktifkan pada event terpilih. Data ini dapat digenerate dari Master Groups lalu disesuaikan. ",-1)),h.value?(u(),i("p",ne,[a[11]||(a[11]=d(" Filter: hanya menampilkan golongan untuk cabang ")),e("strong",null,n(((o=T.value.find(t=>t.id===h.value))==null?void 0:o.name)||"ID: "+h.value),1)])):f("",!0)]),e("div",oe,[e("button",{class:"btn btn-outline-secondary btn-sm mr-sm-2 mb-2 mb-sm-0",onClick:O,disabled:w.value||!p.value},[w.value?(u(),i("i",ie)):(u(),i("i",ue)),a[14]||(a[14]=d(" Generate dari Template "))],8,re),e("button",{class:"btn btn-primary btn-sm",onClick:J,disabled:!p.value}," + Tambah Golongan ",8,de)])]),p.value?f("",!0):(u(),i("p",me,a[15]||(a[15]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),d(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",pe,[e("div",ve,[e("div",ce,[e("div",ge,[e("div",be,[e("div",fe,[a[17]||(a[17]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),c(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>k.value=t),class:"form-control form-control-sm w-auto mr-2"},a[16]||(a[16]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[_,k.value,void 0,{number:!0}]]),a[18]||(a[18]=e("label",{class:"mb-0 text-sm text-muted"},"Entri",-1))]),c(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>x.value=t),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari cabang / golongan..."},null,512),[[C,x.value]])])]),e("div",_e,[e("table",he,[a[24]||(a[24]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Cabang"),e("th",null,"Golongan"),e("th",null,"Nama Lengkap"),e("th",{style:{width:"80px"},class:"text-center"},"Maks. Umur"),e("th",{style:{width:"90px"},class:"text-center"},"Status"),e("th",{style:{width:"80px"},class:"text-center"},"Tim?"),e("th",{style:{width:"80px"},class:"text-center"},"Urutan"),e("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[S.value?(u(),i("tr",xe,a[19]||(a[19]=[e("td",{colspan:"9",class:"text-center"},"Memuat data event groups...",-1)]))):M.value.length===0?(u(),i("tr",ke,a[20]||(a[20]=[e("td",{colspan:"9",class:"text-center"},[d(" Belum ada golongan terdaftar untuk event ini. "),e("br"),e("small",{class:"text-muted"},[d(" Klik "),e("strong",null,"Generate dari Template"),d(" atau "),e("strong",null,"Tambah Golongan Event"),d(". ")])],-1)]))):f("",!0),(u(!0),i(B,null,D(M.value,(t,Q)=>(u(),i("tr",{key:t.id},[e("td",null,n(Q+1+(r.value.current_page-1)*r.value.per_page),1),e("td",null,[e("strong",null,n(t.branch_name),1)]),e("td",null,[e("strong",null,n(t.group_name),1)]),e("td",null,n(t.full_name),1),e("td",ye,n(t.max_age??"-"),1),e("td",Ge,[e("span",{class:E(["badge",t.status==="active"?"badge-success":"badge-secondary"])},n(t.status==="active"?"Aktif":"Nonaktif"),3)]),e("td",we,[e("span",{class:E(["badge",t.is_team?"badge-info":"badge-secondary"])},n(t.is_team?"Tim":"Individu"),3)]),e("td",Ce,n(t.order_number??"-"),1),e("td",Be,[e("div",Ee,[e("button",{class:"btn btn-info",title:"Kelola Kategori untuk Golongan ini",onClick:F=>j(t)},a[21]||(a[21]=[e("i",{class:"fas fa-venus-mars"},null,-1)]),8,Me),e("button",{class:"btn btn-warning",onClick:F=>z(t)},a[22]||(a[22]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Te),e("button",{class:"btn btn-danger",onClick:F=>Y(t)},a[23]||(a[23]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Se)])])]))),128))])])]),e("div",Ue,[e("div",Ve,[e("div",$e," Menampilkan "+n(r.value.from||0)+" - "+n(r.value.to||0)+" dari "+n(r.value.total||0)+" golongan event ",1),e("ul",De,[e("li",{class:E(["page-item",{disabled:r.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:a[2]||(a[2]=N(t=>P(r.value.current_page-1),["prevent"]))}," « ")],2),e("li",Ne,[e("span",Ie," Halaman "+n(r.value.current_page)+" / "+n(r.value.last_page||1),1)]),e("li",{class:E(["page-item",{disabled:r.value.current_page===r.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:a[3]||(a[3]=N(t=>P(r.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",Le,[e("div",Pe,[e("div",Fe,[e("div",Ae,[e("h5",qe,[a[25]||(a[25]=e("i",{class:"fas fa-users mr-1"},null,-1)),d(" "+n(y.value?"Edit Golongan Event":"Tambah Golongan Event"),1)]),a[26]||(a[26]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",He,[e("form",{onSubmit:N(R,["prevent"])},[e("div",Ke,[e("div",je,[e("div",Je,[a[28]||(a[28]=e("label",{class:"mb-1"},"Cabang Lomba",-1)),c(e("select",{"onUpdate:modelValue":a[4]||(a[4]=t=>l.value.branch_id=t),class:"form-control form-control-sm",required:""},[a[27]||(a[27]=e("option",{value:"",disabled:""},"-- pilih cabang --",-1)),(u(!0),i(B,null,D(T.value,t=>(u(),i("option",{key:t.id,value:t.id},[d(n(t.name)+" ",1),t.code?(u(),i("span",Re," ("+n(t.code)+")",1)):f("",!0)],8,ze))),128))],512),[[_,l.value.branch_id]]),a[29]||(a[29]=e("small",{class:"text-muted"},[d(" Data diambil dari master "),e("strong",null,"Branches"),d(". ")],-1))]),e("div",Ye,[a[31]||(a[31]=e("label",{class:"mb-1"},"Golongan",-1)),c(e("select",{"onUpdate:modelValue":a[5]||(a[5]=t=>l.value.group_id=t),class:"form-control form-control-sm",required:""},[a[30]||(a[30]=e("option",{value:"",disabled:""},"-- pilih golongan --",-1)),(u(!0),i(B,null,D(L.value,t=>(u(),i("option",{key:t.id,value:t.id},[d(n(t.name)+" ",1),t.code?(u(),i("span",Qe," ("+n(t.code)+")",1)):f("",!0)],8,Oe))),128))],512),[[_,l.value.group_id]]),a[32]||(a[32]=e("small",{class:"text-muted"},[d(" Data diambil dari master "),e("strong",null,"Groups"),d(". ")],-1))]),e("div",We,[a[33]||(a[33]=e("label",{class:"mb-1"},"Nama Lengkap (Full Name)",-1)),c(e("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>l.value.full_name=t),type:"text",class:"form-control form-control-sm",placeholder:"Contoh: Hafalan 10 Juz - Remaja"},null,512),[[C,l.value.full_name]]),a[34]||(a[34]=e("small",{class:"text-muted"}," Jika dikosongkan, akan digenerate dari nama cabang + golongan. ",-1))])]),e("div",Xe,[e("div",Ze,[a[35]||(a[35]=e("label",{class:"mb-1"},"Maksimal Umur",-1)),c(e("input",{"onUpdate:modelValue":a[7]||(a[7]=t=>l.value.max_age=t),type:"number",min:"0",class:"form-control form-control-sm"},null,512),[[C,l.value.max_age,void 0,{number:!0}]]),a[36]||(a[36]=e("small",{class:"text-muted"}," 0 berarti tidak dibatasi umur. ",-1))]),e("div",ea,[a[38]||(a[38]=e("label",{class:"mb-1"},"Status",-1)),c(e("select",{"onUpdate:modelValue":a[8]||(a[8]=t=>l.value.status=t),class:"form-control form-control-sm"},a[37]||(a[37]=[e("option",{value:"active"},"Aktif",-1),e("option",{value:"inactive"},"Nonaktif",-1)]),512),[[_,l.value.status]])]),e("div",aa,[a[40]||(a[40]=e("label",{class:"mb-1"},"Jenis",-1)),c(e("select",{"onUpdate:modelValue":a[9]||(a[9]=t=>l.value.is_team=t),class:"form-control form-control-sm"},a[39]||(a[39]=[e("option",{value:!1},"Individu",-1),e("option",{value:!0},"Tim",-1)]),512),[[_,l.value.is_team]])]),e("div",ta,[a[41]||(a[41]=e("label",{class:"mb-1"},"Urutan Tampil",-1)),c(e("input",{"onUpdate:modelValue":a[10]||(a[10]=t=>l.value.order_number=t),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[C,l.value.order_number,void 0,{number:!0}]])])])]),e("div",sa,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:G.value||!p.value},[G.value?(u(),i("i",na)):(u(),i("i",oa)),a[42]||(a[42]=d(" Simpan "))],8,la)])],32)])])])])])],64)}}};export{da as default};
