import{z as W,y as K,A as b,O as j,V as X,B as i,C as o,D as e,I as f,J as g,K as u,S as G,aB as Y,as as U,U as k,ay as C,H as M,F,aA as Z,a as y,aC as D}from"./AuthUserStore-B6VIMEgo.js";import{S as m}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{_ as ee}from"./app-DdJgNepn.js";const te={class:"content-header"},se={class:"container-fluid"},ae={class:"d-flex justify-content-between align-items-center"},le={key:0,class:"mb-0 mt-1 text-sm text-muted"},ne={key:0},ie={key:0,class:"text-danger text-sm mt-2 mb-0"},oe={class:"content"},de={class:"container-fluid"},ue={class:"card"},re={class:"card-header"},ce={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},me={class:"d-flex flex-wrap align-items-center"},ve={class:"d-flex align-items-center mt-2 mt-sm-0"},ge={class:"card-body table-responsive p-0"},_e={class:"table table-bordered table-hover text-sm mb-0"},pe={key:0},he={key:1},be={class:"text-center"},fe={class:"text-xs text-muted"},ke={class:"text-xs text-muted"},ye={key:0},xe={key:0,class:"fas fa-gavel mr-1"},Ce={key:1,class:"fas fa-user mr-1"},we={key:2,class:"ml-1"},je={key:1,class:"text-muted text-xs"},Ge={class:"text-center"},Me={class:"text-center"},Se={class:"btn-group btn-group-sm"},$e=["disabled","onClick"],He=["onClick"],Je={class:"card-footer clearfix py-2"},Oe={class:"d-flex justify-content-between align-items-center"},Be={class:"text-muted text-sm"},Ue={class:"pagination pagination-sm m-0"},De={class:"page-item disabled"},Ee={class:"page-link"},Ve={class:"modal fade",id:"branchJudgesModal",tabindex:"-1",role:"dialog","aria-hidden":"true"},Pe={class:"modal-dialog modal-lg",role:"document"},Te={class:"modal-content"},Ae={class:"modal-header"},Ke={class:"modal-title"},Fe={class:"modal-body"},Ie={class:"form-group"},Le={key:0,class:"border rounded mt-2 p-2",style:{"max-height":"220px",overflow:"auto"}},Ne={class:"text-sm"},ze=["onClick"],qe={key:0,class:"text-muted text-sm"},Qe={key:1,class:"table-responsive"},Re={class:"table table-sm table-bordered mb-0"},We={class:"text-center"},Xe=["checked","onChange"],Ye={class:"text-center"},Ze=["onClick"],et={class:"modal-footer"},tt=["disabled"],st={class:"modal fade",id:"groupJudgesModal",tabindex:"-1",role:"dialog","aria-hidden":"true"},at={class:"modal-dialog modal-lg",role:"document"},lt={class:"modal-content"},nt={class:"modal-header"},it={class:"modal-title"},ot={class:"modal-body"},dt={class:"d-flex justify-content-between align-items-center mb-2"},ut={class:"custom-control custom-switch"},rt={key:0,class:"alert alert-light border text-sm mb-0"},ct={key:1},mt={class:"form-group"},vt={key:0,class:"border rounded mt-2 p-2",style:{"max-height":"220px",overflow:"auto"}},gt={class:"text-sm"},_t=["onClick"],pt={key:0,class:"text-muted text-sm"},ht={key:1,class:"table-responsive"},bt={class:"table table-sm table-bordered mb-0"},ft={class:"text-center"},kt=["checked","onChange"],yt={class:"text-center"},xt=["onClick"],Ct={class:"modal-footer"},wt=["disabled"],jt={__name:"EventJudgePanels",setup(Gt){const I=W(),w=K(()=>I.eventData||null),x=K(()=>{var s;return((s=w.value)==null?void 0:s.id)||null}),O=b([]),S=b(""),H=b(10),B=b(!1),r=b({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),L=s=>s+1+(r.value.current_page-1)*r.value.per_page,_=async(s=1)=>{if(x.value){B.value=!0;try{const l=(await y.get(`/api/v1/events/${x.value}/judge-panels`,{params:{page:s,per_page:H.value,search:S.value}})).data;O.value=l.data||[],r.value={current_page:l.current_page,per_page:l.per_page,total:l.total,from:l.from,to:l.to,last_page:l.last_page}}catch(t){console.error(t),m.fire("Gagal","Gagal memuat data majelis hakim.","error")}finally{B.value=!1}}},E=s=>{s<1||s>r.value.last_page||_(s)},V=async s=>{var l;const t=(s||"").trim();if(t.length<2)return[];try{const c=await y.get("/api/v1/users",{params:{search:t,role:"JUDGE",per_page:10}}),v=((l=c.data)==null?void 0:l.data)||c.data||[];return Array.isArray(v)?v:v.data||[]}catch{return[]}},J=()=>({title:"",id:null,saving:!1,userSearch:"",userOptions:[],selected:[],use_custom_judges:!1}),d=b(J()),n=b(J()),P=(s,t)=>{s.selected.some(c=>c.user_id===t.id)||s.selected.push({user_id:t.id,name:t.name,is_chief:!1})},T=(s,t)=>{s.selected=s.selected.filter(l=>l.user_id!==t)},A=(s,t)=>{s.selected=s.selected.map(l=>({...l,is_chief:l.user_id===t}))},N=async s=>{var t;if(s.event_branch_id){d.value=J(),d.value.id=s.event_branch_id,d.value.title=s.branch_name;try{const l=await y.get(`/api/v1/event-branches/${s.event_branch_id}/judges`);d.value.selected=(((t=l.data)==null?void 0:t.judges)||[]).map(c=>({user_id:c.id,name:c.name,is_chief:!!c.is_chief})),$("#branchJudgesModal").modal("show")}catch{m.fire("Gagal","Gagal memuat hakim cabang.","error")}}},z=async()=>{var s,t;if(d.value.id){if(d.value.selected.length===0){m.fire("Validasi","Pilih minimal 1 hakim.","warning");return}d.value.saving=!0;try{await y.put(`/api/v1/event-branches/${d.value.id}/judges`,{judges:d.value.selected.map(l=>({user_id:l.user_id,is_chief:l.is_chief}))}),$("#branchJudgesModal").modal("hide"),m.fire("Berhasil","Hakim cabang disimpan.","success"),_(r.value.current_page||1)}catch(l){m.fire("Gagal",((t=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:t.message)||"Gagal menyimpan hakim cabang.","error")}finally{d.value.saving=!1}}},q=async s=>{var t,l;n.value=J(),n.value.id=s.id,n.value.title=s.full_name,n.value.use_custom_judges=!!s.use_custom_judges;try{const c=await y.get(`/api/v1/event-groups/${s.id}/judges`);n.value.use_custom_judges=!!((t=c.data)!=null&&t.use_custom_judges),n.value.selected=(((l=c.data)==null?void 0:l.judges)||[]).map(v=>({user_id:v.id,name:v.name,is_chief:!!v.is_chief})),$("#groupJudgesModal").modal("show")}catch{m.fire("Gagal","Gagal memuat hakim golongan.","error")}},Q=async()=>{var s,t;if(n.value.id)try{await y.patch(`/api/v1/event-groups/${n.value.id}/use-custom-judges`,{use_custom_judges:!!n.value.use_custom_judges}),_(r.value.current_page||1)}catch(l){m.fire("Gagal",((t=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:t.message)||"Gagal menyimpan pengaturan.","error")}},R=async()=>{var s,t;if(n.value.id&&n.value.use_custom_judges){if(n.value.selected.length===0){m.fire("Validasi","Pilih minimal 1 hakim untuk override.","warning");return}n.value.saving=!0;try{await y.put(`/api/v1/event-groups/${n.value.id}/judges`,{judges:n.value.selected.map(l=>({user_id:l.user_id,is_chief:l.is_chief}))}),$("#groupJudgesModal").modal("hide"),m.fire("Berhasil","Hakim golongan disimpan.","success"),_(r.value.current_page||1)}catch(l){m.fire("Gagal",((t=(s=l==null?void 0:l.response)==null?void 0:s.data)==null?void 0:t.message)||"Gagal menyimpan hakim golongan.","error")}finally{n.value.saving=!1}}};return j(()=>d.value.userSearch,D(async s=>{d.value.userOptions=await V(s)},300)),j(()=>n.value.userSearch,D(async s=>{n.value.userOptions=await V(s)},300)),j(()=>S.value,D(()=>_(1),400)),j(()=>H.value,()=>_(1)),j(()=>x.value,s=>{s&&_(1)}),X(()=>{x.value?_(1):m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(s,t)=>{var l,c,v;return o(),i(k,null,[e("section",te,[e("div",se,[e("div",ae,[e("div",null,[t[9]||(t[9]=e("h1",{class:"mb-1"},"Majelis Hakim (Cabang / Golongan)",-1)),t[10]||(t[10]=e("p",{class:"mb-0 text-muted text-sm"}," Kelola hakim default per cabang dan override per golongan dalam satu tempat. ",-1)),x.value?(o(),i("p",le,[t[7]||(t[7]=g(" Event aktif: ")),e("strong",null,u((l=w.value)==null?void 0:l.event_name),1),(c=w.value)!=null&&c.event_year?(o(),i("span",ne," ("+u(w.value.event_year)+")",1)):f("",!0),t[8]||(t[8]=g(" • Lokasi: ")),e("strong",null,u(((v=w.value)==null?void 0:v.event_location)||"-"),1)])):f("",!0)])]),x.value?f("",!0):(o(),i("p",ie,t[11]||(t[11]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),g(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",oe,[e("div",de,[e("div",ue,[e("div",re,[e("div",ce,[e("div",me,[t[13]||(t[13]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),G(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>H.value=a),class:"form-control form-control-sm w-auto mr-2"},t[12]||(t[12]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[Y,H.value,void 0,{number:!0}]]),t[14]||(t[14]=e("label",{class:"mb-0 text-sm text-muted mr-3"},"Entri",-1))]),e("div",ve,[G(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>S.value=a),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"280px"},placeholder:"Cari cabang / golongan..."},null,512),[[U,S.value]])])])]),e("div",ge,[e("table",_e,[t[19]||(t[19]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"50px"}},"#"),e("th",null,"Cabang / Golongan"),e("th",{style:{width:"380px"}},"Majelis Hakim"),e("th",{style:{width:"170px"},class:"text-center"},"Mode"),e("th",{style:{width:"160px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[B.value?(o(),i("tr",pe,t[15]||(t[15]=[e("td",{colspan:"5",class:"text-center py-4"},"Memuat data majelis hakim...",-1)]))):O.value.length===0?(o(),i("tr",he,t[16]||(t[16]=[e("td",{colspan:"5",class:"text-center py-4"}," Belum ada data golongan untuk event ini. ",-1)]))):f("",!0),(o(!0),i(k,null,C(O.value,(a,p)=>(o(),i("tr",{key:a.id},[e("td",be,u(L(p)),1),e("td",null,[e("div",null,[e("strong",null,u(a.branch_name),1)]),e("div",fe,u(a.group_name),1),e("div",ke,u(a.full_name),1)]),e("td",null,[(a.effective_judges||[]).length?(o(),i("div",ye,[(o(!0),i(k,null,C(a.effective_judges,(h,Mt)=>(o(),i("div",{key:h.id,class:"mb-1"},[e("span",{class:M(["badge border",h.is_chief?"badge-warning":"badge-light"])},[h.is_chief?(o(),i("i",xe)):(o(),i("i",Ce)),g(" "+u(h.name)+" ",1),h.is_chief?(o(),i("span",we,"(Ketua)")):f("",!0)],2)]))),128))])):(o(),i("span",je," Belum ada hakim. "))]),e("td",Ge,[e("span",{class:M(["badge",a.use_custom_judges?"badge-warning":"badge-success"])},[e("i",{class:M(a.use_custom_judges?"fas fa-random mr-1":"fas fa-layer-group mr-1")},null,2),g(" "+u(a.use_custom_judges?"CUSTOM (Golongan)":"DEFAULT (Cabang)"),1)],2)]),e("td",Me,[e("div",Se,[e("button",{class:"btn btn-outline-primary btn-xs",title:"Kelola Hakim Cabang (Default)",disabled:!a.event_branch_id,onClick:h=>N(a)},t[17]||(t[17]=[e("i",{class:"fas fa-sitemap"},null,-1)]),8,$e),e("button",{class:"btn btn-outline-warning btn-xs",title:"Kelola Hakim Golongan (Override)",onClick:h=>q(a)},t[18]||(t[18]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,He)])])]))),128))])])]),e("div",Je,[e("div",Oe,[e("div",Be," Menampilkan "+u(r.value.from||0)+" - "+u(r.value.to||0)+" dari "+u(r.value.total||0)+" data ",1),e("ul",Ue,[e("li",{class:M(["page-item",{disabled:r.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:t[2]||(t[2]=F(a=>E(r.value.current_page-1),["prevent"]))},"«")],2),e("li",De,[e("span",Ee,"Halaman "+u(r.value.current_page)+" / "+u(r.value.last_page||1),1)]),e("li",{class:M(["page-item",{disabled:r.value.current_page===r.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:t[3]||(t[3]=F(a=>E(r.value.current_page+1),["prevent"]))},"»")],2)])])])])]),e("div",Ve,[e("div",Pe,[e("div",Te,[e("div",Ae,[e("h5",Ke," Hakim Cabang (Default) — "+u(d.value.title),1),t[20]||(t[20]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Fe,[e("div",Ie,[t[22]||(t[22]=e("label",{class:"text-sm text-muted mb-1"},"Cari Hakim",-1)),G(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>d.value.userSearch=a),class:"form-control form-control-sm",placeholder:"Ketik nama..."},null,512),[[U,d.value.userSearch]]),d.value.userOptions.length?(o(),i("div",Le,[(o(!0),i(k,null,C(d.value.userOptions,a=>(o(),i("div",{key:a.id,class:"d-flex align-items-center justify-content-between py-1"},[e("div",null,[e("strong",Ne,u(a.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:p=>P(d.value,a)},t[21]||(t[21]=[e("i",{class:"fas fa-plus mr-1"},null,-1),g(" Tambah ")]),8,ze)]))),128))])):f("",!0)]),t[26]||(t[26]=e("hr",{class:"my-2"},null,-1)),e("div",null,[t[25]||(t[25]=e("div",{class:"d-flex justify-content-between align-items-center mb-2"},[e("strong",null,"Daftar Hakim Cabang"),e("small",{class:"text-muted"},"Pilih 1 ketua majelis (opsional)")],-1)),d.value.selected.length===0?(o(),i("div",qe," Belum ada hakim dipilih. ")):(o(),i("div",Qe,[e("table",Re,[t[24]||(t[24]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",null,"Hakim"),e("th",{style:{width:"140px"},class:"text-center"},"Ketua"),e("th",{style:{width:"90px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[(o(!0),i(k,null,C(d.value.selected,a=>(o(),i("tr",{key:a.user_id},[e("td",null,[e("strong",null,u(a.name),1)]),e("td",We,[e("input",{type:"radio",name:"branchChief",checked:a.is_chief,onChange:p=>A(d.value,a.user_id)},null,40,Xe)]),e("td",Ye,[e("button",{class:"btn btn-xs btn-outline-danger",onClick:p=>T(d.value,a.user_id)},t[23]||(t[23]=[e("i",{class:"fas fa-times"},null,-1)]),8,Ze)])]))),128))])])]))])]),e("div",et,[t[28]||(t[28]=e("button",{class:"btn btn-sm btn-secondary","data-dismiss":"modal"},"Tutup",-1)),e("button",{class:"btn btn-sm btn-primary",disabled:d.value.saving,onClick:z},t[27]||(t[27]=[e("i",{class:"fas fa-save mr-1"},null,-1),g(" Simpan ")]),8,tt)])])])]),e("div",st,[e("div",at,[e("div",lt,[e("div",nt,[e("h5",it," Hakim Golongan (Override) — "+u(n.value.title),1),t[29]||(t[29]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",ot,[e("div",dt,[t[31]||(t[31]=e("div",null,[e("strong",null,"Override untuk golongan ini"),e("div",{class:"text-xs text-muted"},"Jika OFF, sistem memakai default cabang.")],-1)),e("div",ut,[G(e("input",{type:"checkbox",class:"custom-control-input",id:"toggleCustom","onUpdate:modelValue":t[5]||(t[5]=a=>n.value.use_custom_judges=a),onChange:Q},null,544),[[Z,n.value.use_custom_judges]]),t[30]||(t[30]=e("label",{class:"custom-control-label",for:"toggleCustom"}," Gunakan hakim khusus ",-1))])]),n.value.use_custom_judges?(o(),i("div",ct,[e("div",mt,[t[33]||(t[33]=e("label",{class:"text-sm text-muted mb-1"},"Cari Hakim",-1)),G(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>n.value.userSearch=a),class:"form-control form-control-sm",placeholder:"Ketik nama..."},null,512),[[U,n.value.userSearch]]),n.value.userOptions.length?(o(),i("div",vt,[(o(!0),i(k,null,C(n.value.userOptions,a=>(o(),i("div",{key:a.id,class:"d-flex align-items-center justify-content-between py-1"},[e("div",null,[e("strong",gt,u(a.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:p=>P(n.value,a)},t[32]||(t[32]=[e("i",{class:"fas fa-plus mr-1"},null,-1),g(" Tambah ")]),8,_t)]))),128))])):f("",!0)]),t[37]||(t[37]=e("hr",{class:"my-2"},null,-1)),e("div",null,[t[36]||(t[36]=e("div",{class:"d-flex justify-content-between align-items-center mb-2"},[e("strong",null,"Daftar Hakim Golongan"),e("small",{class:"text-muted"},"Pilih 1 ketua majelis (opsional)")],-1)),n.value.selected.length===0?(o(),i("div",pt," Belum ada hakim dipilih. ")):(o(),i("div",ht,[e("table",bt,[t[35]||(t[35]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",null,"Hakim"),e("th",{style:{width:"140px"},class:"text-center"},"Ketua"),e("th",{style:{width:"90px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[(o(!0),i(k,null,C(n.value.selected,a=>(o(),i("tr",{key:a.user_id},[e("td",null,[e("strong",null,u(a.name),1)]),e("td",ft,[e("input",{type:"radio",name:"groupChief",checked:a.is_chief,onChange:p=>A(n.value,a.user_id)},null,40,kt)]),e("td",yt,[e("button",{class:"btn btn-xs btn-outline-danger",onClick:p=>T(n.value,a.user_id)},t[34]||(t[34]=[e("i",{class:"fas fa-times"},null,-1)]),8,xt)])]))),128))])])]))])])):(o(),i("div",rt," Override dimatikan. Untuk mengubah majelis, aktifkan toggle di atas. "))]),e("div",Ct,[t[39]||(t[39]=e("button",{class:"btn btn-sm btn-secondary","data-dismiss":"modal"},"Tutup",-1)),e("button",{class:"btn btn-sm btn-warning",disabled:n.value.saving||!n.value.use_custom_judges,onClick:R},t[38]||(t[38]=[e("i",{class:"fas fa-save mr-1"},null,-1),g(" Simpan Override ")]),8,wt)])])])])])],64)}}},Jt=ee(jt,[["__scopeId","data-v-cabf9eb0"]]);export{Jt as default};
