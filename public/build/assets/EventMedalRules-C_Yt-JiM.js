import{z as q,y as U,A as v,O as A,V as L,B as d,C as u,D as e,I as M,J as c,K as o,S as _,aB as V,as as b,U as N,ay as Y,H as G,F as E,a as g,aC as z}from"./AuthUserStore-B6VIMEgo.js";import{S as m}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const J={class:"content-header"},O={class:"container-fluid"},Q={class:"d-flex justify-content-between align-items-center"},W={key:0,class:"mb-0 mt-1 text-sm text-muted"},X={key:0},Z={class:"d-flex flex-column flex-sm-row gap-2"},ee=["disabled"],te={key:0,class:"fas fa-spinner fa-spin mr-1"},ae={key:1,class:"fas fa-magic mr-1"},le=["disabled"],se={key:0,class:"text-danger text-sm mt-2 mb-0"},ne={class:"content"},oe={class:"container-fluid"},ie={class:"card"},re={class:"card-header"},de={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},ue={class:"d-flex align-items-center"},me={class:"card-body table-responsive p-0"},ve={class:"table table-bordered table-hover text-sm mb-0"},ce={key:0},pe={key:1},_e={class:"text-center"},fe={class:"text-center"},be={class:"text-center"},ge={class:"text-center"},he={class:"btn-group btn-group-sm"},xe=["onClick"],ye=["onClick"],ke={class:"card-footer clearfix py-2"},we={class:"d-flex justify-content-between align-items-center"},Me={class:"text-muted text-sm"},Ce={class:"pagination pagination-sm m-0"},Be={class:"page-item disabled"},Ae={class:"page-link"},Ge={class:"modal fade",id:"eventMedalRuleModal",tabindex:"-1"},Ee={class:"modal-dialog modal-lg"},Se={class:"modal-content"},Te={class:"modal-header py-2"},Ue={class:"modal-title"},Ve={class:"modal-body pt-2"},$e={class:"row"},Ne={class:"col-md-6"},Pe={class:"form-group mb-2"},De={class:"form-group mb-2"},Fe={class:"col-md-3"},Re={class:"form-group mb-2"},He={class:"form-group mb-2"},Ie={class:"col-md-3"},Ke={class:"form-group mb-2"},je={class:"text-right mt-3"},qe=["disabled"],Le={key:0,class:"fas fa-spinner fa-spin mr-1"},Ye={key:1,class:"fas fa-save mr-1"},Qe={__name:"EventMedalRules",setup(ze){const P=q(),f=U(()=>P.eventData||null),i=U(()=>{var l;return((l=f.value)==null?void 0:l.id)||null}),C=v([]),h=v(""),x=v(10),B=v(!1),y=v(!1),k=v(!1),w=v(!1),n=v({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),s=v({id:null,medal_code:"",medal_name:"",order_number:1,point:0,is_active:!0}),p=async(l=1)=>{if(i.value){B.value=!0;try{const r=(await g.get("/api/v1/event-medal-rules",{params:{event_id:i.value,page:l,per_page:x.value,search:h.value}})).data.data;C.value=r.data||[],n.value={current_page:r.current_page,per_page:r.per_page,total:r.total,from:r.from,to:r.to,last_page:r.last_page}}catch(t){console.error("Gagal memuat event_medal_rules:",t),m.fire("Gagal","Gagal memuat aturan medali event.","error")}finally{B.value=!1}}},D=()=>{if(!i.value){m.fire("Event belum dipilih","Silakan pilih event terlebih dahulu.","warning");return}y.value=!1,s.value={id:null,medal_code:"",medal_name:"",order_number:(n.value.total||0)+1,point:0,is_active:!0},$("#eventMedalRuleModal").modal("show")},F=l=>{y.value=!0,s.value={...l},$("#eventMedalRuleModal").modal("show")},R=async()=>{if(i.value){k.value=!0;try{const l={event_id:i.value,medal_code:s.value.medal_code,medal_name:s.value.medal_name,order_number:s.value.order_number,point:s.value.point,is_active:s.value.is_active};y.value&&s.value.id?(await g.put(`/api/v1/event-medal-rules/${s.value.id}`,l),m.fire("Berhasil","Aturan medali event diperbarui.","success")):(await g.post("/api/v1/event-medal-rules",l),m.fire("Berhasil","Aturan medali event ditambahkan.","success")),$("#eventMedalRuleModal").modal("hide"),p(n.value.current_page)}catch(l){console.error("Gagal menyimpan event_medal_rule:",l),m.fire("Gagal","Gagal menyimpan aturan medali event.","error")}finally{k.value=!1}}},H=async l=>{if((await m.fire({title:"Hapus Aturan Medali?",text:`Yakin ingin menghapus "${l.medal_name}" dari event ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await g.delete(`/api/v1/event-medal-rules/${l.id}`),m.fire("Terhapus","Aturan medali event berhasil dihapus.","success"),p(n.value.current_page)}catch(r){console.error("Gagal menghapus event_medal_rule:",r),m.fire("Gagal","Gagal menghapus aturan medali event.","error")}},I=async()=>{if(!(!i.value||!(await m.fire({title:"Generate dari Template?",text:"Aturan medali event akan disalin dari Master Aturan Medali.",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Generate",cancelButtonText:"Batal"})).isConfirmed)){w.value=!0;try{await g.post("/api/v1/event-medal-rules/generate-from-template",{event_id:i.value}),m.fire("Berhasil","Aturan medali event berhasil digenerate.","success"),p(1)}catch(t){console.error("Gagal generate event_medal_rules:",t),m.fire("Gagal","Gagal generate aturan medali event.","error")}finally{w.value=!1}}};return A(()=>h.value,z(()=>p(1),400)),A(()=>x.value,()=>p(1)),A(()=>i.value,l=>{l&&p(1)}),L(()=>{i.value?p():m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(l,t)=>{var r,S,T;return u(),d(N,null,[e("section",J,[e("div",O,[e("div",Q,[e("div",null,[t[11]||(t[11]=e("h1",{class:"mb-1"},"Aturan Medali Event",-1)),t[12]||(t[12]=e("p",{class:"mb-0 text-muted text-sm"}," Mengatur aturan medali khusus untuk event aktif (override dari template). ",-1)),i.value?(u(),d("p",W,[t[9]||(t[9]=c(" Event aktif: ")),e("strong",null,o((r=f.value)==null?void 0:r.event_name),1),(S=f.value)!=null&&S.event_year?(u(),d("span",X," ("+o(f.value.event_year)+") ",1)):M("",!0),t[10]||(t[10]=c(" • Lokasi: ")),e("strong",null,o(((T=f.value)==null?void 0:T.event_location)||"-"),1)])):M("",!0)]),e("div",Z,[e("button",{class:"btn btn-outline-secondary btn-sm mr-sm-2 mb-2 mb-sm-0",onClick:I,disabled:w.value||!i.value},[w.value?(u(),d("i",te)):(u(),d("i",ae)),t[13]||(t[13]=c(" Generate dari Template "))],8,ee),e("button",{class:"btn btn-primary btn-sm",onClick:D,disabled:!i.value}," + Tambah Aturan Medali ",8,le)])]),i.value?M("",!0):(u(),d("p",se,t[14]||(t[14]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),c(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",ne,[e("div",oe,[e("div",ie,[e("div",re,[e("div",de,[e("div",ue,[t[16]||(t[16]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),_(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>x.value=a),class:"form-control form-control-sm w-auto mr-2"},t[15]||(t[15]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1)]),512),[[V,x.value,void 0,{number:!0}]]),t[17]||(t[17]=e("label",{class:"mb-0 text-sm text-muted"},"Entri",-1))]),_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>h.value=a),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari kode / nama medali..."},null,512),[[b,h.value]])])]),e("div",me,[e("table",ve,[t[22]||(t[22]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",{style:{width:"140px"}},"Kode"),e("th",null,"Nama Medali"),e("th",{style:{width:"90px"},class:"text-center"},"Urutan"),e("th",{style:{width:"90px"},class:"text-center"},"Poin"),e("th",{style:{width:"90px"},class:"text-center"},"Status"),e("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[B.value?(u(),d("tr",ce,t[18]||(t[18]=[e("td",{colspan:"7",class:"text-center"}," Memuat aturan medali event... ",-1)]))):C.value.length===0?(u(),d("tr",pe,t[19]||(t[19]=[e("td",{colspan:"7",class:"text-center"},[c(" Belum ada aturan medali untuk event ini. "),e("br"),e("small",{class:"text-muted"},[c(" Klik "),e("strong",null,"Generate dari Template"),c(" atau "),e("strong",null,"Tambah Aturan Medali"),c(". ")])],-1)]))):M("",!0),(u(!0),d(N,null,Y(C.value,(a,K)=>(u(),d("tr",{key:a.id},[e("td",null,o(K+1+(n.value.current_page-1)*n.value.per_page),1),e("td",null,[e("code",null,o(a.medal_code),1)]),e("td",null,[e("strong",null,o(a.medal_name),1)]),e("td",_e,o(a.order_number),1),e("td",fe,o(a.point),1),e("td",be,[e("span",{class:G(["badge",a.is_active?"badge-success":"badge-secondary"])},o(a.is_active?"Aktif":"Nonaktif"),3)]),e("td",ge,[e("div",he,[e("button",{class:"btn btn-warning",onClick:j=>F(a)},t[20]||(t[20]=[e("i",{class:"fas fa-edit"},null,-1)]),8,xe),e("button",{class:"btn btn-danger",onClick:j=>H(a)},t[21]||(t[21]=[e("i",{class:"fas fa-trash"},null,-1)]),8,ye)])])]))),128))])])]),e("div",ke,[e("div",we,[e("div",Me," Menampilkan "+o(n.value.from||0)+" - "+o(n.value.to||0)+" dari "+o(n.value.total||0)+" aturan ",1),e("ul",Ce,[e("li",{class:G(["page-item",{disabled:n.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:t[2]||(t[2]=E(a=>l.changePage(n.value.current_page-1),["prevent"]))},"«")],2),e("li",Be,[e("span",Ae," Halaman "+o(n.value.current_page)+" / "+o(n.value.last_page||1),1)]),e("li",{class:G(["page-item",{disabled:n.value.current_page===n.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:t[3]||(t[3]=E(a=>l.changePage(n.value.current_page+1),["prevent"]))},"»")],2)])])])])]),e("div",Ge,[e("div",Ee,[e("div",Se,[e("div",Te,[e("h5",Ue,o(y.value?"Edit Aturan Medali Event":"Tambah Aturan Medali Event"),1),t[23]||(t[23]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Ve,[e("form",{onSubmit:E(R,["prevent"])},[e("div",$e,[e("div",Ne,[e("div",Pe,[t[24]||(t[24]=e("label",{class:"mb-1"},"Kode Medali",-1)),_(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>s.value.medal_code=a),class:"form-control form-control-sm",required:""},null,512),[[b,s.value.medal_code]])]),e("div",De,[t[25]||(t[25]=e("label",{class:"mb-1"},"Nama Medali",-1)),_(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>s.value.medal_name=a),class:"form-control form-control-sm",required:""},null,512),[[b,s.value.medal_name]])])]),e("div",Fe,[e("div",Re,[t[26]||(t[26]=e("label",{class:"mb-1"},"Urutan",-1)),_(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>s.value.order_number=a),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[b,s.value.order_number,void 0,{number:!0}]])]),e("div",He,[t[27]||(t[27]=e("label",{class:"mb-1"},"Poin",-1)),_(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>s.value.point=a),type:"number",min:"0",class:"form-control form-control-sm"},null,512),[[b,s.value.point,void 0,{number:!0}]])])]),e("div",Ie,[e("div",Ke,[t[29]||(t[29]=e("label",{class:"mb-1"},"Status",-1)),_(e("select",{"onUpdate:modelValue":t[8]||(t[8]=a=>s.value.is_active=a),class:"form-control form-control-sm"},t[28]||(t[28]=[e("option",{value:!0},"Aktif",-1),e("option",{value:!1},"Nonaktif",-1)]),512),[[V,s.value.is_active]])])])]),e("div",je,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:k.value||!i.value},[k.value?(u(),d("i",Le)):(u(),d("i",Ye)),t[30]||(t[30]=c(" Simpan "))],8,qe)])],32)])])])])])],64)}}};export{Qe as default};
