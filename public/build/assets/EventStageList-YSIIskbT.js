import{z,A as m,y as O,O as P,V as q,B as i,C as d,D as e,I as C,J as c,K as o,S as p,as as _,U as G,ay as H,H as U,F as A,aB as K,a as D,aC as Q}from"./AuthUserStore-B6VIMEgo.js";import{S as R}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const W={class:"content-header"},X={class:"container-fluid"},Y={class:"d-flex justify-content-between align-items-center"},Z={key:0,class:"mb-0 mt-1 text-sm text-muted"},ee={key:0},te={class:"d-flex gap-2"},ae=["disabled"],se={key:0,class:"fas fa-spinner fa-spin mr-1"},ne={key:1,class:"fas fa-magic mr-1"},le={class:"content"},oe={class:"container-fluid"},re={class:"card"},ie={class:"card-header d-flex justify-content-between align-items-center"},de={key:0,class:"text-muted text-sm"},ue={class:"card-body table-responsive p-0"},me={class:"table table-bordered table-hover text-sm"},ve={key:0},pe={key:1},ce=["onClick"],_e={class:"card-footer clearfix"},fe={class:"d-flex justify-content-between align-items-center"},ge={class:"text-muted text-sm"},be={class:"pagination pagination-sm m-0"},he={class:"page-item disabled"},ye={class:"page-link"},ke={class:"modal fade",id:"stageModal",tabindex:"-1",role:"dialog"},xe={class:"modal-dialog modal-lg",role:"document"},we={class:"modal-content"},Te={class:"modal-header py-2"},Se={class:"modal-title",id:"stageModalLabel"},Me={class:"modal-body pt-2"},Ce={class:"row"},$e={class:"col-md-6"},De={class:"form-group mb-2"},Ue={class:"form-group mb-2"},Ae={class:"form-group mb-2"},Ve={class:"col-md-6"},Ee={class:"form-group mb-2"},Ge={class:"form-group mb-2"},Ne={class:"form-group mb-2"},Ie={class:"text-end mt-3"},Le=["disabled"],Be={key:0,class:"fas fa-spinner fa-spin me-1"},Fe={key:1,class:"fas fa-save me-1"},Pe={__name:"EventStageList",setup(je){const b=z(),f=m([]),l=m({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),h=m(""),y=m(!1),k=m(!1),x=m(!1),s=m({id:null,event_id:null,stage_id:null,name:"",order_number:1,start_date:"",end_date:"",notes:"",is_active:!0}),N=m(null),u=m(null),v=O(()=>b.eventData||null),V=a=>a?/^\d{4}-\d{2}-\d{2}$/.test(a)?a:String(a).substring(0,10):"",w=a=>{if(!a)return"";const t=String(a).substring(0,10),[r,S,M]=t.split("-");return`${M} ${["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"][parseInt(S)-1]} ${r}`},g=async(a=1)=>{if(!u.value){f.value=[];return}y.value=!0;try{const r=(await D.get(`/api/v1/events/${u.value}/stages`,{params:{page:a,search:h.value}})).data.data;f.value=r.data||[],l.value={current_page:r.current_page,per_page:r.per_page,total:r.total,from:r.from,to:r.to,last_page:r.last_page}}catch(t){t.response&&t.response.status===401?(console.warn("Unauthorized. Logging out..."),b.logout()):console.error("Gagal memuat data tahapan:",t)}finally{y.value=!1}},E=a=>{a<1||a>l.value.last_page||g(a)},I=()=>{k.value=!1,s.value={id:null,event_id:u.value,stage_id:null,name:"",order_number:(l.value.total||0)+1,start_date:"",end_date:"",notes:"",is_active:!0},$("#stageModal").modal("show")},L=a=>{k.value=!0,s.value={id:a.id,event_id:a.event_id,stage_id:a.stage_id,name:a.name,order_number:a.order_number,start_date:V(a.start_date),end_date:V(a.end_date),notes:a.notes,is_active:!!a.is_active},console.log("form.value"),console.log(s.value),$("#stageModal").modal("show")},B=async()=>{if(!u.value){alert("Event belum terdeteksi. Silakan kembali ke halaman utama dan pilih event.");return}x.value=!0;const a={event_id:u.value,stage_id:s.value.stage_id,name:s.value.name,order_number:s.value.order_number,start_date:s.value.start_date||null,end_date:s.value.end_date||null,notes:s.value.notes,is_active:s.value.is_active};try{k.value&&s.value.id?await D.put(`/api/v1/event-stages/${s.value.id}`,a):await D.post("/api/v1/event-stages",a),$("#stageModal").modal("hide"),g(l.value.current_page)}catch(t){console.error("Gagal menyimpan tahapan:",t),alert("Gagal menyimpan tahapan.")}finally{x.value=!1}},T=m(!1),F=()=>{if(!u.value){alert("Event belum terdeteksi. Silakan pilih event terlebih dahulu.");return}f.value.length>0&&!confirm(`Tahapan untuk event ini sudah ada. Generate ulang akan menambah tahapan baru berdasarkan template master.

Lanjutkan?`)||j()},j=async()=>{T.value=!0;try{await D.post(`/api/v1/events/${u.value}/stages/generate-default`),await g(1),R.fire({icon:"success",title:"Tahapan berhasil digenerate dari template master.",showConfirmButton:!1,timer:2e3})}catch(a){console.error("Gagal generate tahapan:",a),alert("Gagal generate tahapan.")}finally{T.value=!1}};return P(()=>h.value,Q(()=>g(1),400)),q(()=>{N.value=b.eventData,u.value=b.eventData.id,g()}),(a,t)=>{var r,S,M;return d(),i(G,null,[e("section",W,[e("div",X,[e("div",Y,[e("div",null,[t[11]||(t[11]=e("h1",{class:"mb-1"},"Data Tahapan Peserta",-1)),t[12]||(t[12]=e("p",{class:"mb-0 text-muted text-sm"}," Mengatur Tahapan Event. ",-1)),u.value?(d(),i("p",Z,[t[9]||(t[9]=c(" Event aktif: ")),e("strong",null,o((r=v.value)==null?void 0:r.event_name),1),(S=v.value)!=null&&S.event_year?(d(),i("span",ee," ("+o(v.value.event_year)+")",1)):C("",!0),t[10]||(t[10]=c(" • Lokasi: ")),e("strong",null,o(((M=v.value)==null?void 0:M.event_location)||"-"),1)])):C("",!0)]),e("div",te,[e("button",{class:"btn btn-outline-secondary btn-sm mr-2",onClick:F,disabled:!u.value||T.value||y.value},[T.value?(d(),i("i",se)):(d(),i("i",ne)),t[13]||(t[13]=c(" Generate dari Template "))],8,ae),e("button",{class:"btn btn-primary btn-sm",onClick:I}," + Tambah Tahapan ")])])])]),e("section",le,[e("div",oe,[e("div",re,[e("div",ie,[p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>h.value=n),type:"text",class:"form-control form-control-sm w-50",placeholder:"Cari nama tahapan..."},null,512),[[_,h.value]]),v.value?(d(),i("span",de,[t[14]||(t[14]=c(" Periode Event: ")),e("strong",null,o(w(v.value.start_date))+" s.d. "+o(w(v.value.end_date)),1)])):C("",!0)]),e("div",ue,[e("table",me,[t[18]||(t[18]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"No"),e("th",null,"Nama Tahapan"),e("th",{style:{width:"150px"}},"Tanggal Awal"),e("th",{style:{width:"150px"}},"Tanggal Akhir"),e("th",{style:{width:"90px"}},"Status"),e("th",{style:{width:"90px"}},"Aksi")])],-1)),e("tbody",null,[y.value?(d(),i("tr",ve,t[15]||(t[15]=[e("td",{colspan:"7",class:"text-center"},"Memuat data...",-1)]))):f.value.length===0?(d(),i("tr",pe,t[16]||(t[16]=[e("td",{colspan:"7",class:"text-center"},"Tidak ada data tahapan.",-1)]))):C("",!0),(d(!0),i(G,null,H(f.value,(n,J)=>(d(),i("tr",{key:n.id},[e("td",null,o(J+1+(l.value.current_page-1)*l.value.per_page),1),e("td",null,[e("strong",null,o(n.name),1)]),e("td",null,o(w(n.start_date)||"-"),1),e("td",null,o(w(n.end_date)||"-"),1),e("td",null,[e("span",{class:U(["badge",n.is_active?"badge-success":"badge-secondary"])},o(n.is_active?"Aktif":"Nonaktif"),3)]),e("td",null,[e("button",{class:"btn btn-sm btn-warning",onClick:Je=>L(n)},t[17]||(t[17]=[e("i",{class:"fas fa-edit"},null,-1)]),8,ce)])]))),128))])])]),e("div",_e,[e("div",fe,[e("div",ge," Menampilkan "+o(l.value.from||0)+" - "+o(l.value.to||0)+" dari "+o(l.value.total||0)+" tahapan ",1),e("ul",be,[e("li",{class:U(["page-item",{disabled:l.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=A(n=>E(l.value.current_page-1),["prevent"]))}," « ")],2),e("li",he,[e("span",ye," Halaman "+o(l.value.current_page)+" / "+o(l.value.last_page||1),1)]),e("li",{class:U(["page-item",{disabled:l.value.current_page===l.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=A(n=>E(l.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",ke,[e("div",xe,[e("div",we,[e("div",Te,[e("h5",Se,[t[19]||(t[19]=e("i",{class:"fas fa-list-alt me-2"},null,-1)),c(" "+o(k.value?"Edit Tahapan":"Tambah Tahapan"),1)]),t[20]||(t[20]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Me,[e("form",{onSubmit:A(B,["prevent"])},[e("div",Ce,[e("div",$e,[e("div",De,[t[21]||(t[21]=e("label",{class:"mb-1"},"Nama Tahapan",-1)),p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>s.value.name=n),class:"form-control form-control-sm",required:""},null,512),[[_,s.value.name]])]),e("div",Ue,[t[22]||(t[22]=e("label",{class:"mb-1"},"Urutan Tahapan",-1)),p(e("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>s.value.order_number=n),type:"number",min:"1",class:"form-control form-control-sm",required:""},null,512),[[_,s.value.order_number,void 0,{number:!0}]])]),e("div",Ae,[t[24]||(t[24]=e("label",{class:"mb-1"},"Status",-1)),p(e("select",{"onUpdate:modelValue":t[5]||(t[5]=n=>s.value.is_active=n),class:"form-control form-control-sm"},t[23]||(t[23]=[e("option",{value:!0},"Aktif",-1),e("option",{value:!1},"Nonaktif",-1)]),512),[[K,s.value.is_active]])])]),e("div",Ve,[e("div",Ee,[t[25]||(t[25]=e("label",{class:"mb-1"},"Tanggal Awal",-1)),p(e("input",{"onUpdate:modelValue":t[6]||(t[6]=n=>s.value.start_date=n),type:"date",class:"form-control form-control-sm"},null,512),[[_,s.value.start_date]])]),e("div",Ge,[t[26]||(t[26]=e("label",{class:"mb-1"},"Tanggal Akhir",-1)),p(e("input",{"onUpdate:modelValue":t[7]||(t[7]=n=>s.value.end_date=n),type:"date",class:"form-control form-control-sm"},null,512),[[_,s.value.end_date]])]),e("div",Ne,[t[27]||(t[27]=e("label",{class:"mb-1"},"Keterangan",-1)),p(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=n=>s.value.notes=n),rows:"3",class:"form-control form-control-sm",placeholder:"Opsional: catatan internal untuk tahapan ini..."},null,512),[[_,s.value.notes]])])])]),e("div",Ie,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:x.value},[x.value?(d(),i("i",Be)):(d(),i("i",Fe)),t[28]||(t[28]=c(" Simpan "))],8,Le)])],32)])])])])])],64)}}};export{Pe as default};
