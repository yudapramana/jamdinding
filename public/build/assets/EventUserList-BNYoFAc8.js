import{z as Q,A as v,y as U,O as R,V as W,B as l,C as n,D as e,J as r,I as x,K as u,S as b,as as g,U as M,ay as q,H as A,F as C,aB as F,a as w,aC as X}from"./AuthUserStore-B6VIMEgo.js";import{S as Z}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const ee={class:"content-header"},ae={class:"container-fluid"},te={class:"d-flex justify-content-between align-items-center"},se={key:0,class:"text-sm text-muted mb-0"},le={key:0},ne={class:"text-xs"},oe={key:1,class:"text-sm text-danger mb-0"},re={class:"btn-group"},ie=["disabled"],ue={key:0,class:"fas fa-spinner fa-spin mr-1"},de={key:1,class:"fas fa-users-cog mr-1"},me=["disabled"],ve={class:"content"},pe={class:"container-fluid"},ce={class:"card"},be={class:"card-header"},fe={class:"card-body table-responsive p-0"},_e={class:"table table-bordered table-hover text-sm"},ge={key:0},ke={key:1},ye={key:0,class:"badge badge-info"},he={key:1,class:"text-muted"},xe={key:0},we={key:1,class:"text-muted"},Ue={class:"text-center"},Ee={class:"btn-group btn-group-sm"},Ge=["onClick"],Me=["onClick"],Ce={class:"card-footer clearfix"},Se={class:"d-flex justify-content-between align-items-center"},Ve={class:"text-muted"},$e={class:"pagination pagination-sm m-0"},Ne={class:"page-item disabled"},Te={class:"page-link"},De={class:"modal fade",id:"eventUserModal",tabindex:"-1",role:"dialog"},qe={class:"modal-dialog modal-lg",role:"document"},Le={class:"modal-content"},Be={class:"modal-header py-2"},Ke={class:"modal-title",id:"eventUserModalLabel"},Pe={class:"modal-body pt-2"},Re={class:"row"},Ae={class:"col-md-6"},Fe={class:"form-group mb-2"},Oe={class:"form-group mb-2"},je={class:"form-group mb-2"},He={class:"form-group mb-2"},ze={class:"mb-1"},Ie={key:0,class:"text-muted"},Je=["required"],Ye={class:"col-md-6"},Qe={class:"form-group mb-2"},We=["value"],Xe={class:"form-group mb-2"},Ze=["value"],ea={class:"form-group mb-2"},aa={class:"text-end mt-3"},ta=["disabled"],sa={key:0,class:"fas fa-spinner fa-spin mr-1"},la={key:1,class:"fas fa-save mr-1"},na={class:"modal fade",id:"generateUserModal",tabindex:"-1",role:"dialog"},oa={class:"modal-dialog",role:"document"},ra={class:"modal-content"},ia={class:"modal-body"},ua={key:0,class:"text-sm mb-2"},da={class:"text-xs text-muted mb-3"},ma={key:0},va={key:1},pa={class:"form-group mb-2"},ca=["value"],ba={class:"form-group mb-2"},fa={class:"form-group mb-2"},_a={class:"text-right mt-3"},ga=["disabled"],ka=["disabled"],ya={key:0,class:"fas fa-spinner fa-spin mr-1"},ha={key:1,class:"fas fa-play mr-1"},Ga={__name:"EventUserList",setup(xa){const S=Q(),V=v([]),d=v({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),E=v(""),N=v(!1),G=v(!1),h=v(!1),o=v({}),T=v([]),i=v(null),p=v(null),k=v(!1),m=v({role_id:null,default_password:"",email_domain:""}),D=U(()=>i.value?i.value.event_name||i.value.nama_event||i.value.name||`Event #${i.value.id}`:""),L=U(()=>i.value&&(i.value.app_name||i.value.nama_aplikasi)||""),y=U(()=>i.value&&(i.value.event_level||i.value.tingkat_event)||null),B=U(()=>{const s=y.value;switch(s){case"national":case"nasional":return"Nasional";case"province":case"provinsi":return"Provinsi";case"regency":case"kabupaten_kota":return"Kabupaten/Kota";case"district":case"kecamatan":return"Kecamatan";default:return s||"-"}}),K=U(()=>{const s=y.value;return s?s==="province"||s==="provinsi"||s==="regency"||s==="kabupaten_kota":!1}),P=()=>{const s=S.eventData;s&&typeof s=="object"?(i.value=s,p.value=s.id??null):(i.value=null,p.value=null)},O=()=>{if(!p.value||!i.value){alert("Event belum terdeteksi. Tidak dapat generate user.");return}if(!K.value){alert("Generate user hanya bisa untuk event tingkat provinsi/province atau kabupaten_kota/regency.");return}m.value={role_id:null,default_password:"",email_domain:""},$("#generateUserModal").modal("show")},j=async()=>{try{const s=await w.get("/api/v1/roles");T.value=s.data}catch(s){console.error("Gagal memuat roles:",s)}},f=async(s=1)=>{N.value=!0;try{const a=await w.get("/api/v1/users",{params:{page:s,search:E.value,event_id:p.value}});V.value=a.data.data||[],d.value={current_page:a.data.current_page,per_page:a.data.per_page,total:a.data.total,from:a.data.from,to:a.data.to,last_page:a.data.last_page}}catch(a){a.response&&a.response.status===401?(console.warn("Unauthorized. Logging out..."),S.logout()):console.error("Gagal memuat data user:",a)}finally{N.value=!1}},H=async()=>{var t,c;if(!p.value||!i.value)return;if(!m.value.role_id){alert("Silakan pilih role terlebih dahulu untuk user hasil generate.");return}const s=y.value;let a="Generate user otomatis untuk event ini?";if(s==="province"||s==="provinsi"?a=`Generate user untuk SEMUA kabupaten/kota pada provinsi ini?
Nama & username user akan dibentuk dari: KODE_EVENT + nama kab/kota.
Password & domain email mengikuti pengaturan di form.`:(s==="regency"||s==="kabupaten_kota")&&(a=`Generate user untuk SEMUA kecamatan pada kabupaten/kota ini?
Nama & username user akan dibentuk dari: KODE_EVENT + nama kecamatan.
Password & domain email mengikuti pengaturan di form.`),!!confirm(a)){k.value=!0;try{const _={role_id:m.value.role_id};m.value.default_password&&(_.default_password=m.value.default_password),m.value.email_domain&&(_.email_domain=m.value.email_domain);const wa=await w.post(`/api/v1/events/${p.value}/generate-users`,_);$("#generateUserModal").modal("hide"),Z.fire({icon:"success",title:"Generate User Berhasil",showConfirmButton:!1,timer:2e3}),await f(d.value.current_page)}catch(_){console.error("Gagal generate user:",_),alert(((c=(t=_.response)==null?void 0:t.data)==null?void 0:c.message)||"Gagal generate user otomatis.")}finally{k.value=!1}}},z=()=>{!p.value&&!confirm("Event belum terdeteksi. Tambah user sebagai global (tanpa event)?")||(h.value=!1,o.value={id:null,name:"",email:"",username:"",password:"",role_id:null,avatar:"",event_id:p.value},$("#eventUserModal").modal("show"))},I=s=>{h.value=!0,o.value={id:s.id,name:s.name,email:s.email,username:s.username,password:"",role_id:s.role_id||(s.role?s.role.id:null),avatar:s.avatar||"",event_id:s.event_id},$("#eventUserModal").modal("show")},J=async()=>{var a,t;G.value=!0;const s={name:o.value.name,email:o.value.email,username:o.value.username,role_id:o.value.role_id,avatar:o.value.avatar,event_id:p.value??o.value.event_id??null};o.value.password&&(s.password=o.value.password);try{h.value&&o.value.id?await w.put(`/api/v1/users/${o.value.id}`,s):await w.post("/api/v1/users",s),$("#eventUserModal").modal("hide"),await f(d.value.current_page)}catch(c){console.error("Gagal menyimpan user:",c),alert(((t=(a=c.response)==null?void 0:a.data)==null?void 0:t.message)||"Gagal menyimpan data user.")}finally{G.value=!1}},Y=async s=>{var a,t;if(confirm(`Yakin ingin menghapus user "${s.name}"?`))try{await w.delete(`/api/v1/users/${s.id}`),await f(d.value.current_page)}catch(c){console.error("Gagal menghapus user:",c),alert(((t=(a=c.response)==null?void 0:a.data)==null?void 0:t.message)||"Gagal menghapus user.")}};return R(E,X(()=>{f(1)},400)),R(()=>S.eventData,()=>{P(),f(1)},{immediate:!1}),W(()=>{P(),j(),f()}),(s,a)=>(n(),l(M,null,[e("section",ee,[e("div",ae,[e("div",te,[e("div",null,[a[15]||(a[15]=e("h1",{class:"mb-1"},"Daftar User Event",-1)),i.value?(n(),l("p",se,[a[13]||(a[13]=r(" Event: ")),e("strong",null,u(D.value),1),L.value?(n(),l("span",le," — "+u(L.value),1)):x("",!0),a[14]||(a[14]=e("br",null,null,-1)),e("span",ne,[a[12]||(a[12]=r(" Tingkat: ")),e("strong",null,u(B.value),1)])])):(n(),l("p",oe," Event belum dipilih. Silakan kembali ke landing dan pilih event terlebih dahulu. "))]),e("div",re,[p.value&&K.value?(n(),l("button",{key:0,class:"btn btn-success btn-sm",disabled:k.value,onClick:O},[k.value?(n(),l("i",ue)):(n(),l("i",de)),a[16]||(a[16]=r(" Generate User "))],8,ie)):x("",!0),e("button",{class:"btn btn-primary btn-sm",onClick:z,disabled:!p.value},a[17]||(a[17]=[e("i",{class:"fas fa-user-plus mr-1"},null,-1),r(" Tambah User ")]),8,me)])])])]),e("section",ve,[e("div",pe,[e("div",ce,[e("div",be,[b(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>E.value=t),type:"text",class:"form-control",placeholder:"Cari nama, email, atau username..."},null,512),[[g,E.value]])]),e("div",fe,[e("table",_e,[a[22]||(a[22]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Nama"),e("th",null,"Username"),e("th",null,"Role"),e("th",null,"Event"),e("th",{style:{width:"80px"}},"Aksi")])],-1)),e("tbody",null,[N.value?(n(),l("tr",ge,a[18]||(a[18]=[e("td",{colspan:"7",class:"text-center"},"Memuat data...",-1)]))):V.value.length===0?(n(),l("tr",ke,a[19]||(a[19]=[e("td",{colspan:"7",class:"text-center"},"Tidak ada user ditemukan.",-1)]))):x("",!0),(n(!0),l(M,null,q(V.value,(t,c)=>(n(),l("tr",{key:t.id},[e("td",null,u(c+1+(d.value.current_page-1)*d.value.per_page),1),e("td",null,[e("strong",null,u(t.name),1)]),e("td",null,u(t.username),1),e("td",null,[t.role?(n(),l("span",ye,u(t.role.name),1)):(n(),l("span",he,"-"))]),e("td",null,[t.event?(n(),l("span",xe,u(t.event.event_name||t.event.nama_event||t.event.name||"Event #"+t.event.id),1)):(n(),l("span",we,"Global"))]),e("td",Ue,[e("div",Ee,[e("button",{class:"btn btn-outline-warning",title:"Edit",onClick:_=>I(t)},a[20]||(a[20]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Ge),e("button",{class:"btn btn-outline-danger",title:"Hapus",onClick:_=>Y(t)},a[21]||(a[21]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,Me)])])]))),128))])])]),e("div",Ce,[e("div",Se,[e("div",Ve," Menampilkan "+u(d.value.from||0)+" - "+u(d.value.to||0)+" dari "+u(d.value.total||0)+" user ",1),e("ul",$e,[e("li",{class:A(["page-item",{disabled:d.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:a[1]||(a[1]=C(t=>f(d.value.current_page-1),["prevent"]))}," « ")],2),e("li",Ne,[e("span",Te," Halaman "+u(d.value.current_page)+" / "+u(d.value.last_page||1),1)]),e("li",{class:A(["page-item",{disabled:d.value.current_page===d.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:a[2]||(a[2]=C(t=>f(d.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",De,[e("div",qe,[e("div",Le,[e("div",Be,[e("h5",Ke,[a[23]||(a[23]=e("i",{class:"fas fa-user-edit mr-2"},null,-1)),r(" "+u(h.value?"Edit User Event":"Tambah User Event"),1)]),a[24]||(a[24]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Pe,[e("form",{onSubmit:C(J,["prevent"])},[e("div",Re,[e("div",Ae,[e("div",Fe,[a[25]||(a[25]=e("label",{class:"mb-1"},"Nama Lengkap",-1)),b(e("input",{"onUpdate:modelValue":a[3]||(a[3]=t=>o.value.name=t),type:"text",class:"form-control form-control-sm",required:""},null,512),[[g,o.value.name]])]),e("div",Oe,[a[26]||(a[26]=e("label",{class:"mb-1"},"Email",-1)),b(e("input",{"onUpdate:modelValue":a[4]||(a[4]=t=>o.value.email=t),type:"email",class:"form-control form-control-sm",required:""},null,512),[[g,o.value.email]])]),e("div",je,[a[27]||(a[27]=e("label",{class:"mb-1"},"Username",-1)),b(e("input",{"onUpdate:modelValue":a[5]||(a[5]=t=>o.value.username=t),type:"text",class:"form-control form-control-sm",required:""},null,512),[[g,o.value.username]])]),e("div",He,[e("label",ze,[a[28]||(a[28]=r(" Password ")),h.value?(n(),l("small",Ie,"(kosongkan jika tidak diubah)")):x("",!0)]),b(e("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>o.value.password=t),type:"password",class:"form-control form-control-sm",required:!h.value},null,8,Je),[[g,o.value.password]])])]),e("div",Ye,[e("div",Qe,[a[30]||(a[30]=e("label",{class:"mb-1"},"Role",-1)),b(e("select",{"onUpdate:modelValue":a[7]||(a[7]=t=>o.value.role_id=t),class:"form-control form-control-sm",required:""},[a[29]||(a[29]=e("option",{value:null},"-- Pilih Role --",-1)),(n(!0),l(M,null,q(T.value,t=>(n(),l("option",{key:t.id,value:t.id},u(t.name),9,We))),128))],512),[[F,o.value.role_id]])]),e("div",Xe,[a[31]||(a[31]=e("label",{class:"mb-1"},"Event (otomatis dari context)",-1)),e("input",{type:"text",class:"form-control form-control-sm",value:i.value?D.value:"Global / Tidak terikat event",readonly:""},null,8,Ze)]),e("div",ea,[a[32]||(a[32]=e("label",{class:"mb-1"},"Avatar (URL opsional)",-1)),b(e("input",{"onUpdate:modelValue":a[8]||(a[8]=t=>o.value.avatar=t),type:"text",class:"form-control form-control-sm",placeholder:"https://..."},null,512),[[g,o.value.avatar]])])])]),e("div",aa,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:G.value},[G.value?(n(),l("i",sa)):(n(),l("i",la)),a[33]||(a[33]=r(" Simpan "))],8,ta)])],32)])])])]),e("div",na,[e("div",oa,[e("div",ra,[a[46]||(a[46]=e("div",{class:"modal-header py-2"},[e("h5",{class:"modal-title"},[e("i",{class:"fas fa-users-cog mr-2"}),r(" Generate User Otomatis ")]),e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")])],-1)),e("div",ia,[i.value?(n(),l("p",ua,[a[34]||(a[34]=r(" Event: ")),e("strong",null,u(D.value),1),a[35]||(a[35]=e("br",null,null,-1)),a[36]||(a[36]=r(" Tingkat: ")),e("strong",null,u(B.value),1)])):x("",!0),e("p",da,[a[39]||(a[39]=r(" Sistem akan membuat user untuk ")),y.value==="province"||y.value==="provinsi"?(n(),l("span",ma,a[37]||(a[37]=[r(" setiap "),e("strong",null,"kabupaten/kota",-1),r(" pada provinsi ini. ")]))):y.value==="regency"||y.value==="kabupaten_kota"?(n(),l("span",va,a[38]||(a[38]=[r(" setiap "),e("strong",null,"kecamatan",-1),r(" pada kabupaten/kota ini. ")]))):x("",!0)]),e("form",{onSubmit:C(H,["prevent"])},[e("div",pa,[a[41]||(a[41]=e("label",{class:"mb-1"},"Role untuk User Hasil Generate",-1)),b(e("select",{"onUpdate:modelValue":a[9]||(a[9]=t=>m.value.role_id=t),class:"form-control form-control-sm",required:""},[a[40]||(a[40]=e("option",{value:null},"-- Pilih Role --",-1)),(n(!0),l(M,null,q(T.value,t=>(n(),l("option",{key:t.id,value:t.id},u(t.name),9,ca))),128))],512),[[F,m.value.role_id]])]),e("div",ba,[a[42]||(a[42]=e("label",{class:"mb-1"},[r(" Default Password "),e("small",{class:"text-muted"},[r(" (opsional, default: "),e("strong",null,"event_key"),r(") ")])],-1)),b(e("input",{"onUpdate:modelValue":a[10]||(a[10]=t=>m.value.default_password=t),type:"text",class:"form-control form-control-sm",placeholder:"Kosongkan untuk pakai event_key"},null,512),[[g,m.value.default_password]])]),e("div",fa,[a[43]||(a[43]=e("label",{class:"mb-1"},[r(" Email Domain "),e("small",{class:"text-muted"},[r(" (opsional, default: "),e("code",null,"mtq.local"),r(") ")])],-1)),b(e("input",{"onUpdate:modelValue":a[11]||(a[11]=t=>m.value.email_domain=t),type:"text",class:"form-control form-control-sm",placeholder:"misal: mtq.sumbar, mtq.kemenag.go.id"},null,512),[[g,m.value.email_domain]])]),a[45]||(a[45]=e("div",{class:"alert alert-warning text-xs py-2 mb-2"},[e("i",{class:"fas fa-exclamation-triangle mr-1"}),r(" User yang sudah ada dengan kombinasi "),e("strong",null,"event_id + username"),r(" tidak akan dibuat ulang (akan di-skip). ")],-1)),e("div",_a,[e("button",{type:"button",class:"btn btn-sm btn-secondary mr-2","data-dismiss":"modal",disabled:k.value}," Batal ",8,ga),e("button",{type:"submit",class:"btn btn-sm btn-success",disabled:k.value||!m.value.role_id},[k.value?(n(),l("i",ya)):(n(),l("i",ha)),a[44]||(a[44]=r(" Generate "))],8,ka)])],32)])])])])])],64))}};export{Ga as default};
