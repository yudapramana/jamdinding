import{_ as P,e as d,u as $,z as y,f as I,E as T,c as o,o as l,a as s,t as c,L as V,s as x,j as b,v as z,F as h,H as w,n as B,d as D,S as H}from"./app-CSA2mFh-.js";import{u as N}from"./MasterDataStore-aOYwtC0N.js";import"./LoadingStore-B9qlbHQ0.js";const R={class:"content"},j={class:"container-fluid"},q={class:"mb-3"},G={class:"d-block mb-1 text-muted font-weight-bold"},Q={class:"progress",style:{height:"20px"}},J=["aria-valuenow"],K={class:"card shadow-sm rounded-lg"},O={class:"card-body p-3"},W={class:"input-group mb-3"},X={key:0,class:"text-center p-5"},Y={key:1,class:"tree"},Z={class:"list-unstyled mb-0"},ee=["onClick"],se={class:"ml-2 font-weight-bold"},te={class:"badge badge-pill badge-primary ml-2"},ae={class:"pl-4 mt-1"},oe=["onClick"],le={key:0,class:"text-muted small ml-4 mt-1"},ne={key:2,class:"text-center p-5"},re={key:3,class:"modal fade show",style:{display:"block"},tabindex:"-1","aria-modal":"true"},ie={class:"modal-dialog modal-xl"},de={class:"modal-content"},ce={class:"modal-header p-2"},ue={class:"modal-body p-2"},pe=["src"],me={key:1,class:"text-muted text-center py-5"},ve={key:0},fe={key:1},_e={__name:"MyDocs",setup(he){const C=d(null),n=d(!1),f=d([]),i=d(null),u=d(""),_=d(!1),L=()=>{n.value=!1},S=()=>{n.value=!0},g=N(),p=$(),m=y(()=>{var a,e;return((e=(a=p.user)==null?void 0:a.employee)==null?void 0:e.progress_dokumen)??0}),E=async()=>{console.log("eh kepanggil fetchdata didalam Doclist"),await g.getDoctypeList(),await p.getMyDocuments();const a=g.doctypeList,e=p.myDocuments;f.value=a.map(t=>{const v=e.filter(r=>(r.id_doc_type===t.id||r.doc_type_id===t.id||r.doc_type===t.id)&&r.status==="Approved");return{id:t.id,text:t.text,expanded:!0,files:v}})},M=a=>{a.expanded=!a.expanded},F=a=>`/api/preview/pdf?path=${encodeURI(a)}`,U=async a=>{if(n.value=!1,!a){n.value="missing_path";return}const e=F(a);i.value=e;try{const t=await fetch(e,{method:"HEAD",credentials:"include",headers:{Accept:"application/pdf"}});if(!t.ok){n.value=t.status===404?"not_found":t.status>=500?"internal_server_error":"fetch_failed";return}(t.headers.get("content-type")||"").toLowerCase().includes("pdf")||(n.value="not_pdf")}catch{n.value="network_error"}},A=()=>{u.value=""},k=y(()=>{if(!u.value)return f.value;const a=u.value.toLowerCase();return f.value.filter(e=>e.text.toLowerCase().includes(a)||e.files.some(t=>t.file_name.toLowerCase().includes(a)))});return I(async()=>{var a,e;_.value=!0,await p.getDocsUpdateState(),console.log("Progress Dokumen:",(e=(a=p.user)==null?void 0:a.employee)==null?void 0:e.progress_dokumen),console.log("eh kepanggil fetchdata didalam onMounted Doclist"),await E(),_.value=!1}),T(()=>i,async a=>{var e;if(n.value=!1,!!a)try{const t=await fetch(a,{method:"HEAD"});(!t.ok||!((e=t.headers.get("content-type"))!=null&&e.includes("pdf")))&&(n.value=!0)}catch{n.value=!0}}),(a,e)=>(l(),o(h,null,[e[7]||(e[7]=s("section",{class:"content-header"},[s("div",{class:"container-fluid"},[s("h3",{class:"text-primary"},"ðŸ“‚ Daftar Dokumen")])],-1)),s("section",R,[s("div",j,[s("div",q,[s("label",G," Progress Dokumen: "+c(m.value||0)+"% ",1),s("div",Q,[s("div",{class:"progress-bar bg-success",style:V({width:m.value+"%"}),role:"progressbar","aria-valuenow":m.value,"aria-valuemin":"0","aria-valuemax":"100"},c(m.value||0)+"% ",13,J)])]),s("div",K,[s("div",O,[s("div",W,[b(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),class:"form-control",placeholder:"Cari dokumen..."},null,512),[[z,u.value]]),s("div",{class:"input-group-append"},[s("button",{class:"btn btn-outline-secondary",type:"button",onClick:A},"Reset")])]),_.value?(l(),o("div",X,e[2]||(e[2]=[s("div",{class:"spinner-border text-primary mb-2",role:"status"},[s("span",{class:"sr-only"},"Loading...")],-1),s("div",{class:"text-muted"},"Memuat daftar dokumen...",-1)]))):k.value.length?(l(),o("div",Y,[s("ul",Z,[(l(!0),o(h,null,w(k.value,(t,v)=>(l(),o("li",{key:t.id,class:"mb-2"},[s("div",{onClick:r=>M(t),class:"d-flex align-items-center cursor-pointer py-1 px-2 bg-light rounded small"},[s("i",{class:B([t.expanded?"fas fa-folder-open text-warning":"fas fa-folder text-secondary","mr-2"])},null,2),s("span",se,[D(c(v+1)+". "+c(t.text)+" ",1),s("span",te,c(t.files.length),1)])],8,ee),b(s("ul",ae,[(l(!0),o(h,null,w(t.files,r=>(l(),o("li",{key:r.id,onClick:ge=>U(r.file_path),class:"cursor-pointer p-1 rounded hover-bg-light small"},[e[3]||(e[3]=s("i",{class:"fas fa-file-pdf text-danger mr-2"},null,-1)),D(" "+c(r.file_name),1)],8,oe))),128)),t.files.length?x("",!0):(l(),o("li",le," Tidak ada file diupload. "))],512),[[H,t.expanded]])]))),128))])])):(l(),o("div",ne,e[4]||(e[4]=[s("span",{class:"text-muted"},"Data tidak ditemukan.",-1)]))),i.value?(l(),o("div",re,[s("div",ie,[s("div",de,[s("div",ce,[e[6]||(e[6]=s("h5",{class:"modal-title"},"Preview Dokumen",-1)),s("button",{type:"button",class:"close",onClick:e[1]||(e[1]=t=>i.value=null)},e[5]||(e[5]=[s("span",null,"Ã—",-1)]))]),s("div",ue,[i.value&&!n.value?(l(),o("iframe",{key:0,ref_key:"pdfFrame",ref:C,src:`${i.value}#toolbar=0&navpanes=0&scrollbar=0`,class:"w-100",frameborder:"0",style:{height:"90vh",border:"1px solid #ccc"},onLoad:L,onError:S},null,40,pe)):(l(),o("div",me,[n.value?(l(),o("p",ve,"Gagal memuat dokumen. Pastikan file tersedia dan dapat diakses. ")):(l(),o("p",fe,"File tidak tersedia."))]))])])])])):x("",!0)])])])])],64))}},be=P(_e,[["__scopeId","data-v-8d2fd07e"]]);export{be as default};
