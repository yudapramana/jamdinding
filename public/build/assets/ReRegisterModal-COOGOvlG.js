import{y as n,A as b,O as E,B as l,C as o,D as t,I as v,K as i,J as u,H as Q,U as L,ay as V,S as y,aA as D,as as X,aB as Y,a as Z}from"./AuthUserStore-B6VIMEgo.js";import{S as x}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{_ as tt}from"./app-DdJgNepn.js";const et={class:"modal fade",id:"reRegisterModal",tabindex:"-1",role:"dialog","aria-hidden":"true"},st={class:"modal-dialog modal-xl modal-dialog-scrollable",role:"document"},at={class:"modal-content"},lt={class:"modal-header"},ot=["disabled"],nt={key:0,class:"modal-body"},it={class:"card mb-3"},dt={class:"card-body py-3"},rt={class:"d-flex flex-wrap justify-content-between"},ut={class:"mb-2"},ct={class:"h6 mb-1"},mt={class:"text-sm text-muted"},vt={class:"text-sm text-muted"},_t={key:0,class:"text-sm text-muted"},bt={class:"text-sm"},ft={class:"mb-1"},ht={class:"badge badge-light border"},pt={key:0,class:"mb-1"},gt={class:"badge badge-info"},kt={class:"row"},yt={class:"col-md-6 mb-3"},xt={class:"card h-100"},wt={class:"card-body d-flex justify-content-center align-items-center"},Ct={class:"photo-frame"},Tt=["src"],Pt={key:1,class:"text-muted text-sm"},Ut={class:"col-md-6 mb-3"},Kt={class:"card h-100"},jt={class:"card-body d-flex justify-content-center align-items-center"},Bt={class:"photo-frame"},St={key:0,class:"w-100 h-100 d-flex flex-column"},Lt=["src"],Vt={class:"pt-2 text-center"},Dt=["href"],It=["src"],Mt={key:2,class:"text-center"},Rt=["href"],Ft={key:3,class:"text-muted text-sm"},Nt={class:"card mb-3"},At={class:"card-body"},Wt={class:"d-flex flex-wrap"},zt=["href"],Gt=["href"],Ot=["href"],Ht=["href"],Jt={key:4,class:"text-muted text-sm"},$t={class:"card mb-3"},qt={class:"card-body"},Et={class:"row"},Qt={class:"col-md-6"},Xt=["id","onUpdate:modelValue"],Yt=["for"],Zt={class:"col-md-6"},te=["id","onUpdate:modelValue"],ee=["for"],se={class:"form-group mt-3 mb-0"},ae={class:"form-group"},le={class:"modal-footer"},oe=["disabled"],ne=["disabled"],ie={__name:"ReRegisterModal",props:{eventParticipant:Object},emits:["updated","request-draw"],setup(I,{emit:M}){const j=I,R=M,m=n(()=>j.eventParticipant||null),a=n(()=>{var s;return((s=m.value)==null?void 0:s.participant)||null}),p=b(!1),g=b(""),f=b(""),c=b({face_match:!1,nik_match:!1,name_match:!1,birth_match:!1,contingent_match:!1,category_match:!1}),F={face_match:"Wajah sesuai KTP",nik_match:"NIK sesuai",name_match:"Nama sesuai"},N={birth_match:"TTL sesuai",contingent_match:"Kontingen sesuai",category_match:"Cabang/Golongan sesuai"},A=n(()=>c.value.face_match&&c.value.nik_match&&c.value.name_match&&c.value.birth_match),h=s=>typeof s=="string"&&s.trim()!==""?s:null,B=n(()=>{var s;return h((s=a.value)==null?void 0:s.photo_url)}),d=n(()=>{var s;return h((s=a.value)==null?void 0:s.id_card_url)}),w=n(()=>{var s;return h((s=a.value)==null?void 0:s.family_card_url)}),C=n(()=>{var s;return h((s=a.value)==null?void 0:s.bank_book_url)}),T=n(()=>{var s;return h((s=a.value)==null?void 0:s.certificate_url)}),P=n(()=>{var s;return h((s=a.value)==null?void 0:s.other_url)}),S=n(()=>a.value?[a.value.address,a.value.village_name,a.value.district_name,a.value.regency_name,a.value.province_name].filter(Boolean).join(", "):""),W=s=>String(s).split("?")[0].toLowerCase().endsWith(".pdf"),z=s=>[".jpg",".jpeg",".png",".webp",".gif"].some(e=>String(s).split("?")[0].toLowerCase().endsWith(e)),G=n(()=>d.value&&W(d.value)),O=n(()=>d.value&&z(d.value));b([]);const H=b(!1),U=b(null);n(()=>U.value==null?"":U.value%2===0?"even":"odd");const J=async()=>{var s,e;if(!f.value){x.fire("Pilih keputusan","Silakan pilih ACC atau Tolak.","warning");return}if(f.value==="verified"&&!A.value){x.fire("Checklist belum lengkap","Lengkapi checklist inti sebelum ACC.","warning");return}p.value=!0;try{await Z.post(`/api/v1/event-participants/${m.value.id}/re-registration`,{reregistration_status:f.value,reregistration_notes:g.value||null}),$("#reRegisterModal").modal("hide"),await x.fire({icon:"success",title:"Berhasil",text:"Daftar ulang peserta berhasil diproses.",timer:1500,showConfirmButton:!1}),R("updated")}catch(k){x.fire("Gagal",((e=(s=k.response)==null?void 0:s.data)==null?void 0:e.message)||"Terjadi kesalahan.","error")}finally{p.value=!1}},q=s=>s==="verified"?"badge-success":s==="rejected"?"badge-danger":"badge-secondary";return E(()=>j.eventParticipant,()=>{g.value="",f.value="",U.value=null,H.value=!1,c.value={face_match:!1,nik_match:!1,name_match:!1,birth_match:!1,contingent_match:!1,category_match:!1}}),(s,e)=>{var k;return o(),l("div",et,[t("div",st,[t("div",at,[t("div",lt,[e[3]||(e[3]=t("div",null,[t("h5",{class:"modal-title"},"Proses Daftar Ulang"),t("div",{class:"text-sm text-muted"}," Cocokkan wajah (photo_url) dengan KTP (id_card_url) dan validasi data peserta. ")],-1)),t("button",{type:"button",class:"close","data-dismiss":"modal",disabled:p.value},e[2]||(e[2]=[t("span",null,"×",-1)]),8,ot)]),m.value&&a.value?(o(),l("div",nt,[t("div",it,[t("div",dt,[t("div",rt,[t("div",ut,[t("div",ct,i(a.value.full_name),1),t("div",mt,[e[4]||(e[4]=u(" NIK: ")),t("strong",null,i(a.value.nik),1),e[5]||(e[5]=t("span",{class:"mx-2"},"•",-1)),e[6]||(e[6]=u(" JK: ")),t("strong",null,i(a.value.gender),1),e[7]||(e[7]=t("span",{class:"mx-2"},"•",-1)),e[8]||(e[8]=u(" HP: ")),t("strong",null,i(a.value.phone_number||"-"),1)]),t("div",vt,[e[9]||(e[9]=u(" TTL: ")),t("strong",null,i(a.value.place_of_birth),1),e[10]||(e[10]=u(", ")),t("strong",null,i(a.value.date_of_birth),1)]),S.value?(o(),l("div",_t," Alamat: "+i(S.value),1)):v("",!0)]),t("div",bt,[t("div",ft,[e[11]||(e[11]=u(" Kontingen: ")),t("span",ht,i(m.value.contingent||"-"),1)]),m.value.event_category?(o(),l("div",pt,[e[12]||(e[12]=u(" Cabang/Golongan: ")),t("span",gt,i(((k=m.value.event_category)==null?void 0:k.full_name)||"-"),1)])):v("",!0),t("div",null,[e[13]||(e[13]=u(" Status sekarang: ")),t("span",{class:Q(["badge",q(m.value.reregistration_status)])},i(m.value.reregistration_status),3)])])])])]),t("div",kt,[t("div",yt,[t("div",xt,[e[14]||(e[14]=t("div",{class:"card-header py-2"},[t("strong",null,"Foto Wajah"),t("small",{class:"text-muted"},"(photo_url)")],-1)),t("div",wt,[t("div",Ct,[B.value?(o(),l("img",{key:0,src:B.value,alt:"Foto Wajah",loading:"lazy"},null,8,Tt)):(o(),l("div",Pt," Tidak ada foto wajah "))])])])]),t("div",Ut,[t("div",Kt,[e[18]||(e[18]=t("div",{class:"card-header py-2"},[t("strong",null,"Foto KTP"),t("small",{class:"text-muted"},"(id_card_url)")],-1)),t("div",jt,[t("div",Bt,[d.value&&G.value?(o(),l("div",St,[t("iframe",{class:"pdf-frame flex-grow-1",src:d.value,title:"KTP PDF"},null,8,Lt),t("div",Vt,[t("a",{class:"btn btn-outline-primary btn-sm",href:d.value,target:"_blank"},e[15]||(e[15]=[t("i",{class:"far fa-file-pdf mr-1"},null,-1),u(" Buka PDF ")]),8,Dt)])])):d.value&&O.value?(o(),l("img",{key:1,src:d.value,alt:"Foto KTP",loading:"lazy"},null,8,It)):d.value?(o(),l("div",Mt,[e[17]||(e[17]=t("div",{class:"text-muted text-sm mb-2"}," Dokumen KTP tidak bisa dipreview ",-1)),t("a",{class:"btn btn-outline-primary btn-sm",href:d.value,target:"_blank"},e[16]||(e[16]=[t("i",{class:"far fa-file mr-1"},null,-1),u(" Buka Dokumen ")]),8,Rt)])):(o(),l("div",Ft," Tidak ada foto KTP "))])])])])]),t("div",Nt,[e[19]||(e[19]=t("div",{class:"card-header py-2"},[t("strong",null,"Lampiran Lainnya")],-1)),t("div",At,[t("div",Wt,[w.value?(o(),l("a",{key:0,class:"btn btn-outline-secondary btn-sm mr-2 mb-2",href:w.value,target:"_blank"},"KK",8,zt)):v("",!0),C.value?(o(),l("a",{key:1,class:"btn btn-outline-secondary btn-sm mr-2 mb-2",href:C.value,target:"_blank"},"Buku Tabungan",8,Gt)):v("",!0),T.value?(o(),l("a",{key:2,class:"btn btn-outline-secondary btn-sm mr-2 mb-2",href:T.value,target:"_blank"},"Sertifikat",8,Ot)):v("",!0),P.value?(o(),l("a",{key:3,class:"btn btn-outline-secondary btn-sm mr-2 mb-2",href:P.value,target:"_blank"},"Lainnya",8,Ht)):v("",!0),!w.value&&!C.value&&!T.value&&!P.value?(o(),l("span",Jt," Tidak ada lampiran tambahan ")):v("",!0)])])]),t("div",$t,[e[21]||(e[21]=t("div",{class:"card-header py-2"},[t("strong",null,"Checklist Verifikasi")],-1)),t("div",qt,[t("div",Et,[t("div",Qt,[(o(),l(L,null,V(F,(_,r)=>t("div",{class:"custom-control custom-checkbox mb-2",key:r},[y(t("input",{class:"custom-control-input",type:"checkbox",id:r,"onUpdate:modelValue":K=>c.value[r]=K},null,8,Xt),[[D,c.value[r]]]),t("label",{class:"custom-control-label text-sm",for:r},i(_),9,Yt)])),64))]),t("div",Zt,[(o(),l(L,null,V(N,(_,r)=>t("div",{class:"custom-control custom-checkbox mb-2",key:r},[y(t("input",{class:"custom-control-input",type:"checkbox",id:r,"onUpdate:modelValue":K=>c.value[r]=K},null,8,te),[[D,c.value[r]]]),t("label",{class:"custom-control-label text-sm",for:r},i(_),9,ee)])),64))])]),t("div",se,[e[20]||(e[20]=t("label",{class:"text-sm mb-1"},"Catatan Verifikator",-1)),y(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=_=>g.value=_),class:"form-control",rows:"3",placeholder:"Catatan verifikasi"},null,512),[[X,g.value]])])])]),t("div",ae,[e[23]||(e[23]=t("label",{class:"text-sm"},"Keputusan",-1)),y(t("select",{"onUpdate:modelValue":e[1]||(e[1]=_=>f.value=_),class:"form-control"},e[22]||(e[22]=[t("option",{value:""},"-- pilih keputusan --",-1),t("option",{value:"verified"},"ACC / Terima",-1),t("option",{value:"rejected"},"Tolak",-1)]),512),[[Y,f.value]])])])):v("",!0),t("div",le,[t("button",{type:"button",class:"btn btn-light","data-dismiss":"modal",disabled:p.value}," Tutup ",8,oe),t("button",{type:"button",class:"btn btn-primary",disabled:p.value,onClick:J}," Submit ",8,ne)])])])])}}},ce=tt(ie,[["__scopeId","data-v-844536b6"]]);export{ce as R};
